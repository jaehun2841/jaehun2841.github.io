<!DOCTYPE html><html lang="lang"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Spring Rest Docs를 이용한 API 문서 만들기"><meta name="keywords" content="Spring,Spring-Rest-Docs"><meta name="author" content="Carrey"><meta name="copyright" content="Carrey"><title>Spring Rest Docs를 이용한 API 문서 만들기 | Carrey`s 기술블로그</title><link rel="shortcut icon" href="../../../../melody-favicon.ico"><link rel="stylesheet" href="../../../../css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '6.0.0'
} </script><meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="rss2.xml" title="Carrey`s 기술블로그" type="application/rss+xml">
</head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-Rest-Docs%EB%9E%80"><span class="toc-number">1.</span> <span class="toc-text">Spring Rest Docs란</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-Rest-Docs-Architecture"><span class="toc-number">2.</span> <span class="toc-text">Spring Rest Docs Architecture</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EC%98%88%EC%8B%9C"><span class="toc-number">2.1.</span> <span class="toc-text">예시</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#x2F-src-x2F-docs-x2F-asciidoc-%EB%94%94%EB%A0%89%ED%86%A0%EB%A6%AC-%EB%82%B4%EC%97%90-html%EB%A1%9C-%EC%A0%9C%EA%B3%B5%EB%90%A0-%EB%AC%B8%EC%84%9C%EB%A5%BC-asciidoc%EC%9C%BC%EB%A1%9C-%EC%9E%91%EC%84%B1"><span class="toc-number">2.1.1.</span> <span class="toc-text">&#x2F;src&#x2F;docs&#x2F;asciidoc 디렉토리 내에 html로 제공될 문서를 asciidoc으로 작성</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Test-Case%EC%9D%98-%EC%82%B0%EC%B6%9C%EB%AC%BC"><span class="toc-number">2.1.2.</span> <span class="toc-text">Test Case의 산출물</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x2F-src-x2F-docs-x2F-asciidoc-%EB%94%94%EB%A0%89%ED%86%A0%EB%A6%AC-adoc%ED%8C%8C%EC%9D%BC%EC%9D%84-%EA%B8%B0%EB%B0%98%EC%9C%BC%EB%A1%9C-%EC%83%9D%EC%84%B1%EB%90%9C-html-%ED%8C%8C%EC%9D%BC"><span class="toc-number">2.1.3.</span> <span class="toc-text">&#x2F;src&#x2F;docs&#x2F;asciidoc 디렉토리 adoc파일을 기반으로 생성된 html 파일</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-Rest-Docs-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0"><span class="toc-number">3.</span> <span class="toc-text">Spring Rest Docs 시작하기</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EA%B0%9C%EB%B0%9C-%EC%8A%A4%ED%8E%99"><span class="toc-number">3.1.</span> <span class="toc-text">개발 스펙</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Test-Library"><span class="toc-number">3.2.</span> <span class="toc-text">Test Library</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Gradle-%EC%84%A4%EC%A0%95"><span class="toc-number">3.3.</span> <span class="toc-text">Gradle 설정</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#asciidoctor-plugin-%EC%84%A4%EC%A0%95"><span class="toc-number">3.3.1.</span> <span class="toc-text">asciidoctor plugin 설정</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#User-API-%EC%BD%94%EB%93%9C-%EC%9E%91%EC%84%B1"><span class="toc-number">3.4.</span> <span class="toc-text">User API 코드 작성</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UserController-kt"><span class="toc-number">3.5.</span> <span class="toc-text">UserController.kt</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UserService-kt"><span class="toc-number">3.6.</span> <span class="toc-text">UserService.kt</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Response-kt"><span class="toc-number">3.7.</span> <span class="toc-text">Response.kt</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#User-kt"><span class="toc-number">3.8.</span> <span class="toc-text">User.kt</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Test-%EC%BD%94%EB%93%9C-%EC%9E%91%EC%84%B1"><span class="toc-number">3.9.</span> <span class="toc-text">Test 코드 작성</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%BD%94%EB%93%9C-%EC%84%A4%EB%AA%85"><span class="toc-number">3.9.1.</span> <span class="toc-text">코드 설명</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Document-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0"><span class="toc-number">3.10.</span> <span class="toc-text">Document 생성하기</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%98%88%EC%8B%9C-1"><span class="toc-number">3.10.1.</span> <span class="toc-text">예시</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#API-Document-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0"><span class="toc-number">3.10.2.</span> <span class="toc-text">API Document 생성하기</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HTML-%EB%AC%B8%EC%84%9C-Serving-%ED%95%B4%EB%B3%B4%EA%B8%B0"><span class="toc-number">4.</span> <span class="toc-text">HTML 문서 Serving 해보기</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%EC%97%AC%EB%9F%AC%EA%B0%80%EC%A7%80-Function-%EC%82%AC%EC%9A%A9%ED%95%B4%EB%B3%B4%EA%B8%B0"><span class="toc-number">5.</span> <span class="toc-text">여러가지 Function 사용해보기</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#PathParameters"><span class="toc-number">5.1.</span> <span class="toc-text">PathParameters</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#requestHeader"><span class="toc-number">5.2.</span> <span class="toc-text">requestHeader</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fieldWithPath"><span class="toc-number">5.3.</span> <span class="toc-text">fieldWithPath</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#subSectionWithPath"><span class="toc-number">5.4.</span> <span class="toc-text">subSectionWithPath</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#responseField-and"><span class="toc-number">5.5.</span> <span class="toc-text">responseField().and()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#responseField-andWithPrefix"><span class="toc-number">5.6.</span> <span class="toc-text">responseField().andWithPrefix()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#beneathPath"><span class="toc-number">5.7.</span> <span class="toc-text">beneathPath</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-Rest-Docs-%EC%B6%94%EA%B0%80-%EA%B8%B0%EB%8A%A5"><span class="toc-number">6.</span> <span class="toc-text">Spring Rest Docs 추가 기능</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Custom-%ED%95%84%EB%93%9C-%EC%82%BD%EC%9E%85%ED%95%98%EA%B8%B0"><span class="toc-number">6.1.</span> <span class="toc-text">Custom 필드 삽입하기</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#path-parameters-snippet-override"><span class="toc-number">6.1.1.</span> <span class="toc-text">path-parameters snippet override</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EA%B2%B0%EA%B3%BC"><span class="toc-number">6.1.2.</span> <span class="toc-text">결과</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Custom-Snippet-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0"><span class="toc-number">6.2.</span> <span class="toc-text">Custom Snippet 생성하기</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Test%EC%9A%A9-Controller"><span class="toc-number">6.2.1.</span> <span class="toc-text">Test용 Controller</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Custom-Snippet-Template-%ED%8C%8C%EC%9D%BC"><span class="toc-number">6.2.2.</span> <span class="toc-text">Custom Snippet Template 파일</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ResponseCodeSnippet-%ED%81%B4%EB%9E%98%EC%8A%A4"><span class="toc-number">6.2.3.</span> <span class="toc-text">ResponseCodeSnippet 클래스</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Test-Code"><span class="toc-number">6.2.4.</span> <span class="toc-text">Test Code</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EA%B2%B0%EA%B3%BC-1"><span class="toc-number">6.2.5.</span> <span class="toc-text">결과</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%B6%94%EA%B0%80"><span class="toc-number">6.2.6.</span> <span class="toc-text">추가</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reference"><span class="toc-number">7.</span> <span class="toc-text">Reference</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://www.gravatar.com/avatar/3f8583b7b0f0c1ebd249dffad42707af?s=300"></div><div class="author-info__name text-center">Carrey</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="../../../../archives"><span class="pull-left">Articles</span><span class="pull-right">115</span></a><a class="author-info-articles__tags article-meta" href="../../../../tags"><span class="pull-left">Tags</span><span class="pull-right">27</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="../../../../index.html">Carrey`s 기술블로그</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">Spring Rest Docs를 이용한 API 문서 만들기</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-08-04</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>Spring Rest API 문서를 자동으로 생성하고자  할 때, 보통 Swagger로 많이 사용하지만<br>이번에는 Spring Rest Docs를 사용하여 API 문서를 자동으로 작성 할 수 있도록 해봤습니다.</p>
<p>포스팅에 작성된 코드는 <a target="_blank" rel="noopener" href="https://github.com/jaehun2841/spring-rest-docs-example">https://github.com/jaehun2841/spring-rest-docs-example</a> 에서 참고하시길 바랍니다.</p>
<h1 id="Spring-Rest-Docs란"><a href="#Spring-Rest-Docs란" class="headerlink" title="Spring Rest Docs란"></a>Spring Rest Docs란</h1><p>Spring Rest Docs는 테스트 코드를 기반으로 자동으로 API문서를 작성할 수 있게 해주는 프레임워크입니다.<br>그렇기 때문에 반드시 <code>Test가 통과되어야 문서가 작성</code> 된다는 장점이 있습니다.<br>(그렇기 때문에 API Spec이 변경되거나 추가&#x2F;삭제 되는 부분에 대해 항상 테스트 코드를 수정하여야 하며, API 문서가 최신화 될 수 있도록 해줍니다.)<br>기본적으로 asciidoc을 사용하여 문서를 작성합니다 . (asciidoc은 마크다운과 비슷하게 html문서를 작성할 수 있는 언어입니다.)<br>원하는 경우에는 mark down을 사용할 수도 있지만, 이번 포스트에서는 asciidoc을 이용하여 API 문서를 작성해 보도록 하겠습니다.</p>
<h1 id="Spring-Rest-Docs-Architecture"><a href="#Spring-Rest-Docs-Architecture" class="headerlink" title="Spring Rest Docs Architecture"></a>Spring Rest Docs Architecture</h1><p><img src="./asciidoctor.png" alt="asciidoctor-task"></p>
<ul>
<li>Test Case를 수행하면 산출물이 <document-name>.adoc 파일로 &#x2F;build&#x2F;generate-snippets 디렉토리에 생성됩니다. (default path)</li>
<li>&#x2F;src&#x2F;docs&#x2F;asciidoc 디렉토리에 &#x2F;build&#x2F;generate-snippets에 있는 adoc 파일을 include하여 문서를 생성할 수 있습니다.<ul>
<li>&#x2F;build&#x2F;generate-snippets&#x2F;*.adoc 파일들은 API Request, Response에 대한 명세들만 있는 파일이고</li>
<li>&#x2F;src&#x2F;docs&#x2F;asciidoc&#x2F;*.adoc 파일들이 실제 사용자에게 html파일로 변환되어 제공되는 API 문서 파일입니다.</li>
<li>따라서 &#x2F;src&#x2F;docs&#x2F;asciidoc&#x2F;*.adoc 에 API 문서를 작성하고,<br>필요한 API Request, Response Spec은 자동 생성된 &#x2F;build&#x2F;generate-snippets&#x2F;*.adoc 파일들을 이용해 표현해줍니다.</li>
<li>이렇게 하면 향후 API Spec이 변경되더라도, 문서를 수정하지 않아도 되는 장점이 있습니다.</li>
</ul>
</li>
<li>이렇게 생성된 asciidoc 문서는 AsciidoctorTask를 통해 html 문서로 processing 되어 &#x2F;build&#x2F;asciidoc&#x2F;html5 하위에 html문서로 생성됩니다.<ul>
<li>html 문서가 생성되는 기준은 &#x2F;src&#x2F;docs&#x2F;asciidoc&#x2F;*.adoc 파일을 기준으로 생성됩니다.</li>
</ul>
</li>
</ul>
<h2 id="예시"><a href="#예시" class="headerlink" title="예시"></a>예시</h2><h3 id="x2F-src-x2F-docs-x2F-asciidoc-디렉토리-내에-html로-제공될-문서를-asciidoc으로-작성"><a href="#x2F-src-x2F-docs-x2F-asciidoc-디렉토리-내에-html로-제공될-문서를-asciidoc으로-작성" class="headerlink" title="&#x2F;src&#x2F;docs&#x2F;asciidoc 디렉토리 내에 html로 제공될 문서를 asciidoc으로 작성"></a>&#x2F;src&#x2F;docs&#x2F;asciidoc 디렉토리 내에 html로 제공될 문서를 asciidoc으로 작성</h3><p><img src="./src-template.png" alt="docuement-templates"></p>
<h3 id="Test-Case의-산출물"><a href="#Test-Case의-산출물" class="headerlink" title="Test Case의 산출물"></a>Test Case의 산출물</h3><ul>
<li>&#x2F;build&#x2F;generated-snippets 디렉토리 하위에 생성</li>
<li>Request, Response Spec에 대한 정보를 생성</li>
<li>&#x2F;src&#x2F;docs&#x2F;asciidoc&#x2F;*.adoc 파일에서 include해서 사용<br><img src="./snippets.png" alt="snippets"><h3 id="x2F-src-x2F-docs-x2F-asciidoc-디렉토리-adoc파일을-기반으로-생성된-html-파일"><a href="#x2F-src-x2F-docs-x2F-asciidoc-디렉토리-adoc파일을-기반으로-생성된-html-파일" class="headerlink" title="&#x2F;src&#x2F;docs&#x2F;asciidoc 디렉토리 adoc파일을 기반으로 생성된 html 파일"></a>&#x2F;src&#x2F;docs&#x2F;asciidoc 디렉토리 adoc파일을 기반으로 생성된 html 파일</h3><img src="./processed-html.png" alt="processed-html"></li>
</ul>
<p>자세한 부분은 아래 예시를 따라하면서 보시면 좋을 것 같습니다.</p>
<h1 id="Spring-Rest-Docs-시작하기"><a href="#Spring-Rest-Docs-시작하기" class="headerlink" title="Spring Rest Docs 시작하기"></a>Spring Rest Docs 시작하기</h1><h2 id="개발-스펙"><a href="#개발-스펙" class="headerlink" title="개발 스펙"></a>개발 스펙</h2><ul>
<li>Spring Boot 2.1.6.RELEASE</li>
<li>Junit 5</li>
<li>Kotlin 1.3.41 (저희 팀에서 코틀린만 써서 코틀린이 편하네요)</li>
<li>Gradle 5.4.1</li>
<li>Asciidoctor 1.5.9.2</li>
</ul>
<h2 id="Test-Library"><a href="#Test-Library" class="headerlink" title="Test Library"></a>Test Library</h2><p>Spring Rest Docs는 3가지 테스트 라이브러리를 지원합니다.</p>
<ul>
<li>MockMvc (@WebMvcTest)</li>
<li>WebTestClient (Mono &#x2F; Flux, @WebTestClient)</li>
<li>Rest Assured (IntegrationTest, @SpringBootTest)</li>
</ul>
<p>API 문서를 작성할 때 Spring Mvc를 사용하는 환경이라면 가장 가볍게 돌릴 수 있는게 MockMvc를 사용하는 것이라 생각합니다.<br>그래서 이번 포스팅에서는 MockMvc를 사용한 예제로만 진행하도록 하겠습니다.</p>
<h2 id="Gradle-설정"><a href="#Gradle-설정" class="headerlink" title="Gradle 설정"></a>Gradle 설정</h2><h3 id="asciidoctor-plugin-설정"><a href="#asciidoctor-plugin-설정" class="headerlink" title="asciidoctor plugin 설정"></a>asciidoctor plugin 설정</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    ext &#123;</span><br><span class="line">        kotlinVersion = <span class="string">&#x27;1.3.41&#x27;</span></span><br><span class="line">        springBootVersion = <span class="string">&quot;2.1.6.RELEASE&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    repositories &#123;</span><br><span class="line">        mavenCentral()</span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath <span class="string">&quot;org.springframework.boot:spring-boot-gradle-plugin:$springBootVersion&quot;</span></span><br><span class="line">        classpath <span class="string">&quot;org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlinVersion&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">plugins &#123;</span><br><span class="line">    id <span class="string">&#x27;org.asciidoctor.convert&#x27;</span> version <span class="string">&#x27;1.5.9.2&#x27;</span></span><br><span class="line">    id <span class="string">&#x27;org.springframework.boot&#x27;</span> version <span class="string">&#x27;2.1.6.RELEASE&#x27;</span></span><br><span class="line">    id <span class="string">&quot;io.spring.dependency-management&quot;</span> version <span class="string">&quot;1.0.5.RELEASE&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apply <span class="attr">plugin:</span> <span class="string">&#x27;io.spring.dependency-management&#x27;</span></span><br><span class="line">apply <span class="attr">plugin:</span> <span class="string">&#x27;kotlin&#x27;</span></span><br><span class="line">apply <span class="attr">plugin:</span> <span class="string">&quot;groovy&quot;</span></span><br><span class="line">apply <span class="attr">plugin:</span> <span class="string">&quot;org.springframework.boot&quot;</span></span><br><span class="line">apply <span class="attr">plugin:</span> <span class="string">&quot;io.spring.dependency-management&quot;</span></span><br><span class="line">apply <span class="attr">plugin:</span> <span class="string">&quot;kotlin-kapt&quot;</span></span><br><span class="line"></span><br><span class="line">group = <span class="string">&#x27;com.example&#x27;</span></span><br><span class="line">version = <span class="string">&#x27;0.0.1-SNAPSHOT&#x27;</span></span><br><span class="line">sourceCompatibility = <span class="string">&#x27;1.8&#x27;</span></span><br><span class="line"></span><br><span class="line">repositories &#123;</span><br><span class="line">    mavenCentral()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ext &#123;</span><br><span class="line">    set(<span class="string">&#x27;snippetsDir&#x27;</span>, file(<span class="string">&quot;build/generated-snippets&quot;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    implementation <span class="string">&#x27;org.springframework.boot:spring-boot-starter-web&#x27;</span></span><br><span class="line">    testImplementation(<span class="string">&quot;org.springframework.boot:spring-boot-starter-test&quot;</span>) &#123;</span><br><span class="line">        exclude <span class="attr">group:</span> <span class="string">&quot;junit&quot;</span>, <span class="attr">module:</span> <span class="string">&quot;junit&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    testImplementation <span class="string">&quot;org.junit.jupiter:junit-jupiter-api&quot;</span></span><br><span class="line">    testImplementation <span class="string">&quot;org.junit.jupiter:junit-jupiter-params&quot;</span></span><br><span class="line">    testRuntimeOnly <span class="string">&quot;org.junit.jupiter:junit-jupiter-engine&quot;</span></span><br><span class="line">    testImplementation <span class="string">&#x27;org.springframework.restdocs:spring-restdocs-mockmvc&#x27;</span></span><br><span class="line">    testImplementation <span class="string">&quot;com.nhaarman:mockito-kotlin:1.6.0&quot;</span></span><br><span class="line">    implementation <span class="string">&quot;org.jetbrains.kotlin:kotlin-stdlib-jdk8:$kotlinVersion&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">kapt &#123;</span><br><span class="line">    useBuildCache = <span class="literal">true</span></span><br><span class="line">    correctErrorTypes = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test &#123;</span><br><span class="line">    useJUnitPlatform()</span><br><span class="line">    outputs.dir snippetsDir</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">asciidoctor &#123;</span><br><span class="line">    inputs.dir snippetsDir</span><br><span class="line">    dependsOn test <span class="comment">//test Task 이후에 실행될 수 있도록 Dependency를 설정</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">asciidoctor.doFirst &#123;</span><br><span class="line">    println <span class="string">&quot;=====start asciidoctor&quot;</span></span><br><span class="line">    <span class="comment">//asciidoctor 실행전 기존에 생성된 API 문서 삭제</span></span><br><span class="line">    delete file(<span class="string">&#x27;src/main/resources/static/docs&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line">asciidoctor.doLast &#123;</span><br><span class="line">    println <span class="string">&quot;=====finish asciidoctor&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task copyDocument(<span class="attr">type:</span> Copy) &#123;</span><br><span class="line">    dependsOn asciidoctor</span><br><span class="line">    from file(<span class="string">&quot;build/asciidoc/html5&quot;</span>)</span><br><span class="line">    <span class="comment">// resources/static/docs 로 복사하여 서버가 돌아가고 있을때 /docs/index.html 로 접속하면 볼수 있음</span></span><br><span class="line">    into file(<span class="string">&quot;src/main/resources/static/docs&quot;</span>)  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">build &#123;</span><br><span class="line">    dependsOn copyDocument</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bootJar &#123;</span><br><span class="line">    archiveName = <span class="string">&#x27;app.jar&#x27;</span></span><br><span class="line">    dependsOn asciidoctor</span><br><span class="line">    <span class="comment">//실제 배포 시, BOOT-INF/classes가 classpath가 됩니다.</span></span><br><span class="line">    from (<span class="string">&quot;$&#123;asciidoctor.outputDir&#125;/html5&quot;</span>) &#123;</span><br><span class="line">        into <span class="string">&quot;BOOT-INF/classes/static/docs&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">compileKotlin &#123;</span><br><span class="line">    kotlinOptions &#123;</span><br><span class="line">        freeCompilerArgs = [<span class="string">&quot;-Xjsr305=strict&quot;</span>]</span><br><span class="line">        jvmTarget = <span class="string">&quot;1.8&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">compileTestKotlin &#123;</span><br><span class="line">    kotlinOptions &#123;</span><br><span class="line">        freeCompilerArgs = [<span class="string">&quot;-Xjsr305=strict&quot;</span>]</span><br><span class="line">        jvmTarget = <span class="string">&quot;1.8&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">jar.enabled = <span class="literal">false</span></span><br><span class="line">bootJar.enabled = <span class="literal">true</span></span><br><span class="line">bootJar.mainClassName = <span class="string">&#x27;com.example.restdocs.RestdocsApplication&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><code>testImplementation &#39;org.springframework.restdocs:spring-restdocs-mockmvc&#39;</code> : mockMvc 테스트를 통해 API adoc 파일을 생성해주도록 하는 라이브러리 입니다.</li>
<li><code>id &#39;org.asciidoctor.convert&#39; version &#39;1.5.9.2&#39;</code> : asciidoc 파일을 html 파일로 processing 해주는 플러그인 입니다.</li>
<li><code>asciidoctor</code> :  asciidoc 파일을 html 파일로 processing 해주는 Gradle Task를 정의합니다.</li>
</ul>
<h2 id="User-API-코드-작성"><a href="#User-API-코드-작성" class="headerlink" title="User API 코드 작성"></a>User API 코드 작성</h2><h2 id="UserController-kt"><a href="#UserController-kt" class="headerlink" title="UserController.kt"></a>UserController.kt</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Suppress(<span class="string">&quot;SpringJavaInjectionPointsAutowiringInspection&quot;</span>)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(<span class="string">&quot;/user&quot;</span>)</span></span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span></span>(</span><br><span class="line">        <span class="keyword">val</span> userService: UserService</span><br><span class="line">) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@GetMapping(<span class="string">&quot;/&#123;userId&#125;&quot;</span>)</span></span><br><span class="line">  <span class="function"><span class="keyword">fun</span> <span class="title">getUser</span><span class="params">(<span class="meta">@PathVariable(value = <span class="string">&quot;userId&quot;</span>)</span> userId: <span class="type">Long</span>)</span></span>: Response&lt;User&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> searchUser = userService.search(userId)</span><br><span class="line">    <span class="keyword">return</span> Response.success(searchUser)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@PostMapping</span></span><br><span class="line">  <span class="function"><span class="keyword">fun</span> <span class="title">createUser</span><span class="params">(<span class="meta">@RequestBody</span> userDto: <span class="type">UserDto</span>)</span></span>: Response&lt;User&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> createUser = userService.create(User(name = userDto.name, address = userDto.address, age = userDto.age))</span><br><span class="line">    <span class="keyword">return</span> Response.success(createUser)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="meta">@PutMapping(<span class="string">&quot;/&#123;userId&#125;&quot;</span>)</span></span><br><span class="line">  <span class="function"><span class="keyword">fun</span> <span class="title">updateUser</span><span class="params">(<span class="meta">@PathVariable(<span class="string">&quot;userId&quot;</span>)</span> userId: <span class="type">Long</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                 <span class="meta">@RequestBody</span> userDto: <span class="type">UserDto</span>)</span></span>: Response&lt;User&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> updateUser = userService.update(User(id = userId, name = userDto.name, address = userDto.address, age = userDto.age))</span><br><span class="line">    <span class="keyword">return</span> Response.success(updateUser)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@DeleteMapping(<span class="string">&quot;/&#123;userId&#125;&quot;</span>)</span></span><br><span class="line">  <span class="function"><span class="keyword">fun</span> <span class="title">deleteUser</span><span class="params">(<span class="meta">@PathVariable(value = <span class="string">&quot;userId&quot;</span>)</span> userId: <span class="type">Long</span>)</span></span>: Response&lt;<span class="built_in">Unit</span>&gt; &#123;</span><br><span class="line">    userService.delete(userId)</span><br><span class="line">    <span class="keyword">return</span> Response.success()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@PostMapping(<span class="string">&quot;/&#123;userId&#125;/role/&#123;roleId&#125;&quot;</span>)</span></span><br><span class="line">  <span class="function"><span class="keyword">fun</span> <span class="title">grantRole</span><span class="params">(<span class="meta">@PathVariable(value = <span class="string">&quot;userId&quot;</span>)</span> userId: <span class="type">Long</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                <span class="meta">@PathVariable(value = <span class="string">&quot;roleId&quot;</span>)</span> roleId: <span class="type">Long</span>)</span></span>: Response&lt;<span class="built_in">Unit</span>&gt; &#123;</span><br><span class="line">     userService.grantRole(userId = userId, roleId = roleId)</span><br><span class="line">    <span class="keyword">return</span> Response.success()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="UserService-kt"><a href="#UserService-kt" class="headerlink" title="UserService.kt"></a>UserService.kt</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">fun</span> <span class="title">search</span><span class="params">(userId: <span class="type">Long</span>)</span></span>: User?</span><br><span class="line">  <span class="function"><span class="keyword">fun</span> <span class="title">create</span><span class="params">(user: <span class="type">User</span>)</span></span>: User?</span><br><span class="line">  <span class="function"><span class="keyword">fun</span> <span class="title">update</span><span class="params">(user: <span class="type">User</span>)</span></span>: User?</span><br><span class="line">  <span class="function"><span class="keyword">fun</span> <span class="title">delete</span><span class="params">(userId: <span class="type">Long</span>)</span></span></span><br><span class="line">  <span class="function"><span class="keyword">fun</span> <span class="title">grantRole</span><span class="params">(userId: <span class="type">Long</span>, roleId: <span class="type">Long</span>)</span></span>: User?</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Response-kt"><a href="#Response-kt" class="headerlink" title="Response.kt"></a>Response.kt</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Response</span>&lt;<span class="type">T</span>&gt;</span>(</span><br><span class="line">        <span class="keyword">val</span> code: <span class="built_in">Int</span>,</span><br><span class="line">        <span class="keyword">val</span> message: String,</span><br><span class="line">        <span class="keyword">val</span> <span class="keyword">data</span>: T?,</span><br><span class="line">        <span class="keyword">val</span> error: T?</span><br><span class="line">) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">success</span><span class="params">()</span></span>: Response&lt;<span class="built_in">Unit</span>&gt; = success(<span class="literal">null</span>)</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> <span class="title">success</span><span class="params">(<span class="keyword">data</span>: <span class="type">T</span>?)</span></span>: Response&lt;T&gt; = Response(<span class="number">200</span>, <span class="string">&quot;OK&quot;</span>, <span class="keyword">data</span>, <span class="literal">null</span>)</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> <span class="title">error</span><span class="params">(error: <span class="type">T</span>?)</span></span>: Response&lt;T&gt; = Response(<span class="number">500</span>, <span class="string">&quot;Server Error&quot;</span>, <span class="literal">null</span>, error)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="User-kt"><a href="#User-kt" class="headerlink" title="User.kt"></a>User.kt</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>(</span><br><span class="line">        <span class="keyword">val</span> id: <span class="built_in">Long</span>? = <span class="literal">null</span>,</span><br><span class="line">        <span class="keyword">val</span> name: String,</span><br><span class="line">        <span class="keyword">val</span> age: <span class="built_in">Int</span>,</span><br><span class="line">        <span class="keyword">val</span> address: String,</span><br><span class="line">        <span class="keyword">var</span> roles: MutableList&lt;Role&gt; = mutableListOf()</span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<h2 id="Test-코드-작성"><a href="#Test-코드-작성" class="headerlink" title="Test 코드 작성"></a>Test 코드 작성</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExtendWith(RestDocumentationExtension::class, SpringExtension::class)</span> <span class="comment">// (1)</span></span><br><span class="line"><span class="meta">@WebMvcTest(UserController::class, secure = false)</span> <span class="comment">// (2)</span></span><br><span class="line"><span class="meta">@AutoConfigureRestDocs</span> <span class="comment">// (3)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserControllerTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">lateinit</span> <span class="keyword">var</span> mockMvc: MockMvc <span class="comment">// (4)</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@MockBean</span></span><br><span class="line">  <span class="keyword">lateinit</span> <span class="keyword">var</span> userService: UserService <span class="comment">// (5)</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">fun</span> `user search api docs`<span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//given</span></span><br><span class="line">    given(userService.search((eq(<span class="number">1L</span>))))</span><br><span class="line">            .willReturn(User(<span class="number">1</span>, <span class="string">&quot;배달이&quot;</span>, <span class="number">10</span>, <span class="string">&quot;서울특별시 송파구 올림픽로 295&quot;</span>)) <span class="comment">// (6)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//when</span></span><br><span class="line">    <span class="keyword">val</span> resultActions = mockMvc.perform(</span><br><span class="line">            RestDocumentationRequestBuilders.<span class="keyword">get</span>(<span class="string">&quot;/user/&#123;userId&#125;&quot;</span>, <span class="number">1</span>)</span><br><span class="line">                    .header(<span class="string">&quot;x-api-key&quot;</span>, <span class="string">&quot;API-KEY&quot;</span>)</span><br><span class="line">                    .accept(MediaType.APPLICATION_JSON_UTF8)</span><br><span class="line">    ).andDo(MockMvcResultHandlers.print()) <span class="comment">// (7)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//then</span></span><br><span class="line">    resultActions</span><br><span class="line">            .andExpect(status().isOk) <span class="comment">// (8)</span></span><br><span class="line">            .andDo(</span><br><span class="line">                    document(</span><br><span class="line">                            <span class="string">&quot;user-search&quot;</span>, <span class="comment">// (9)</span></span><br><span class="line">                            getDocumentRequest(), <span class="comment">// (10)</span></span><br><span class="line">                            getDocumentResponse(), <span class="comment">// (11)</span></span><br><span class="line">                            requestHeaders(*header()),  <span class="comment">// (12)</span></span><br><span class="line">                      	    pathParameters(userIdPathParameter()),  <span class="comment">// (13)</span></span><br><span class="line">                            responseFields(*common())  <span class="comment">// (14)</span></span><br><span class="line">                                    .andWithPrefix(<span class="string">&quot;data.&quot;</span>, *user()) </span><br><span class="line">                                    .andWithPrefix(<span class="string">&quot;data.roles[].&quot;</span>, *role())</span><br><span class="line">                    )</span><br><span class="line">            )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#123;...&#125; <span class="comment">//중략..</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">getUserDto</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        &quot;name&quot;: &quot;배달이&quot;,</span></span><br><span class="line"><span class="string">        &quot;age&quot;: 10,</span></span><br><span class="line"><span class="string">        &quot;address&quot;: &quot;서울특별시 송파구 올림픽로 295&quot;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>.trimIndent()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">header</span><span class="params">()</span></span>: Array&lt;HeaderDescriptor&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> arrayOf(headerWithName(<span class="string">&quot;x-api-key&quot;</span>).description(<span class="string">&quot;Api Key&quot;</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">userIdPathParameter</span><span class="params">()</span></span>: ParameterDescriptor &#123;</span><br><span class="line">    <span class="keyword">return</span> parameterWithName(<span class="string">&quot;userId&quot;</span>).description(<span class="string">&quot;USER ID&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">roleIdPathParameter</span><span class="params">()</span></span>: ParameterDescriptor &#123;</span><br><span class="line">    <span class="keyword">return</span> parameterWithName(<span class="string">&quot;roleId&quot;</span>).description(<span class="string">&quot;ROLE ID&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">common</span><span class="params">()</span></span>: Array&lt;FieldDescriptor&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> arrayOf(</span><br><span class="line">            fieldWithPath(<span class="string">&quot;code&quot;</span>).type(JsonFieldType.NUMBER).description(<span class="string">&quot;응답 코드&quot;</span>),</span><br><span class="line">            fieldWithPath(<span class="string">&quot;message&quot;</span>).type(JsonFieldType.STRING).description(<span class="string">&quot;응답 메세지&quot;</span>),</span><br><span class="line">            subsectionWithPath(<span class="string">&quot;error&quot;</span>).type(JsonFieldType.OBJECT).description(<span class="string">&quot;에러 Data&quot;</span>).optional(),</span><br><span class="line">            subsectionWithPath(<span class="string">&quot;data&quot;</span>).type(JsonFieldType.OBJECT).description(<span class="string">&quot;응답 Data&quot;</span>).optional()</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">user</span><span class="params">()</span></span>: Array&lt;FieldDescriptor&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> arrayOf(</span><br><span class="line">            fieldWithPath(<span class="string">&quot;id&quot;</span>).type(JsonFieldType.NUMBER).description(<span class="string">&quot;User ID&quot;</span>),</span><br><span class="line">            fieldWithPath(<span class="string">&quot;name&quot;</span>).type(JsonFieldType.STRING).description(<span class="string">&quot;이름&quot;</span>),</span><br><span class="line">            fieldWithPath(<span class="string">&quot;age&quot;</span>).type(JsonFieldType.NUMBER).description(<span class="string">&quot;나이&quot;</span>),</span><br><span class="line">            fieldWithPath(<span class="string">&quot;address&quot;</span>).type(JsonFieldType.STRING).description(<span class="string">&quot;주소&quot;</span>)</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">role</span><span class="params">()</span></span>: Array&lt;FieldDescriptor&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> arrayOf(</span><br><span class="line">            fieldWithPath(<span class="string">&quot;id&quot;</span>).type(JsonFieldType.NUMBER).description(<span class="string">&quot;Role ID&quot;</span>).optional(),</span><br><span class="line">            fieldWithPath(<span class="string">&quot;name&quot;</span>).type(JsonFieldType.STRING).description(<span class="string">&quot;Role명&quot;</span>).optional()</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> RestApiDocumentUtils &#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">fun</span> <span class="title">getDocumentRequest</span><span class="params">()</span></span>: OperationRequestPreprocessor &#123; <span class="comment">// (10)</span></span><br><span class="line">    <span class="keyword">return</span> Preprocessors.preprocessRequest(</span><br><span class="line">            modifyUris()</span><br><span class="line">              .scheme(<span class="string">&quot;http&quot;</span>)</span><br><span class="line">              .host(<span class="string">&quot;user.api.com&quot;</span>)</span><br><span class="line">              .removePort(),</span><br><span class="line">            Preprocessors.prettyPrint()</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">fun</span> <span class="title">getDocumentResponse</span><span class="params">()</span></span>: OperationResponsePreprocessor &#123; <span class="comment">// (11)</span></span><br><span class="line">    <span class="keyword">return</span> Preprocessors.preprocessResponse(Preprocessors.prettyPrint())</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="코드-설명"><a href="#코드-설명" class="headerlink" title="코드 설명"></a>코드 설명</h3><ol>
<li>Junit5에서 Spring Rest Docs를 사용할 때, RestDocumentationExtension::class, SpringExtension::class Extension 두개를 사용합니다.<br>  ExtendWith는 Junit 4 에서 RunWith와 같은 기능입니다.</li>
<li>@WebMvcTest annotation을 사용하여, mockMvc를 사용할 수 있는 환경을 설정합니다.  </li>
<li>이 예제에서는 UserController에 대한 테스트와 API문서를 작성하므로, controller를 UserController로 지정합니다.</li>
<li>spring security를 사용하는 경우, <code>secure=false</code> 옵션을 통해 Spring Security 사용 안함으로 설정할 수 있습니다.</li>
<li>Spring Rest Docs에 대한 Auto Configuration을 설정합니다.</li>
<li>mockMvc를 사용하기 위해 MockMvc bean을 Autowiring 해줍니다.</li>
<li>UserService에 대한 Mocking을 위해 @MockBean annotation을 통해 Test Context에 bean으로 등록해줍니다.</li>
<li>UserService.search() function에 대한 stubbing을 해줍니다. (호출 시, return 되는 값 지정)</li>
<li>mockMvc를 이용하여, <code>GET /user/1</code> API를 호출 합니다.</li>
<li>API 호출 결과에 대해 간단한 status체크 정도로 테스트 항목을 추가했습니다.</li>
<li>andDo function으로 Asciidoc을 생성하도록 설정합니다.<br>  <code>user-search</code>는 테스트가 수행 된 후, adoc 파일이 생성될 디렉토리 이름입니다.<br>  <code>/build/generate-snippets/user-search/*.adoc</code> path에 adoc 파일이 생성됩니다.</li>
<li>DocumentRequest에 대한 설정을 추가합니다.</li>
<li>modifyUris()를 통해 adoc 파일에 어떤 도메인으로 API를 호출 할 지, 정의할 수 있습니다.<br>(Default는 <code>http://localhost:8080</code> 입니다.)</li>
<li>Request Json을 이쁘장하게 출력하도록 해줍니다</li>
<li>DocumentResponse에 대한 설정을 추가합니다.</li>
<li>Response Json을 이쁘장하게 출력하도록 해줍니다</li>
<li>requestHeader 정보를 추가합니다.</li>
<li>path parameter 정보를 추가합니다.</li>
<li>responseFields 정보를 추가합니다.</li>
</ol>
<h2 id="Document-생성하기"><a href="#Document-생성하기" class="headerlink" title="Document 생성하기"></a>Document 생성하기</h2><p>asciidoctor를 이용하면 6개의 snippet 파일을 기본적으로 생성해줍니다.</p>
<h3 id="예시-1"><a href="#예시-1" class="headerlink" title="예시"></a>예시</h3><ul>
<li><code>&lt;output-directory&gt;/&lt;document-name&gt;/curl-request.adoc</code> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[source,bash]</span><br><span class="line">----</span><br><span class="line">$ curl &#x27;http://user.api.com/user/1&#x27; -i -X GET \</span><br><span class="line">    -H &#x27;Accept: application/json;charset=UTF-8&#x27; \</span><br><span class="line">    -H &#x27;x-api-key: API-KEY&#x27;</span><br><span class="line">----</span><br></pre></td></tr></table></figure></li>
<li><code>&lt;output-directory&gt;/&lt;document-name&gt;/http-request.adoc</code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[source,http,options=&quot;nowrap&quot;]</span><br><span class="line">----</span><br><span class="line">GET /user/1 HTTP/1.1</span><br><span class="line">Accept: application/json;charset=UTF-8</span><br><span class="line">Host: user.api.com</span><br><span class="line">x-api-key: API-KEY</span><br><span class="line"></span><br><span class="line">----</span><br></pre></td></tr></table></figure></li>
<li><code>&lt;output-directory&gt;/&lt;document-name&gt;/http-response.adoc</code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[source,http,options=&quot;nowrap&quot;]</span><br><span class="line">----</span><br><span class="line">GET /user/1 HTTP/1.1</span><br><span class="line">Accept: application/json;charset=UTF-8</span><br><span class="line">Host: user.api.com</span><br><span class="line">x-api-key: API-KEY</span><br><span class="line"></span><br><span class="line">----</span><br></pre></td></tr></table></figure></li>
<li><code>&lt;output-directory&gt;/&lt;document-name&gt;/httpie-request.adoc</code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[source,bash]</span><br><span class="line">----</span><br><span class="line">$ http GET &#x27;http://user.api.com/user/1&#x27; \</span><br><span class="line">    &#x27;Accept:application/json;charset=UTF-8&#x27; \</span><br><span class="line">    &#x27;x-api-key:API-KEY&#x27;</span><br><span class="line">----</span><br></pre></td></tr></table></figure></li>
<li><code>&lt;output-directory&gt;/&lt;document-name&gt;/request-body.adoc</code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[source,http,options=&quot;nowrap&quot;]</span><br><span class="line">----</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;홍길동&quot;</span><br><span class="line">&#125;</span><br><span class="line">----</span><br></pre></td></tr></table></figure></li>
<li><code>&lt;output-directory&gt;/&lt;document-name&gt;/response-body.adoc</code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[source,options=&quot;nowrap&quot;]</span><br><span class="line">----</span><br><span class="line">&#123;</span><br><span class="line">  &quot;code&quot; : 200,</span><br><span class="line">  &quot;message&quot; : &quot;OK&quot;,</span><br><span class="line">  &quot;data&quot; : &#123;</span><br><span class="line">    &quot;id&quot; : 1,</span><br><span class="line">    &quot;name&quot; : &quot;배달이&quot;,</span><br><span class="line">    &quot;age&quot; : 10,</span><br><span class="line">    &quot;address&quot; : &quot;서울특별시 송파구 올림픽로 295&quot;,</span><br><span class="line">    &quot;roles&quot; : [ ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;error&quot; : null</span><br><span class="line">&#125;</span><br><span class="line">----</span><br></pre></td></tr></table></figure></li>
</ul>
<p>Optional하게 생성되는 snippet도 존재합니다.</p>
<ul>
<li><code>&lt;output-directory&gt;/&lt;document-name&gt;/path-parameters.adoc.adoc</code> : Path Parameters에 대한 정보를 표로 나타냅니다.</li>
<li><code>&lt;output-directory&gt;/&lt;document-name&gt;/request-headers.adoc.adoc</code> : request header에 대한 정보를 표로 나타냅니다.</li>
<li><code>&lt;output-directory&gt;/&lt;document-name&gt;/request-fieldadoc</code> : request fields에 대한 정보를 표로 나타냅니다.</li>
<li><code>&lt;output-directory&gt;/&lt;document-name&gt;/response-fields.adoc</code> : response fields에 대한 정보를 표로 나타냅니다.</li>
</ul>
<h3 id="API-Document-생성하기"><a href="#API-Document-생성하기" class="headerlink" title="API Document 생성하기"></a>API Document 생성하기</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">ifndef::snippets[]</span><br><span class="line">:snippets: ../../../build/generated-snippets</span><br><span class="line">endif::[]</span><br><span class="line">:doctype: book</span><br><span class="line">:icons: font</span><br><span class="line">:source-highlighter: highlightjs</span><br><span class="line">:toc: left</span><br><span class="line">:toclevels: 4</span><br><span class="line">:sectlinks:</span><br><span class="line">:site-url: /build/asciidoc/html5/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">== Request</span><br><span class="line"></span><br><span class="line">=== [Request URL]</span><br><span class="line">....</span><br><span class="line">GET /user/&#123;userId&#125;</span><br><span class="line">Content-Type: application/json;charset=UTF-8</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">=== [Request Headers]</span><br><span class="line">include::&#123;snippets&#125;/user-search/request-headers.adoc[]</span><br><span class="line"></span><br><span class="line">=== [Request Path Parameters]</span><br><span class="line"></span><br><span class="line">include::&#123;snippets&#125;/user-search/path-parameters.adoc[]</span><br><span class="line"></span><br><span class="line">=== [Request HTTP Example]</span><br><span class="line"></span><br><span class="line">include::&#123;snippets&#125;/user-search/http-request.adoc[]</span><br><span class="line"></span><br><span class="line">== Response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">=== [Response Fields]</span><br><span class="line"></span><br><span class="line">include::&#123;snippets&#125;/user-search/response-fields.adoc[]</span><br><span class="line"></span><br><span class="line">=== [Response HTTP Example]</span><br><span class="line"></span><br><span class="line">include::&#123;snippets&#125;/user-search/http-response.adoc[]</span><br></pre></td></tr></table></figure>
<ul>
<li>&#x2F;src&#x2F;docs&#x2F;asciidoc 디렉토리를 생성하고 user-search.adoc 파일을 생성합니다.</li>
<li>이 파일은 html로 변환될 adoc 파일입니다.</li>
<li>snippet에 대한 path를 지정하고 <code>include::</code> 를 통해 adoc 파일을 include하여 processing 할 수 있습니다.</li>
<li>include 된 파일은 include한 부분에 html 태그로 직접 삽입됩니다.</li>
<li>processing 된 html 파일은 <code>/build/docs/html5</code> 디렉토리에 생성됩니다 (default)</li>
<li>부가적으로 API 문서에 대한 내용을 작성하여 API 문서를 만들 수 있습니다. (ex: API 설명, 담당자, 주의사항)</li>
</ul>
<h1 id="HTML-문서-Serving-해보기"><a href="#HTML-문서-Serving-해보기" class="headerlink" title="HTML 문서 Serving 해보기"></a>HTML 문서 Serving 해보기</h1><p>Spring Rest Docs로 만들어진 API 문서의 최종 형태는 HTML 파일로 제공됩니다.<br>그렇기 때문에 Spring Static Resource Handler를 이용하여 간단하게 html 파일을 Serving하여 웹 브라우져를 통해 사용자에게 API문서를 제공 할 수 있습니다.  </p>
<p>SpringBoot의 WebMvcConfigure를 상속하여 Configuration을 추가합니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.restdocs.configuration</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.<span class="keyword">annotation</span>.Configuration</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.<span class="keyword">annotation</span>.ResourceHandlerRegistry</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.<span class="keyword">annotation</span>.WebMvcConfigurer</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcConfig</span>: <span class="type">WebMvcConfigurer &#123;</span></span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">addResourceHandlers</span><span class="params">(registry: <span class="type">ResourceHandlerRegistry</span>)</span></span> &#123;</span><br><span class="line">    registry.addResourceHandler(<span class="string">&quot;/docs/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/static/docs/&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>위와 같이 설정을 추가하게 되면<br> <code>localhost:8080/docs/index.html</code>  과 같이 <code>/docs/**</code> 패턴으로 유입되는 url에 대해<br>classpath 하위의 &#x2F;static&#x2F;docs&#x2F; 디렉토리 아래의 파일을 찾아 반환하도록 해줍니다.</p>
<p><img src="./static-resource-path.png"></p>
<h1 id="여러가지-Function-사용해보기"><a href="#여러가지-Function-사용해보기" class="headerlink" title="여러가지 Function 사용해보기"></a>여러가지 Function 사용해보기</h1><h2 id="PathParameters"><a href="#PathParameters" class="headerlink" title="PathParameters"></a>PathParameters</h2><ul>
<li>API의 Path Parameter에 대한 Snippet을 생성합니다. </li>
<li>&#x2F;build&#x2F;generated-snippets&#x2F;&lt;document-name&gt;&#x2F;path-parameters.adoc 인 파일명으로 생성됩니다.</li>
<li>pathParameter(parameterWithName(“key 명칭”).description(“key가 의미 하는 내용”)) 으로 코드를 작성합니다.</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">resultActions</span><br><span class="line">            .andExpect(status().isOk)</span><br><span class="line">            .andDo(</span><br><span class="line">                    document(</span><br><span class="line">                            <span class="string">&quot;user-update&quot;</span>,</span><br><span class="line">                            getDocumentRequest(),</span><br><span class="line">                            getDocumentResponse(),</span><br><span class="line">                            requestHeaders(*header()),</span><br><span class="line">                            pathParameters(parameterWithName(<span class="string">&quot;userId&quot;</span>).description(<span class="string">&quot;유저 ID&quot;</span>)),</span><br><span class="line">                            responseFields(*common())</span><br><span class="line">                                    .andWithPrefix(<span class="string">&quot;data.&quot;</span>, *user())</span><br><span class="line">                                    .andWithPrefix(<span class="string">&quot;data.roles[].&quot;</span>, *role())</span><br><span class="line">                    )</span><br><span class="line">            )</span><br></pre></td></tr></table></figure>



<h2 id="requestHeader"><a href="#requestHeader" class="headerlink" title="requestHeader"></a>requestHeader</h2><ul>
<li>API의 Request Header에 대한 Snippet을 생성합니다.</li>
<li>&#x2F;build&#x2F;generated-snippets&#x2F;&lt;document-name&gt;&#x2F;request-headers.adoc 인 파일명으로 생성됩니다.</li>
<li>requestHeader(headerWithName(“header-key명”).description(“header-key가 의미하는 내용”))</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">resultActions</span><br><span class="line">          .andExpect(status().isOk)</span><br><span class="line">          .andDo(</span><br><span class="line">                  document(</span><br><span class="line">                          <span class="string">&quot;user-grant-role&quot;</span>,</span><br><span class="line">                          getDocumentRequest(),</span><br><span class="line">                          getDocumentResponse(),</span><br><span class="line">                          requestHeaders(headerWithName(<span class="string">&quot;api-auth-key&quot;</span>).description(<span class="string">&quot;API 인증 키&quot;</span>)),</span><br><span class="line">                    	  pathParameters(userIdPathParameter(), roleIdPathParameter()),</span><br><span class="line">                          responseFields(*common())</span><br><span class="line">                                  .andWithPrefix(<span class="string">&quot;data.&quot;</span>, *user())</span><br><span class="line">                                  .andWithPrefix(<span class="string">&quot;data.roles[].&quot;</span>, *role())</span><br><span class="line">                  )</span><br><span class="line">          )</span><br></pre></td></tr></table></figure>



<h2 id="fieldWithPath"><a href="#fieldWithPath" class="headerlink" title="fieldWithPath"></a>fieldWithPath</h2><ul>
<li>API의 Request, Response Snippet을 구성하는 요소를 정의하는 가장 기본적인 function입니다.</li>
<li>fieldWithPath(“key”) 형태로 API Request, Response 내의 요소를 정의 할 수 있습니다.</li>
<li>Attributes<ul>
<li>description(“내용”) : Request, Response 내의 요소의 내용을 정의합니다.</li>
<li>type(JsonFieldType.TYPE) : Request, Response 내의 요소의 타입을 정의합니다.</li>
<li>optional() : Request, Response 내의 요소의 필수값 여부를 정의합니다. (optional()를 선언하면 필수값 아님)</li>
</ul>
</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">resultActions</span><br><span class="line">            .andExpect(status().isOk)</span><br><span class="line">            .andDo(</span><br><span class="line">                    document(</span><br><span class="line">                            <span class="string">&quot;user-grant-role&quot;</span>,</span><br><span class="line">                            getDocumentRequest(),</span><br><span class="line">                            getDocumentResponse(),</span><br><span class="line">                            requestHeaders(*header()),</span><br><span class="line">                            pathParameters(userIdPathParameter(), roleIdPathParameter()),</span><br><span class="line">                            responseFields(</span><br><span class="line">                            fieldWithPath(<span class="string">&quot;code&quot;</span>).type(JsonFieldType.NUMBER).description(<span class="string">&quot;응답 코드&quot;</span>),</span><br><span class="line">            		    fieldWithPath(<span class="string">&quot;message&quot;</span>).type(JsonFieldType.STRING).description(<span class="string">&quot;응답 메세지&quot;</span>),</span><br><span class="line">            		    subsectionWithPath(<span class="string">&quot;error&quot;</span>).type(JsonFieldType.OBJECT).description(<span class="string">&quot;에러 Data&quot;</span>).optional(),</span><br><span class="line">            		    subsectionWithPath(<span class="string">&quot;data&quot;</span>).type(JsonFieldType.OBJECT).description(<span class="string">&quot;응답 Data&quot;</span>).optional()</span><br><span class="line">		      )</span><br><span class="line">                      .andWithPrefix(<span class="string">&quot;data.&quot;</span>, *user())</span><br><span class="line">                      .andWithPrefix(<span class="string">&quot;data.roles[].&quot;</span>, *role())</span><br><span class="line">                    )</span><br><span class="line">            )</span><br></pre></td></tr></table></figure>



<h2 id="subSectionWithPath"><a href="#subSectionWithPath" class="headerlink" title="subSectionWithPath"></a>subSectionWithPath</h2><ul>
<li>API Request, Response Snippet을 구성하는 요소를 정의하는 function입니다.</li>
<li>요소의 하위를 선언하고 싶지 않거나, 가변적인 Request, Response가 오는 경우 사용하기 좋습니다.</li>
<li>subSectionWithPath는 root key가 존재하는 지만 체크하고 하위 key에 대한 체크는 하지 않습니다.</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Parameter validation error&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">4000</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;receivers[0].phone&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;010469090&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;errorMessage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;유효하지 않은 수신자 번호입니다.&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>위와 같은 응답이 오는 경우</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">resultActions</span><br><span class="line">            .andExpect(status().isOk)</span><br><span class="line">            .andDo(</span><br><span class="line">                    document(</span><br><span class="line">                            <span class="string">&quot;user-grant-role&quot;</span>,</span><br><span class="line">                            getDocumentRequest(),</span><br><span class="line">                            getDocumentResponse(),</span><br><span class="line">                            requestHeaders(*header()),</span><br><span class="line">                            pathParameters(userIdPathParameter(), roleIdPathParameter()),</span><br><span class="line">                            responseFields(*common())</span><br><span class="line">                                    .and(fieldWithPath(<span class="string">&quot;errors&quot;</span>).type(JsonFieldType.ARRAY).description(<span class="string">&quot;에러 Data&quot;</span>)) <span class="comment">//에러 발생!!</span></span><br><span class="line">                    )</span><br><span class="line">            )</span><br></pre></td></tr></table></figure>

<p>아래와 같은 에러가 발생하게 됩니다.<br>에러 내용을 요약하자면, payload에 있는 정보를 문서화 하지 않았다는 에러입니다.<br>즉, errors 하위에 field, value, errorMessage 정보를 문서화 하지 않았기 때문에 발생하는 에러입니다.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.restdocs.snippet.SnippetException<span class="punctuation">:</span> The following parts of the payload were not documented<span class="punctuation">:</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;errors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;receivers[0].phone&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;010469090&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;errorMessage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;유효하지 않은 수신자 번호입니다.&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>하지만 subSectionWithPath를 사용하게 되면 errors 하위에 대한 정보는 문서화 하지 않겠다!를 의미하므로<br>에러가 발생하지 않고, errors 까지만 문서화 됩니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">resultActions</span><br><span class="line">            .andExpect(status().isOk)</span><br><span class="line">            .andDo(</span><br><span class="line">                    document(</span><br><span class="line">                            <span class="string">&quot;user-grant-role&quot;</span>,</span><br><span class="line">                            getDocumentRequest(),</span><br><span class="line">                            getDocumentResponse(),</span><br><span class="line">                            requestHeaders(*header()),</span><br><span class="line">                            pathParameters(userIdPathParameter(), roleIdPathParameter()),</span><br><span class="line">                            responseFields(*common())</span><br><span class="line">                                    .and(subSectionWithPath(<span class="string">&quot;errors&quot;</span>).type(JsonFieldType.ARRAY).description(<span class="string">&quot;에러 Data&quot;</span>)) </span><br><span class="line">                    )</span><br><span class="line">            )</span><br></pre></td></tr></table></figure>



<h2 id="responseField-and"><a href="#responseField-and" class="headerlink" title="responseField().and()"></a>responseField().and()</h2><ul>
<li>response에 대한 Field정보가 많은 경우 가독성을 해칠 수 있고, Field Snippet에 대한 재사용성이 떨어질 수 있습니다.</li>
<li>이럴때 and를 사용하면 좋습니다.</li>
<li>requestField(), responseField() 함수 뒤에 and() 함수를 사용하여 FieldDescriptor에 대한 Concatenation이 가능합니다.</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;OK&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;배달이&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;서울특별시 송파구 올림픽로 295&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>위와 같이 모든 요소가 1레벨인 Json이 Response로 오는 경우<br>code, message 는 모든 API Response에 대한 공통 요소 입니다.<br>id, name, age, address는 User API Response에만 응답오는 요소라고 할 떄,<br>두 요소에 대한 관리를 별도로 하여 재사용성을 높일 수 있습니다.</p>
<p>아래와 같이 and를 사용하여 Response에 대한 FieldDesciptor를 concatenation 하여 구성할 수 있습니다. </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">resultActions</span><br><span class="line">            .andExpect(status().isOk)</span><br><span class="line">            .andDo(</span><br><span class="line">                    document(</span><br><span class="line">                            <span class="string">&quot;user-update&quot;</span>,</span><br><span class="line">                            getDocumentRequest(),</span><br><span class="line">                            getDocumentResponse(),</span><br><span class="line">                            requestHeaders(*header()),</span><br><span class="line">                            pathParameters(userIdPathParameter()),</span><br><span class="line">                            responseFields(*common())</span><br><span class="line">                                    .and(*user())</span><br><span class="line">                    )</span><br><span class="line">            )</span><br></pre></td></tr></table></figure>



<h2 id="responseField-andWithPrefix"><a href="#responseField-andWithPrefix" class="headerlink" title="responseField().andWithPrefix()"></a>responseField().andWithPrefix()</h2><ul>
<li>and()의 사용예제와 동일합니다.</li>
<li>하지만, andWithPrefix는 key 앞에 prefix를 붙여 depth를 표현할 수 있도록 해줍니다.</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;OK&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  	<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;배달이&quot;</span><span class="punctuation">,</span></span><br><span class="line">  	<span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">  	<span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;서울특별시 송파구 올림픽로 295&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>위와 같이 data에 대한 키가 2레벨인 Json이 Response로 오는 경우<br>아래와 같이 and를 사용하여 Response에 대한 FieldDesciptor를 concatination 하여 구성할 수 있습니다. </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">resultActions</span><br><span class="line">            .andExpect(status().isOk)</span><br><span class="line">            .andDo(</span><br><span class="line">                    document(</span><br><span class="line">                            <span class="string">&quot;user-update&quot;</span>,</span><br><span class="line">                            getDocumentRequest(),</span><br><span class="line">                            getDocumentResponse(),</span><br><span class="line">                            requestHeaders(*header()),</span><br><span class="line">                            pathParameters(userIdPathParameter()),</span><br><span class="line">                            responseFields(*common())</span><br><span class="line">                                    .andWithPrefix(<span class="string">&quot;data.&quot;</span>, *user())</span><br><span class="line">                    )</span><br><span class="line">            )</span><br></pre></td></tr></table></figure>



<h2 id="beneathPath"><a href="#beneathPath" class="headerlink" title="beneathPath"></a>beneathPath</h2><ul>
<li>API를 사용하다 보면 특정 Field의 명세만 별도로 추출하여 문서화 하는 needs가 있을 수 있습니다.</li>
<li>beneathPath(“data-path”) function을 사용하면 특정 data-path에 대한 field를 별도의 snippet으로 생성해 줍니다.</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;OK&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  	<span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;배달이&quot;</span><span class="punctuation">,</span></span><br><span class="line">  	<span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">  	<span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;서울특별시 송파구 올림픽로 295&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">resultActions</span><br><span class="line">            .andExpect(status().isOk)</span><br><span class="line">            .andDo(</span><br><span class="line">                    document(</span><br><span class="line">                            <span class="string">&quot;user-search&quot;</span>,</span><br><span class="line">                            getDocumentRequest(),</span><br><span class="line">                            getDocumentResponse(),</span><br><span class="line">                            requestHeaders(*header()),</span><br><span class="line">                            pathParameters(userIdPathParameter()),</span><br><span class="line">                            responseFields(</span><br><span class="line">                                    beneathPath(<span class="string">&quot;data&quot;</span>).withSubsectionId(<span class="string">&quot;user&quot;</span>),</span><br><span class="line">                                    *user(),</span><br><span class="line">                                    subsectionWithPath(<span class="string">&quot;roles&quot;</span>).description(<span class="string">&quot;User Role&quot;</span>)</span><br><span class="line">                    )</span><br></pre></td></tr></table></figure>
<ul>
<li>data 필드 하위의 내용을 문서화 해줍니다.</li>
<li>beneathPath(“data”) : data 필드 하위의 내용이라는 Path 지정</li>
<li>.withSubsectionId(“user”) : response-fields-user.adoc이라고 SubSectionId로 response-fields.adoc 파일이 별도로 만들어 집니다.</li>
</ul>
<h1 id="Spring-Rest-Docs-추가-기능"><a href="#Spring-Rest-Docs-추가-기능" class="headerlink" title="Spring Rest Docs 추가 기능"></a>Spring Rest Docs 추가 기능</h1><h2 id="Custom-필드-삽입하기"><a href="#Custom-필드-삽입하기" class="headerlink" title="Custom 필드 삽입하기"></a>Custom 필드 삽입하기</h2><ul>
<li>Spring Rest Docs에서 기본적으로 제공하는 path, description, optional, type 이외에 다른 메타정보를 추가하고 싶을 때 Custom 필드를 만들어 사용할 수 있습니다.</li>
<li>AbstractDescriptor에서 제공하는 attributes라는 Map을 이용합니다.</li>
<li>저는 비고, 최대길이라는 필드를 표현하기 위해 Kotlin Extension Function을 이용하여 기능을 추가해보았습니다.</li>
<li>기본적으로 AbstractDescriptor의 attributes라는 Map에 key, value라는 내용을 넣어주면 됩니다.<br>(Java에서는 이 방식을 사용하세요)</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T : AbstractDescriptor&lt;T&gt;</span>&gt; AbstractDescriptor<span class="type">&lt;T&gt;</span>.<span class="title">remarks</span><span class="params">(remarks: <span class="type">String</span>)</span></span>: T &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.attributes(key(<span class="string">&quot;remarks&quot;</span>).value(remarks))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T : AbstractDescriptor&lt;T&gt;</span>&gt; AbstractDescriptor<span class="type">&lt;T&gt;</span>.<span class="title">maxLength</span><span class="params">(length: <span class="type">Int</span>)</span></span>: T &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.attributes(key(<span class="string">&quot;maxLength&quot;</span>).value(length))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">resultActions</span><br><span class="line">            .andExpect(status().isOk)</span><br><span class="line">            .andDo(</span><br><span class="line">                    document(</span><br><span class="line">                            <span class="string">&quot;user-update&quot;</span>,</span><br><span class="line">                            getDocumentRequest(),</span><br><span class="line">                            getDocumentResponse(),</span><br><span class="line">                            requestHeaders(*header()),</span><br><span class="line">                            pathParameters(userIdPathParameter()</span><br><span class="line">                              .maxLength(<span class="number">10</span>)</span><br><span class="line">                              .remarks(<span class="string">&quot;User ID가 없는 경우는 먼저 생성하세요&quot;</span>)),</span><br><span class="line">                            responseFields(*common())</span><br><span class="line">                                    .andWithPrefix(<span class="string">&quot;data.&quot;</span>, *user())</span><br><span class="line">                                    .andWithPrefix(<span class="string">&quot;data.roles[].&quot;</span>, *role())</span><br><span class="line">                    )</span><br><span class="line">            )</span><br></pre></td></tr></table></figure>

<p>위의 예제에서는 일단 ParameterDescriptor에 maxLength와 remark 속성을 추가 했습니다.<br>ParameterDescriptor 뿐만 아니라, AbstractDescriptor를 구현하는 모든 Descriptor에 적용이 가능합니다.<br>(FieldDescriptor, SubsectionDescriptor, HeaderDescriptor등…)</p>
<p>이렇게 추가한 속성을 snippet에 출력해보도록 하겠습니다.<br>위의 예시는 path parameter에 추가한 속성이므로, path-parameters snippet을 override하여 출력해 줄 수 있습니다.  </p>
<h3 id="path-parameters-snippet-override"><a href="#path-parameters-snippet-override" class="headerlink" title="path-parameters snippet override"></a>path-parameters snippet override</h3><ul>
<li>&#x2F;test&#x2F;org&#x2F;springframework&#x2F;restdocs&#x2F;templates 하위에 path-parameters.snippet 파일을 새로 등록합니다.</li>
<li>snippet 파일은 mustache 문법을 사용합니다.</li>
<li>여기에 제가 추가한 최대길이, 비고 컬럼을 추가하였습니다.</li>
<li>mustache 문법 중 <code>#maxLength</code> 문법은 maxLength 속성이 존재하는가? 라는 if문과 비슷한 문법입니다.</li>
<li>반대되는 문법으로 <code>^maxLength</code> 문법은 maxLength 속성이 존재하지 않는가? 라는 문법입니다.</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.+&#123;&#123;path&#125;&#125;+</span><br><span class="line">|===</span><br><span class="line">|Parameter|Description|최대길이|비고</span><br><span class="line">&#123;&#123;#parameters&#125;&#125;</span><br><span class="line">|&#123;&#123;#tableCellContent&#125;&#125;`+&#123;&#123;name&#125;&#125;+`&#123;&#123;/tableCellContent&#125;&#125;</span><br><span class="line">|&#123;&#123;#tableCellContent&#125;&#125;&#123;&#123;description&#125;&#125;&#123;&#123;/tableCellContent&#125;&#125;</span><br><span class="line">|&#123;&#123;#tableCellContent&#125;&#125;&#123;&#123;#maxLength&#125;&#125;&#123;&#123;maxLength&#125;&#125;&#123;&#123;/maxLength&#125;&#125;&#123;&#123;/tableCellContent&#125;&#125;</span><br><span class="line">|&#123;&#123;#tableCellContent&#125;&#125;&#123;&#123;#remarks&#125;&#125;&#123;&#123;remarks&#125;&#125;&#123;&#123;/remarks&#125;&#125;&#123;&#123;/tableCellContent&#125;&#125;</span><br><span class="line">&#123;&#123;/parameters&#125;&#125;</span><br><span class="line">|===</span><br></pre></td></tr></table></figure>

<h3 id="결과"><a href="#결과" class="headerlink" title="결과"></a>결과</h3><p><img src="./add-path-parameter-custom-fields.png" alt="add-path-parameter-custom-fields"></p>
<h2 id="Custom-Snippet-생성하기"><a href="#Custom-Snippet-생성하기" class="headerlink" title="Custom Snippet 생성하기"></a>Custom Snippet 생성하기</h2><p>API 문서를 작성하다 보면, 특정 API와 관계없는 응답코드나, Status 값에 대한 명세를 정의하고 문서화 해야 할 요구사항이 있을 수 있습니다.<br>그런 경우 Custom Snippet을 생성하여 문서화하면, 별도로 응답코드나 Status가 추가되거나 변경되어도 항상 문서를 최신화 할 수 있습니다.</p>
<p>생성해야 할 것은 4가지 입니다.</p>
<ol>
<li>Test 용 Controller</li>
<li>Custom Snippet Template 파일</li>
<li>ResponseCodeSnippet 클래스 (AbstractFieldsSnippet 상속)</li>
<li>Test Code</li>
</ol>
<h3 id="Test용-Controller"><a href="#Test용-Controller" class="headerlink" title="Test용 Controller"></a>Test용 Controller</h3><p>MockMvc 기반에서 생성되는 문서이다 보니 사용하지 않더라도, Test용 Controller가 하나 필요합니다.<br>실제 코드에 영향이 없도록 <code>/test</code> 디렉토리 하위에 Controller를 만들었습니다.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResponseCodeController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@GetMapping(<span class="string">&quot;/response-code&quot;</span>)</span></span><br><span class="line">  <span class="function"><span class="keyword">fun</span> <span class="title">getResponseCode</span><span class="params">()</span></span>: Response&lt;<span class="built_in">Unit</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> Response.success()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Custom-Snippet-Template-파일"><a href="#Custom-Snippet-Template-파일" class="headerlink" title="Custom Snippet Template 파일"></a>Custom Snippet Template 파일</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;title&#125;&#125;</span><br><span class="line">|===</span><br><span class="line">|Code|Message</span><br><span class="line">&#123;&#123;#fields&#125;&#125;</span><br><span class="line">|&#123;&#123;#tableCellContent&#125;&#125;`+&#123;&#123;path&#125;&#125;+`&#123;&#123;/tableCellContent&#125;&#125;</span><br><span class="line">|&#123;&#123;#tableCellContent&#125;&#125;&#123;&#123;description&#125;&#125;&#123;&#123;/tableCellContent&#125;&#125;</span><br><span class="line">&#123;&#123;/fields&#125;&#125;</span><br><span class="line">|===</span><br></pre></td></tr></table></figure>

<ul>
<li>title을 변수로 받아서 출력할 예정입니다.</li>
<li>표에 출력할 필드는 code값과 description입니다.</li>
</ul>
<h3 id="ResponseCodeSnippet-클래스"><a href="#ResponseCodeSnippet-클래스" class="headerlink" title="ResponseCodeSnippet 클래스"></a>ResponseCodeSnippet 클래스</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResponseCodeSnippet</span></span>(</span><br><span class="line">        name: String, </span><br><span class="line">        descriptors: MutableList&lt;FieldDescriptor&gt;,</span><br><span class="line">        attributes: Map&lt;String, Any&gt;,</span><br><span class="line">        ignoreUndocumentedFields: <span class="built_in">Boolean</span></span><br><span class="line">) : AbstractFieldsSnippet(name, descriptors, attributes, ignoreUndocumentedFields) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getContentType</span><span class="params">(operation: <span class="type">Operation</span>)</span></span>: MediaType? &#123;</span><br><span class="line">    <span class="keyword">return</span> operation.response.headers.contentType</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getContent</span><span class="params">(operation: <span class="type">Operation</span>)</span></span>: ByteArray &#123;</span><br><span class="line">    <span class="keyword">return</span> operation.response.content</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>name: 생성할 snippet 템플릿의 prefix입니다. (실제 파일은 {name}-fields.snippet 파일로 생성됩니다.)</li>
</ul>
<p><img src="./AbstractFieldSnippet-Constructor.png" alt="AbstractFieldSnippet-Constructor"></p>
<ul>
<li>descriptors : snippet에 출력될 field 정보들입니다. (예제에서는 ResponseCode 하나하나가 Row가 됩니다.)</li>
<li>attributes: snippet에 출력할 추가적인 속성입니다.</li>
</ul>
<h3 id="Test-Code"><a href="#Test-Code" class="headerlink" title="Test Code"></a>Test Code</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExtendWith(RestDocumentationExtension::class, SpringExtension::class)</span></span><br><span class="line"><span class="meta">@WebMvcTest(ResponseCodeController::class, secure = false)</span></span><br><span class="line"><span class="meta">@AutoConfigureRestDocs</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResponseCodeDocs</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">lateinit</span> <span class="keyword">var</span> mockMvc: MockMvc</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">fun</span> `build response code snippet`<span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    mockMvc.perform(<span class="keyword">get</span>(<span class="string">&quot;/response-code&quot;</span>)</span><br><span class="line">            .accept(MediaType.APPLICATION_JSON)</span><br><span class="line">    ).andDo(MockMvcResultHandlers.print())</span><br><span class="line">            .andExpect(status().isOk)</span><br><span class="line">            .andDo(</span><br><span class="line">                    document(</span><br><span class="line">                            <span class="string">&quot;common&quot;</span>,</span><br><span class="line">                            responseCodeFields(</span><br><span class="line">                                    <span class="string">&quot;response-code&quot;</span>, <span class="comment">//&#123;name&#125;-fields.snippet 이라는 파일명으로 생성</span></span><br><span class="line">                                    Attributes.attributes(Attributes.key(<span class="string">&quot;title&quot;</span>).value(<span class="string">&quot;공통 응답 코드&quot;</span>)),</span><br><span class="line">                                    *convertResponseCodeToFieldDescriptor(ResponseCode.values())</span><br><span class="line">                            )</span><br><span class="line">                    )</span><br><span class="line">            )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">fun</span> <span class="title">responseCodeFields</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">          name: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">          attributes: <span class="type">Map</span>&lt;<span class="type">String</span>, Any&gt;,</span></span></span><br><span class="line"><span class="params"><span class="function">          <span class="keyword">vararg</span> descriptors: <span class="type">FieldDescriptor</span></span></span></span><br><span class="line"><span class="params"><span class="function">  )</span></span>: ResponseCodeSnippet &#123;</span><br><span class="line">    <span class="keyword">return</span> ResponseCodeSnippet(name, mutableListOf(*descriptors), attributes, <span class="literal">true</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">convertResponseCodeToFieldDescriptor</span><span class="params">(enumTypes: <span class="type">Array</span>&lt;<span class="type">ResponseCode</span>&gt;)</span></span>: Array&lt;FieldDescriptor&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> Arrays.stream(enumTypes)</span><br><span class="line">            .map &#123;</span><br><span class="line">              fieldWithPath(it.code.toString()).type(JsonFieldType.NUMBER).description(it.message).optional()</span><br><span class="line">            &#125;</span><br><span class="line">            .collect(Collectors.toList())</span><br><span class="line">            .toTypedArray()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="결과-1"><a href="#결과-1" class="headerlink" title="결과"></a>결과</h3><p><img src="./custom-snippet.png" alt="custom-snippet"></p>
<h3 id="추가"><a href="#추가" class="headerlink" title="추가"></a>추가</h3><p>위의 예시에서는 Custom Field Snippet으로 예시를 들었지만</p>
<ul>
<li>AbstractParametersSnippet</li>
<li>AbstractBodySnippet</li>
<li>AbstractHeadersSnippet</li>
</ul>
<p>위의 AbstractSnippet이 더 있는 걸로 보아 다른 Custom Snippet도 생성할 수 있는 것 같습니다.<br>필요할 때마다 한번씩 써보면 좋겠죠?</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-restdocs/docs/current/reference/html5/#introduction">https://docs.spring.io/spring-restdocs/docs/current/reference/html5/#introduction</a></li>
<li><a target="_blank" rel="noopener" href="https://asciidoctor.org/docs/asciidoctor-gradle-plugin/">https://asciidoctor.org/docs/asciidoctor-gradle-plugin/</a></li>
<li><a target="_blank" rel="noopener" href="https://asciidoctor.org/docs/asciidoc-syntax-quick-reference/">https://asciidoctor.org/docs/asciidoc-syntax-quick-reference/</a></li>
<li><a target="_blank" rel="noopener" href="http://woowabros.github.io/experience/2018/12/28/spring-rest-docs.html">http://woowabros.github.io/experience/2018/12/28/spring-rest-docs.html</a></li>
</ul>
</div></article><div class="post-meta__tag-list"><a class="post-meta__tags" href="../../../../tags/Spring/">Spring</a><a class="post-meta__tags" href="../../../../tags/Spring-Rest-Docs/">Spring-Rest-Docs</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="../../../12/22/2019-12-22-spring-import/"><i class="fa fa-chevron-left">  </i><span>Custom @Enable Annotation 만들어보기</span></a></div><div class="next-post pull-right"><a href="../../../06/23/2019-06-23-event-driven-architecture/"><span>Event-Driven-Architecture란?</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'https://jaehun2841.github.io/2019/08/04/2019-08-04-spring-rest-docs/';
  this.page.identifier = '2019/08/04/2019-08-04-spring-rest-docs/';
  this.page.title = 'Spring Rest Docs를 이용한 API 문서 만들기';
}
var d = document, s = d.createElement('script');
s.src = "https://" + 'Carrey' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2023 By Carrey</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="../../../../js/utils.js?version=1.9.0"></script><script src="../../../../js/fancybox.js?version=1.9.0"></script><script src="../../../../js/sidebar.js?version=1.9.0"></script><script src="../../../../js/copy.js?version=1.9.0"></script><script src="../../../../js/fireworks.js?version=1.9.0"></script><script src="../../../../js/transition.js?version=1.9.0"></script><script src="../../../../js/scroll.js?version=1.9.0"></script><script src="../../../../js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>