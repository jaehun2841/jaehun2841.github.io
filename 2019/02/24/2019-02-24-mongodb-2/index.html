<!DOCTYPE html><html lang="lang"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Mongo DB Aggregation Pipeline"><meta name="keywords" content="MongoDB"><meta name="author" content="Carrey"><meta name="copyright" content="Carrey"><title>Mongo DB Aggregation Pipeline | Carrey`s 기술블로그</title><link rel="shortcut icon" href="../../../../melody-favicon.ico"><link rel="stylesheet" href="../../../../css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '6.0.0'
} </script><meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="rss2.xml" title="Carrey`s 기술블로그" type="application/rss+xml">
</head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Aggregation-Pipeline"><span class="toc-number">1.</span> <span class="toc-text">Aggregation Pipeline</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Stages"><span class="toc-number">2.</span> <span class="toc-text">Stages</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Stages-db-collection-aggregate"><span class="toc-number">2.1.</span> <span class="toc-text">Stages(db.collection.aggregate)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Match"><span class="toc-number">2.2.</span> <span class="toc-text">$Match</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%9E%85%EB%A0%A5-%ED%98%95%EC%8B%9D"><span class="toc-number">2.2.1.</span> <span class="toc-text">입력 형식</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%98%88%EC%A0%9C"><span class="toc-number">2.2.2.</span> <span class="toc-text">예제</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%97%B0%EC%82%B0-%EA%B2%B0%EA%B3%BC"><span class="toc-number">2.2.3.</span> <span class="toc-text">연산 결과</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Group"><span class="toc-number">2.3.</span> <span class="toc-text">$Group</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%9E%85%EB%A0%A5-%ED%98%95%EC%8B%9D-1"><span class="toc-number">2.3.1.</span> <span class="toc-text">입력 형식</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#accumulator"><span class="toc-number">2.3.2.</span> <span class="toc-text">accumulator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%98%88%EC%8B%9C"><span class="toc-number">2.3.3.</span> <span class="toc-text">예시</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%97%B0%EC%82%B0-%EB%85%84-x2F-%EC%9B%94-x2F-%EC%9D%BC%EC%9D%84-%EA%B8%B0%EC%A4%80%EC%9C%BC%EB%A1%9C-group"><span class="toc-number">2.3.4.</span> <span class="toc-text">연산 - 년&#x2F;월&#x2F;일을 기준으로 group</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%97%B0%EC%82%B0-%EA%B2%B0%EA%B3%BC-1"><span class="toc-number">2.3.5.</span> <span class="toc-text">연산 결과</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Project"><span class="toc-number">2.4.</span> <span class="toc-text">$Project</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%9E%85%EB%A0%A5%ED%98%95%EC%8B%9D"><span class="toc-number">2.4.1.</span> <span class="toc-text">입력형식</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%98%88%EC%A0%9C-1"><span class="toc-number">2.4.2.</span> <span class="toc-text">예제</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%97%B0%EC%82%B0-%EA%B2%B0%EA%B3%BC-2"><span class="toc-number">2.4.3.</span> <span class="toc-text">연산 결과</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sort"><span class="toc-number">2.5.</span> <span class="toc-text">$Sort</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%9E%85%EB%A0%A5-%ED%98%95%EC%8B%9D-2"><span class="toc-number">2.5.1.</span> <span class="toc-text">입력 형식</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%98%88%EC%A0%9C-2"><span class="toc-number">2.5.2.</span> <span class="toc-text">예제</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%97%B0%EC%82%B0-%EA%B2%B0%EA%B3%BC-3"><span class="toc-number">2.5.3.</span> <span class="toc-text">연산 결과</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Skip"><span class="toc-number">2.6.</span> <span class="toc-text">$Skip</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%9E%85%EB%A0%A5-%ED%98%95%EC%8B%9D-3"><span class="toc-number">2.6.1.</span> <span class="toc-text">입력 형식</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%98%88%EC%A0%9C-3"><span class="toc-number">2.6.2.</span> <span class="toc-text">예제</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sample"><span class="toc-number">2.7.</span> <span class="toc-text">$Sample</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%9E%85%EB%A0%A5-%ED%98%95%EC%8B%9D-4"><span class="toc-number">2.7.1.</span> <span class="toc-text">입력 형식</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%98%88%EC%A0%9C-4"><span class="toc-number">2.7.2.</span> <span class="toc-text">예제</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%97%B0%EC%82%B0-%EA%B2%B0%EA%B3%BC-4"><span class="toc-number">2.7.3.</span> <span class="toc-text">연산 결과</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Count"><span class="toc-number">2.8.</span> <span class="toc-text">$Count</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%9E%85%EB%A0%A5-%ED%98%95%EC%8B%9D-5"><span class="toc-number">2.8.1.</span> <span class="toc-text">입력 형식</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%98%88%EC%8B%9C-%EC%97%AD%EC%82%AC-%EC%A0%90%EC%88%98-%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B0%80-%EC%9E%88%EC%9D%84%EB%95%8C"><span class="toc-number">2.8.2.</span> <span class="toc-text">예시 - 역사 점수 데이터가 있을때</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#scores-Collection%EC%97%90%EC%84%9C-80%EC%A0%90-%EC%B4%88%EA%B3%BC%EC%9D%B8-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%EC%A1%B0%ED%9A%8C%ED%95%98%EA%B3%A0-%EA%B7%B8%EC%97%90-%EB%8C%80%ED%95%9C-Count%EB%A5%BC-%EA%B3%84%EC%82%B0"><span class="toc-number">2.8.3.</span> <span class="toc-text">scores Collection에서 80점 초과인 데이터를 조회하고 그에 대한 Count를 계산</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%97%B0%EC%82%B0-%EA%B2%B0%EA%B3%BC-5"><span class="toc-number">2.8.4.</span> <span class="toc-text">연산 결과</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#addField"><span class="toc-number">2.9.</span> <span class="toc-text">$addField</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%98%88%EC%8B%9C-score%EB%9D%BC%EB%8A%94-collection%EC%97%90-%EC%95%84%EB%9E%98%EC%99%80-%EA%B0%99%EC%9D%80-%EB%8D%B0%EC%9D%B4%ED%84%B0%EA%B0%80-%EC%9E%88%EC%9D%84%EB%95%8C"><span class="toc-number">2.9.1.</span> <span class="toc-text">예시 - score라는 collection에 아래와 같은 데이터가 있을때</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%A7%91%EA%B3%84-%EC%97%B0%EC%82%B0%EC%9D%84-%ED%95%98%EC%97%AC-homework-quiz-%ED%95%84%EB%93%9C%EC%97%90-%EB%8C%80%ED%95%9C-Array%EC%9D%98-%ED%95%A9%EC%9D%84-%EA%B8%B0%EC%A1%B4-Document%EC%97%90-%EC%B6%94%EA%B0%80"><span class="toc-number">2.9.2.</span> <span class="toc-text">집계 연산을 하여, homework, quiz 필드에 대한 Array의 합을 기존 Document에 추가</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%97%B0%EC%82%B0-%EA%B2%B0%EA%B3%BC-6"><span class="toc-number">2.9.3.</span> <span class="toc-text">연산 결과</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#limit"><span class="toc-number">2.10.</span> <span class="toc-text">$limit</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%9E%85%EB%A0%A5-%ED%98%95%EC%8B%9D-6"><span class="toc-number">2.10.1.</span> <span class="toc-text">입력 형식</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%98%88%EC%A0%9C-5"><span class="toc-number">2.10.2.</span> <span class="toc-text">예제</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#unwind"><span class="toc-number">2.11.</span> <span class="toc-text">$unwind</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%9E%85%EB%A0%A5-%ED%98%95%EC%8B%9D-7"><span class="toc-number">2.11.1.</span> <span class="toc-text">입력 형식</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%98%88%EC%A0%9C-1-%EA%B8%B0%EB%B3%B8-%EC%98%88%EC%A0%9C"><span class="toc-number">2.11.2.</span> <span class="toc-text">예제 1 - 기본 예제</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%97%B0%EC%82%B0-%EA%B2%B0%EA%B3%BC-1"><span class="toc-number">2.11.3.</span> <span class="toc-text">연산 결과 1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%98%88%EC%A0%9C-2-includeArrayIndex-%EC%86%8D%EC%84%B1%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-Index-%EC%B6%9C%EB%A0%A5"><span class="toc-number">2.11.4.</span> <span class="toc-text">예제 2 - includeArrayIndex 속성을 이용한 Index 출력</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%97%B0%EC%82%B0-%EA%B2%B0%EA%B3%BC-2"><span class="toc-number">2.11.5.</span> <span class="toc-text">연산 결과 2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%98%88%EC%A0%9C-3-preserveNullAndEmptyArrays-%EC%86%8D%EC%84%B1%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%B6%9C%EB%A0%A5"><span class="toc-number">2.11.6.</span> <span class="toc-text">예제 3 - preserveNullAndEmptyArrays 속성을 이용한 출력</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%97%B0%EC%82%B0-%EA%B2%B0%EA%B3%BC-3"><span class="toc-number">2.11.7.</span> <span class="toc-text">연산 결과 3</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%EC%B0%B8%EA%B3%A0"><span class="toc-number">3.</span> <span class="toc-text">참고</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://www.gravatar.com/avatar/3f8583b7b0f0c1ebd249dffad42707af?s=300"></div><div class="author-info__name text-center">Carrey</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="../../../../archives"><span class="pull-left">Articles</span><span class="pull-right">115</span></a><a class="author-info-articles__tags article-meta" href="../../../../tags"><span class="pull-left">Tags</span><span class="pull-right">27</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="../../../../index.html">Carrey`s 기술블로그</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">Mongo DB Aggregation Pipeline</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-02-24</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="Aggregation-Pipeline"><a href="#Aggregation-Pipeline" class="headerlink" title="Aggregation Pipeline"></a>Aggregation Pipeline</h1><p>Mongo DB의 Aggregation Framework는 데이터 처리 파이프라인의 개념을 모델로 합니다.<br>문서는 여러 단계의 파이프라인을 거쳐 변화하고 하나의 문서의 형태로 집계할 수 있습니다.</p>
<p><strong>파이프라인(pipeline)</strong> 이란, 이전 단계의 연산결과를 다음 단계연산에 이용하는 것을 의미합니다.</p>
<p><img src="./aggregation-pipeline.svg" alt="aggregation-pipeline"></p>
<h1 id="Stages"><a href="#Stages" class="headerlink" title="Stages"></a>Stages</h1><h2 id="Stages-db-collection-aggregate"><a href="#Stages-db-collection-aggregate" class="headerlink" title="Stages(db.collection.aggregate)"></a>Stages(db.collection.aggregate)</h2><p>db.collection.aggregate 메서드는 파이프라인 단계를 Array의 형태로 나타냅니다.<br>Document는 파이프라인 Array의 순서대로 가공되며, <code>$out</code> 및 <code>$geoNear</code> 를 제외한 모든 단계는 파이프라인에 여러 번 나타날 수 있습니다.</p>
<h2 id="Match"><a href="#Match" class="headerlink" title="$Match"></a>$Match</h2><ul>
<li>조건에 만족하는 Document만 Filtering</li>
</ul>
<h3 id="입력-형식"><a href="#입력-형식" class="headerlink" title="입력 형식"></a>입력 형식</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; $match: &#123; &lt;query&gt; &#125; &#125;</span><br></pre></td></tr></table></figure>

<h3 id="예제"><a href="#예제" class="headerlink" title="예제"></a>예제</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> ObjectId(<span class="string">&quot;512bc95fe835e68f199c8686&quot;</span>)<span class="punctuation">,</span> <span class="attr">&quot;author&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;dave&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="number">80</span><span class="punctuation">,</span> <span class="attr">&quot;views&quot;</span> <span class="punctuation">:</span> <span class="number">100</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> ObjectId(<span class="string">&quot;512bc962e835e68f199c8687&quot;</span>)<span class="punctuation">,</span> <span class="attr">&quot;author&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;dave&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="number">85</span><span class="punctuation">,</span> <span class="attr">&quot;views&quot;</span> <span class="punctuation">:</span> <span class="number">521</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> ObjectId(<span class="string">&quot;55f5a192d4bede9ac365b257&quot;</span>)<span class="punctuation">,</span> <span class="attr">&quot;author&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;ahn&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="number">60</span><span class="punctuation">,</span> <span class="attr">&quot;views&quot;</span> <span class="punctuation">:</span> <span class="number">1000</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> ObjectId(<span class="string">&quot;55f5a192d4bede9ac365b258&quot;</span>)<span class="punctuation">,</span> <span class="attr">&quot;author&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;li&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="number">55</span><span class="punctuation">,</span> <span class="attr">&quot;views&quot;</span> <span class="punctuation">:</span> <span class="number">5000</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> ObjectId(<span class="string">&quot;55f5a1d3d4bede9ac365b259&quot;</span>)<span class="punctuation">,</span> <span class="attr">&quot;author&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;annT&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="number">60</span><span class="punctuation">,</span> <span class="attr">&quot;views&quot;</span> <span class="punctuation">:</span> <span class="number">50</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> ObjectId(<span class="string">&quot;55f5a1d3d4bede9ac365b25a&quot;</span>)<span class="punctuation">,</span> <span class="attr">&quot;author&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;li&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="number">94</span><span class="punctuation">,</span> <span class="attr">&quot;views&quot;</span> <span class="punctuation">:</span> <span class="number">999</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> ObjectId(<span class="string">&quot;55f5a1d3d4bede9ac365b25b&quot;</span>)<span class="punctuation">,</span> <span class="attr">&quot;author&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;ty&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="number">95</span><span class="punctuation">,</span> <span class="attr">&quot;views&quot;</span> <span class="punctuation">:</span> <span class="number">1000</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.articles.aggregate(</span><br><span class="line">    <span class="punctuation">[</span> <span class="punctuation">&#123;</span> $match <span class="punctuation">:</span> <span class="punctuation">&#123;</span> author <span class="punctuation">:</span> <span class="string">&quot;dave&quot;</span> <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span> <span class="punctuation">]</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="연산-결과"><a href="#연산-결과" class="headerlink" title="연산 결과"></a>연산 결과</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> ObjectId(<span class="string">&quot;512bc95fe835e68f199c8686&quot;</span>)<span class="punctuation">,</span> <span class="attr">&quot;author&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;dave&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="number">80</span><span class="punctuation">,</span> <span class="attr">&quot;views&quot;</span> <span class="punctuation">:</span> <span class="number">100</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> ObjectId(<span class="string">&quot;512bc962e835e68f199c8687&quot;</span>)<span class="punctuation">,</span> <span class="attr">&quot;author&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;dave&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="number">85</span><span class="punctuation">,</span> <span class="attr">&quot;views&quot;</span> <span class="punctuation">:</span> <span class="number">521</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h2 id="Group"><a href="#Group" class="headerlink" title="$Group"></a>$Group</h2><ul>
<li>Document에 대한 Grouping 연산을 수행</li>
<li>Group에 대한 id를 지정해야하고, 특정 필드에 대한 집계 연산이 가능</li>
<li>$group은 연산된 Document에 대한 정렬을 지원하지 않음</li>
</ul>
<h3 id="입력-형식-1"><a href="#입력-형식-1" class="headerlink" title="입력 형식"></a>입력 형식</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; $group: &#123; _id: &lt;expression&gt;, &lt;field1&gt;: &#123; &lt;accumulator1&gt; : &lt;expression1&gt; &#125;, ... &#125; &#125;</span><br></pre></td></tr></table></figure>

<h3 id="accumulator"><a href="#accumulator" class="headerlink" title="accumulator"></a>accumulator</h3><table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://docs.mongodb.com/master/reference/operator/aggregation/addToSet/#grp._S_addToSet"><code>$addToSet</code></a></td>
<td>id로 Grouping 한 데이터를 중복되지 않은 Set의 형태로 저장</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.mongodb.com/master/reference/operator/aggregation/avg/#grp._S_avg"><code>$avg</code></a></td>
<td>숫자 값의 평균을 반환. 숫자가 아닌 값을 무시.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.mongodb.com/master/reference/operator/aggregation/first/#grp._S_first"><code>$first</code></a></td>
<td>각 그룹에 대한 첫 번째 Document의 값을 반환. <br />Document가 정의된 순서가 있는 경우에만 ordering을 지원</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.mongodb.com/master/reference/operator/aggregation/last/#grp._S_last"><code>$last</code></a></td>
<td>각 그룹에 대한 마지막 Document의 값을 반환. <br />Document가 정의된 순서가 있는 경우에만 ordering을 지원</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.mongodb.com/master/reference/operator/aggregation/max/#grp._S_max"><code>$max</code></a></td>
<td>각 그룹에서 가장 큰 값을 반환</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.mongodb.com/master/reference/operator/aggregation/mergeObjects/#exp._S_mergeObjects"><code>$mergeObjects</code></a></td>
<td>각 그룹에 대한 입력 Document를 조합하여 작성한 Document를 반환합니다.</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.mongodb.com/master/reference/operator/aggregation/min/#grp._S_min"><code>$min</code></a></td>
<td>각 그룹에서 가장 작은 값을 반환</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.mongodb.com/master/reference/operator/aggregation/push/#grp._S_push"><code>$push</code></a></td>
<td>각 그룹의 필드 값의 배열을 반환</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.mongodb.com/master/reference/operator/aggregation/stdDevPop/#grp._S_stdDevPop"><code>$stdDevPop</code></a></td>
<td>입력 값의 모집단 표준 편차를 반환</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.mongodb.com/master/reference/operator/aggregation/stdDevSamp/#grp._S_stdDevSamp"><code>$stdDevSamp</code></a></td>
<td>입력 값의 샘플 표준 편차를 반환</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://docs.mongodb.com/master/reference/operator/aggregation/sum/#grp._S_sum"><code>$sum</code></a></td>
<td>각 그룹의 숫자형 데이터의 합을 반환. 숫자가 아닌 값은 무시</td>
</tr>
</tbody></table>
<h3 id="예시"><a href="#예시" class="headerlink" title="예시"></a>예시</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="attr">&quot;item&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;abc&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;price&quot;</span> <span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span> <span class="attr">&quot;quantity&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span> <span class="attr">&quot;date&quot;</span> <span class="punctuation">:</span> ISODate(<span class="string">&quot;2014-03-01T08:00:00Z&quot;</span>) <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span> <span class="attr">&quot;item&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;jkl&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;price&quot;</span> <span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span> <span class="attr">&quot;quantity&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="attr">&quot;date&quot;</span> <span class="punctuation">:</span> ISODate(<span class="string">&quot;2014-03-01T09:00:00Z&quot;</span>) <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span> <span class="attr">&quot;item&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;xyz&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;price&quot;</span> <span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span> <span class="attr">&quot;quantity&quot;</span> <span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span> <span class="attr">&quot;date&quot;</span> <span class="punctuation">:</span> ISODate(<span class="string">&quot;2014-03-15T09:00:00Z&quot;</span>) <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span> <span class="attr">&quot;item&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;xyz&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;price&quot;</span> <span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span> <span class="attr">&quot;quantity&quot;</span> <span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span> <span class="attr">&quot;date&quot;</span> <span class="punctuation">:</span> ISODate(<span class="string">&quot;2014-04-04T11:21:39.736Z&quot;</span>) <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span> <span class="attr">&quot;item&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;abc&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;price&quot;</span> <span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span> <span class="attr">&quot;quantity&quot;</span> <span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span> <span class="attr">&quot;date&quot;</span> <span class="punctuation">:</span> ISODate(<span class="string">&quot;2014-04-04T21:23:13.331Z&quot;</span>) <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h3 id="연산-년-x2F-월-x2F-일을-기준으로-group"><a href="#연산-년-x2F-월-x2F-일을-기준으로-group" class="headerlink" title="연산 - 년&#x2F;월&#x2F;일을 기준으로 group"></a>연산 - 년&#x2F;월&#x2F;일을 기준으로 group</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">db.sales.aggregate(</span><br><span class="line">   <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        $group <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">           _id <span class="punctuation">:</span> <span class="punctuation">&#123;</span> month<span class="punctuation">:</span> <span class="punctuation">&#123;</span> $month<span class="punctuation">:</span> <span class="string">&quot;$date&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span> day<span class="punctuation">:</span> <span class="punctuation">&#123;</span> $dayOfMonth<span class="punctuation">:</span> <span class="string">&quot;$date&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span> year<span class="punctuation">:</span> <span class="punctuation">&#123;</span> $year<span class="punctuation">:</span> <span class="string">&quot;$date&quot;</span> <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">           totalPrice<span class="punctuation">:</span> <span class="punctuation">&#123;</span> $sum<span class="punctuation">:</span> <span class="punctuation">&#123;</span> $multiply<span class="punctuation">:</span> <span class="punctuation">[</span> <span class="string">&quot;$price&quot;</span><span class="punctuation">,</span> <span class="string">&quot;$quantity&quot;</span> <span class="punctuation">]</span> <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">           averageQuantity<span class="punctuation">:</span> <span class="punctuation">&#123;</span> $avg<span class="punctuation">:</span> <span class="string">&quot;$quantity&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">           count<span class="punctuation">:</span> <span class="punctuation">&#123;</span> $sum<span class="punctuation">:</span> <span class="number">1</span> <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">]</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li>년&#x2F;월&#x2F;일을 기준으로 집계</li>
<li><code>$price</code> x <code>$quantity</code> 를 곱한 값의 합을 <strong>totalPrice</strong> 필드로 지정</li>
<li><code>$quantity</code> 필드 값의 평균을 <strong>averageQuantity</strong> 필드로 지정</li>
<li>Group별 데이터의 갯수를 <strong>count</strong> 로 지정</li>
</ul>
<h3 id="연산-결과-1"><a href="#연산-결과-1" class="headerlink" title="연산 결과"></a>연산 결과</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> </span><br><span class="line">    <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;month&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span> <span class="attr">&quot;day&quot;</span> <span class="punctuation">:</span> <span class="number">15</span><span class="punctuation">,</span> <span class="attr">&quot;year&quot;</span> <span class="punctuation">:</span> <span class="number">2014</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">    <span class="attr">&quot;totalPrice&quot;</span> <span class="punctuation">:</span> <span class="number">50</span><span class="punctuation">,</span> </span><br><span class="line">    <span class="attr">&quot;averageQuantity&quot;</span> <span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span> </span><br><span class="line">    <span class="attr">&quot;count&quot;</span> <span class="punctuation">:</span> <span class="number">1</span> </span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> </span><br><span class="line">    <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;month&quot;</span> <span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span> <span class="attr">&quot;day&quot;</span> <span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span> <span class="attr">&quot;year&quot;</span> <span class="punctuation">:</span> <span class="number">2014</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">    <span class="attr">&quot;totalPrice&quot;</span> <span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span> </span><br><span class="line">    <span class="attr">&quot;averageQuantity&quot;</span> <span class="punctuation">:</span> <span class="number">15</span><span class="punctuation">,</span> </span><br><span class="line">    <span class="attr">&quot;count&quot;</span> <span class="punctuation">:</span> <span class="number">2</span> </span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> </span><br><span class="line">    <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;month&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span> <span class="attr">&quot;day&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="attr">&quot;year&quot;</span> <span class="punctuation">:</span> <span class="number">2014</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line">    <span class="attr">&quot;totalPrice&quot;</span> <span class="punctuation">:</span> <span class="number">40</span><span class="punctuation">,</span> </span><br><span class="line">    <span class="attr">&quot;averageQuantity&quot;</span> <span class="punctuation">:</span> <span class="number">1.5</span><span class="punctuation">,</span> </span><br><span class="line">    <span class="attr">&quot;count&quot;</span> <span class="punctuation">:</span> <span class="number">2</span> </span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h2 id="Project"><a href="#Project" class="headerlink" title="$Project"></a>$Project</h2><ul>
<li>Project에서 지정한 필드 값을 다음 파이프라인 단계로 전달</li>
<li>RDB의 select 와 같은 역할</li>
<li>Field : 0 - 해당 필드 안보여줌</li>
<li>Filed : 1 - 해당 필드는 보여줌</li>
</ul>
<h3 id="입력형식"><a href="#입력형식" class="headerlink" title="입력형식"></a>입력형식</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; $project: &#123; &lt;specification(s)&gt; &#125; &#125;</span><br></pre></td></tr></table></figure>



<h3 id="예제-1"><a href="#예제-1" class="headerlink" title="예제"></a>예제</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  title<span class="punctuation">:</span> <span class="string">&quot;abc123&quot;</span><span class="punctuation">,</span></span><br><span class="line">  isbn<span class="punctuation">:</span> <span class="string">&quot;0001122223334&quot;</span><span class="punctuation">,</span></span><br><span class="line">  author<span class="punctuation">:</span> <span class="punctuation">&#123;</span> last<span class="punctuation">:</span> <span class="string">&quot;zzz&quot;</span><span class="punctuation">,</span> first<span class="punctuation">:</span> <span class="string">&quot;aaa&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  copies<span class="punctuation">:</span> <span class="number">5</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>title, author 필드만 표시</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.books.aggregate( [ &#123; $project : &#123; title : 1 , author : 1 &#125; &#125; ] )</span><br></pre></td></tr></table></figure>



<h3 id="연산-결과-2"><a href="#연산-결과-2" class="headerlink" title="연산 결과"></a>연산 결과</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="attr">&quot;title&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;abc123&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;author&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;last&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;zzz&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;first&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;aaa&quot;</span> <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h2 id="Sort"><a href="#Sort" class="headerlink" title="$Sort"></a>$Sort</h2><ul>
<li>정렬 조건에 맞게 파이프라인의 연산결과를 정렬</li>
<li>ASC : 1, DESC : -1로 표현</li>
</ul>
<h3 id="입력-형식-2"><a href="#입력-형식-2" class="headerlink" title="입력 형식"></a>입력 형식</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; $sort: &#123; &lt;field1&gt;: &lt;sort order&gt;, &lt;field2&gt;: &lt;sort order&gt; ... &#125; &#125;</span><br></pre></td></tr></table></figure>

<h3 id="예제-2"><a href="#예제-2" class="headerlink" title="예제"></a>예제</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="attr">&quot;subject&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;History&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="number">88</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span> <span class="attr">&quot;subject&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;History&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="number">92</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span> <span class="attr">&quot;subject&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;History&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="number">97</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span> <span class="attr">&quot;subject&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;History&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="number">71</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span> <span class="attr">&quot;subject&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;History&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="number">79</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">6</span><span class="punctuation">,</span> <span class="attr">&quot;subject&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;History&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="number">83</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.users.aggregate(</span><br><span class="line">   <span class="punctuation">[</span></span><br><span class="line">     <span class="punctuation">&#123;</span> $sort <span class="punctuation">:</span> <span class="punctuation">&#123;</span> score <span class="punctuation">:</span> <span class="number">-1</span><span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">]</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<h3 id="연산-결과-3"><a href="#연산-결과-3" class="headerlink" title="연산 결과"></a>연산 결과</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span> <span class="attr">&quot;subject&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;History&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="number">97</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span> <span class="attr">&quot;subject&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;History&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="number">92</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="attr">&quot;subject&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;History&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="number">88</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">6</span><span class="punctuation">,</span> <span class="attr">&quot;subject&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;History&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="number">83</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span> <span class="attr">&quot;subject&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;History&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="number">79</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span> <span class="attr">&quot;subject&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;History&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="number">71</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<h2 id="Skip"><a href="#Skip" class="headerlink" title="$Skip"></a>$Skip</h2><ul>
<li>입력한 갯수만큼 차례대로 Document를 skip 한 데이터를 다음 파이프라인으로 전달</li>
</ul>
<h3 id="입력-형식-3"><a href="#입력-형식-3" class="headerlink" title="입력 형식"></a>입력 형식</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; $skip: &lt;positive integer&gt; &#125;</span><br></pre></td></tr></table></figure>

<h3 id="예제-3"><a href="#예제-3" class="headerlink" title="예제"></a>예제</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.article.aggregate(</span><br><span class="line">    <span class="punctuation">&#123;</span> $skip <span class="punctuation">:</span> <span class="number">5</span> <span class="punctuation">&#125;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>


<h2 id="Sample"><a href="#Sample" class="headerlink" title="$Sample"></a>$Sample</h2><ul>
<li>Collection 내에서 입력한 갯수만큼 Random하게 Document 출력</li>
</ul>
<h3 id="입력-형식-4"><a href="#입력-형식-4" class="headerlink" title="입력 형식"></a>입력 형식</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> $sample<span class="punctuation">:</span> <span class="punctuation">&#123;</span> size<span class="punctuation">:</span> &lt;positive integer&gt; <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h3 id="예제-4"><a href="#예제-4" class="headerlink" title="예제"></a>예제</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;dave123&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;q1&quot;</span> <span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="attr">&quot;q2&quot;</span> <span class="punctuation">:</span> <span class="keyword">true</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;dave2&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;q1&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span> <span class="attr">&quot;q2&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span>  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;ahn&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;q1&quot;</span> <span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="attr">&quot;q2&quot;</span> <span class="punctuation">:</span> <span class="keyword">true</span>  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;li&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;q1&quot;</span> <span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="attr">&quot;q2&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span>  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;annT&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;q1&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span> <span class="attr">&quot;q2&quot;</span> <span class="punctuation">:</span> <span class="keyword">true</span>  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">6</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;li&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;q1&quot;</span> <span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="attr">&quot;q2&quot;</span> <span class="punctuation">:</span> <span class="keyword">true</span>  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">7</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;ty&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;q1&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span> <span class="attr">&quot;q2&quot;</span> <span class="punctuation">:</span> <span class="keyword">true</span>  <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.users.aggregate(</span><br><span class="line">   <span class="punctuation">[</span> <span class="punctuation">&#123;</span> $sample<span class="punctuation">:</span> <span class="punctuation">&#123;</span> size<span class="punctuation">:</span> <span class="number">3</span> <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span> <span class="punctuation">]</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<h3 id="연산-결과-4"><a href="#연산-결과-4" class="headerlink" title="연산 결과"></a>연산 결과</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;dave2&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;q1&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span> <span class="attr">&quot;q2&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span>  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;li&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;q1&quot;</span> <span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="attr">&quot;q2&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span>  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">7</span><span class="punctuation">,</span> <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;ty&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;q1&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span> <span class="attr">&quot;q2&quot;</span> <span class="punctuation">:</span> <span class="keyword">true</span>  <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<h2 id="Count"><a href="#Count" class="headerlink" title="$Count"></a>$Count</h2><ul>
<li>스테이지에 입력하는 문서 수의 카운트가 포함된 문서를 다음 단계로 전달합니다.</li>
</ul>
<h3 id="입력-형식-5"><a href="#입력-형식-5" class="headerlink" title="입력 형식"></a>입력 형식</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> $count<span class="punctuation">:</span> &lt;string&gt; <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h3 id="예시-역사-점수-데이터가-있을때"><a href="#예시-역사-점수-데이터가-있을때" class="headerlink" title="예시 - 역사 점수 데이터가 있을때"></a>예시 - 역사 점수 데이터가 있을때</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="attr">&quot;subject&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;History&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="number">88</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span> <span class="attr">&quot;subject&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;History&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="number">92</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span> <span class="attr">&quot;subject&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;History&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="number">97</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span> <span class="attr">&quot;subject&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;History&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="number">71</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span> <span class="attr">&quot;subject&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;History&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="number">79</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">6</span><span class="punctuation">,</span> <span class="attr">&quot;subject&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;History&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;score&quot;</span> <span class="punctuation">:</span> <span class="number">83</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h3 id="scores-Collection에서-80점-초과인-데이터를-조회하고-그에-대한-Count를-계산"><a href="#scores-Collection에서-80점-초과인-데이터를-조회하고-그에-대한-Count를-계산" class="headerlink" title="scores Collection에서 80점 초과인 데이터를 조회하고 그에 대한 Count를 계산"></a>scores Collection에서 80점 초과인 데이터를 조회하고 그에 대한 Count를 계산</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">db.scores.aggregate(</span><br><span class="line">  <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      $match<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        score<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          $gt<span class="punctuation">:</span> <span class="number">80</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      $count<span class="punctuation">:</span> <span class="string">&quot;passing_scores&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<h3 id="연산-결과-5"><a href="#연산-결과-5" class="headerlink" title="연산 결과"></a>연산 결과</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;passing_scores&quot;</span> <span class="punctuation">:</span> <span class="number">4</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h2 id="addField"><a href="#addField" class="headerlink" title="$addField"></a>$addField</h2><ul>
<li>Document에 새 필드를 추가합니다.</li>
<li>$addFields는 Document 및 새로 추가된 필드에서 모든 기존 필드가 포함된 문서를 출력합니다.</li>
<li>실제 Document의 문서 내용을 바꾸는 것이 아닌 조회를 하는 용도</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> $addFields<span class="punctuation">:</span> <span class="punctuation">&#123;</span> &lt;newField&gt;<span class="punctuation">:</span> &lt;expression&gt;<span class="punctuation">,</span> ... <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h3 id="예시-score라는-collection에-아래와-같은-데이터가-있을때"><a href="#예시-score라는-collection에-아래와-같은-데이터가-있을때" class="headerlink" title="예시 - score라는 collection에 아래와 같은 데이터가 있을때"></a>예시 - score라는 collection에 아래와 같은 데이터가 있을때</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  _id<span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  student<span class="punctuation">:</span> <span class="string">&quot;Maya&quot;</span><span class="punctuation">,</span></span><br><span class="line">  homework<span class="punctuation">:</span> <span class="punctuation">[</span> <span class="number">10</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">,</span> <span class="number">10</span> <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  quiz<span class="punctuation">:</span> <span class="punctuation">[</span> <span class="number">10</span><span class="punctuation">,</span> <span class="number">8</span> <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  extraCredit<span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  _id<span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  student<span class="punctuation">:</span> <span class="string">&quot;Ryan&quot;</span><span class="punctuation">,</span></span><br><span class="line">  homework<span class="punctuation">:</span> <span class="punctuation">[</span> <span class="number">5</span><span class="punctuation">,</span> <span class="number">6</span><span class="punctuation">,</span> <span class="number">5</span> <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  quiz<span class="punctuation">:</span> <span class="punctuation">[</span> <span class="number">8</span><span class="punctuation">,</span> <span class="number">8</span> <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  extraCredit<span class="punctuation">:</span> <span class="number">8</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h3 id="집계-연산을-하여-homework-quiz-필드에-대한-Array의-합을-기존-Document에-추가"><a href="#집계-연산을-하여-homework-quiz-필드에-대한-Array의-합을-기존-Document에-추가" class="headerlink" title="집계 연산을 하여, homework, quiz 필드에 대한 Array의 합을 기존 Document에 추가"></a>집계 연산을 하여, homework, quiz 필드에 대한 Array의 합을 기존 Document에 추가</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">db.scores.aggregate( <span class="punctuation">[</span></span><br><span class="line">   <span class="punctuation">&#123;</span></span><br><span class="line">     $addFields<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">       totalHomework<span class="punctuation">:</span> <span class="punctuation">&#123;</span> $sum<span class="punctuation">:</span> <span class="string">&quot;$homework&quot;</span> <span class="punctuation">&#125;</span> <span class="punctuation">,</span></span><br><span class="line">       totalQuiz<span class="punctuation">:</span> <span class="punctuation">&#123;</span> $sum<span class="punctuation">:</span> <span class="string">&quot;$quiz&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line">     <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="punctuation">&#123;</span></span><br><span class="line">     $addFields<span class="punctuation">:</span> <span class="punctuation">&#123;</span> totalScore<span class="punctuation">:</span></span><br><span class="line">       <span class="punctuation">&#123;</span> $add<span class="punctuation">:</span> <span class="punctuation">[</span> <span class="string">&quot;$totalHomework&quot;</span><span class="punctuation">,</span> <span class="string">&quot;$totalQuiz&quot;</span><span class="punctuation">,</span> <span class="string">&quot;$extraCredit&quot;</span> <span class="punctuation">]</span> <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span> )</span><br></pre></td></tr></table></figure>



<h3 id="연산-결과-6"><a href="#연산-결과-6" class="headerlink" title="연산 결과"></a>연산 결과</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;student&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Maya&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;homework&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span> <span class="number">10</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">,</span> <span class="number">10</span> <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;quiz&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span> <span class="number">10</span><span class="punctuation">,</span> <span class="number">8</span> <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;extraCredit&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;totalHomework&quot;</span> <span class="punctuation">:</span> <span class="number">25</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;totalQuiz&quot;</span> <span class="punctuation">:</span> <span class="number">18</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;totalScore&quot;</span> <span class="punctuation">:</span> <span class="number">43</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;student&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Ryan&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;homework&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span> <span class="number">5</span><span class="punctuation">,</span> <span class="number">6</span><span class="punctuation">,</span> <span class="number">5</span> <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;quiz&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span> <span class="number">8</span><span class="punctuation">,</span> <span class="number">8</span> <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;extraCredit&quot;</span> <span class="punctuation">:</span> <span class="number">8</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;totalHomework&quot;</span> <span class="punctuation">:</span> <span class="number">16</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;totalQuiz&quot;</span> <span class="punctuation">:</span> <span class="number">16</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;totalScore&quot;</span> <span class="punctuation">:</span> <span class="number">40</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h2 id="limit"><a href="#limit" class="headerlink" title="$limit"></a>$limit</h2><ul>
<li>파이프라인 연산으로 출력된 Document의 갯수를 제한</li>
</ul>
<h3 id="입력-형식-6"><a href="#입력-형식-6" class="headerlink" title="입력 형식"></a>입력 형식</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; $limit: &lt;positive integer&gt; &#125;</span><br></pre></td></tr></table></figure>



<h3 id="예제-5"><a href="#예제-5" class="headerlink" title="예제"></a>예제</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.article.aggregate(</span><br><span class="line">    <span class="punctuation">&#123;</span> $limit <span class="punctuation">:</span> <span class="number">5</span> <span class="punctuation">&#125;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<h2 id="unwind"><a href="#unwind" class="headerlink" title="$unwind"></a>$unwind</h2><ul>
<li>Document내의 배열 필드를 기반으로 각각의 Document로 분리</li>
</ul>
<h3 id="입력-형식-7"><a href="#입력-형식-7" class="headerlink" title="입력 형식"></a>입력 형식</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  $unwind<span class="punctuation">:</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      path<span class="punctuation">:</span> &lt;field path&gt;<span class="punctuation">,</span></span><br><span class="line">      includeArrayIndex<span class="punctuation">:</span> &lt;string&gt;<span class="punctuation">,</span></span><br><span class="line">      preserveNullAndEmptyArrays<span class="punctuation">:</span> &lt;boolean&gt;</span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>path</code></td>
<td>string</td>
<td>배열 필드의 필드 경로.<br />필드 경로를 지정하려면 <code>$</code> 기호를 사용하여 필드 이름에 접두사를 붙이고 따옴표로 묶습니다. (ex : <code>&quot;$arrayField&quot;</code>)</td>
</tr>
<tr>
<td><code>includeArrayIndex</code></td>
<td>string</td>
<td>요소의 배열 index값을 저장할 새 필드의 이름. <br />이름은 달러 기호 “$”로 시작할 수 없습니다. (필수 아님)</td>
</tr>
<tr>
<td><code>preserveNullAndEmptyArrays</code></td>
<td>boolean</td>
<td>만약 true로 설정 시, path Field값이 null, 빈 배열인 경우에 <code>$unwind</code> 연산 결과가 Document에 표시 됨.<br />만약 false로 설정 시,<code>$unwind</code> 연산 결과가 Document에 표시 되지 않음. (default false) (필수 아님)</td>
</tr>
</tbody></table>
<h3 id="예제-1-기본-예제"><a href="#예제-1-기본-예제" class="headerlink" title="예제 1 - 기본 예제"></a>예제 1 - 기본 예제</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="attr">&quot;item&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;ABC1&quot;</span><span class="punctuation">,</span> sizes<span class="punctuation">:</span> <span class="punctuation">[</span> <span class="string">&quot;S&quot;</span><span class="punctuation">,</span> <span class="string">&quot;M&quot;</span><span class="punctuation">,</span> <span class="string">&quot;L&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.inventory.aggregate( <span class="punctuation">[</span> <span class="punctuation">&#123;</span> $unwind <span class="punctuation">:</span> <span class="string">&quot;$sizes&quot;</span> <span class="punctuation">&#125;</span> <span class="punctuation">]</span> )</span><br></pre></td></tr></table></figure>



<h3 id="연산-결과-1"><a href="#연산-결과-1" class="headerlink" title="연산 결과 1"></a>연산 결과 1</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="attr">&quot;item&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;ABC1&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;sizes&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;S&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="attr">&quot;item&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;ABC1&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;sizes&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;M&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="attr">&quot;item&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;ABC1&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;sizes&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;L&quot;</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h3 id="예제-2-includeArrayIndex-속성을-이용한-Index-출력"><a href="#예제-2-includeArrayIndex-속성을-이용한-Index-출력" class="headerlink" title="예제 2 - includeArrayIndex 속성을 이용한 Index 출력"></a>예제 2 - includeArrayIndex 속성을 이용한 Index 출력</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="attr">&quot;item&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;ABC&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;sizes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="string">&quot;S&quot;</span><span class="punctuation">,</span> <span class="string">&quot;M&quot;</span><span class="punctuation">,</span> <span class="string">&quot;L&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span> <span class="attr">&quot;item&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;EFG&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;sizes&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span> <span class="punctuation">]</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span> <span class="attr">&quot;item&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;IJK&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;sizes&quot;</span><span class="punctuation">:</span> <span class="string">&quot;M&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span> <span class="attr">&quot;item&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;LMN&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span> <span class="attr">&quot;item&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;XYZ&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;sizes&quot;</span> <span class="punctuation">:</span> <span class="keyword">null</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.inventory.aggregate( <span class="punctuation">[</span> </span><br><span class="line">    <span class="punctuation">&#123;</span> $unwind<span class="punctuation">:</span> <span class="punctuation">&#123;</span> path<span class="punctuation">:</span> <span class="string">&quot;$sizes&quot;</span><span class="punctuation">,</span> includeArrayIndex<span class="punctuation">:</span> <span class="string">&quot;arrayIndex&quot;</span> <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span> </span><br><span class="line"><span class="punctuation">]</span> )</span><br></pre></td></tr></table></figure>



<h3 id="연산-결과-2"><a href="#연산-결과-2" class="headerlink" title="연산 결과 2"></a>연산 결과 2</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="attr">&quot;item&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;ABC&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;sizes&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;S&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;arrayIndex&quot;</span> <span class="punctuation">:</span> NumberLong(<span class="number">0</span>) <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="attr">&quot;item&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;ABC&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;sizes&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;M&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;arrayIndex&quot;</span> <span class="punctuation">:</span> NumberLong(<span class="number">1</span>) <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="attr">&quot;item&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;ABC&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;sizes&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;L&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;arrayIndex&quot;</span> <span class="punctuation">:</span> NumberLong(<span class="number">2</span>) <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span> <span class="attr">&quot;item&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;IJK&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;sizes&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;M&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;arrayIndex&quot;</span> <span class="punctuation">:</span> <span class="keyword">null</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h3 id="예제-3-preserveNullAndEmptyArrays-속성을-이용한-출력"><a href="#예제-3-preserveNullAndEmptyArrays-속성을-이용한-출력" class="headerlink" title="예제 3 - preserveNullAndEmptyArrays 속성을 이용한 출력"></a>예제 3 - preserveNullAndEmptyArrays 속성을 이용한 출력</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="attr">&quot;item&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;ABC&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;sizes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="string">&quot;S&quot;</span><span class="punctuation">,</span> <span class="string">&quot;M&quot;</span><span class="punctuation">,</span> <span class="string">&quot;L&quot;</span><span class="punctuation">]</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span> <span class="attr">&quot;item&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;EFG&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;sizes&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span> <span class="punctuation">]</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span> <span class="attr">&quot;item&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;IJK&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;sizes&quot;</span><span class="punctuation">:</span> <span class="string">&quot;M&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span> <span class="attr">&quot;item&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;LMN&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span> <span class="attr">&quot;item&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;XYZ&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;sizes&quot;</span> <span class="punctuation">:</span> <span class="keyword">null</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.inventory.aggregate( <span class="punctuation">[</span></span><br><span class="line">   <span class="punctuation">&#123;</span> $unwind<span class="punctuation">:</span> <span class="punctuation">&#123;</span> path<span class="punctuation">:</span> <span class="string">&quot;$sizes&quot;</span><span class="punctuation">,</span> preserveNullAndEmptyArrays<span class="punctuation">:</span> <span class="keyword">true</span> <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span> )</span><br></pre></td></tr></table></figure>



<h3 id="연산-결과-3"><a href="#연산-결과-3" class="headerlink" title="연산 결과 3"></a>연산 결과 3</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="attr">&quot;item&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;ABC&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;sizes&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;S&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="attr">&quot;item&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;ABC&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;sizes&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;M&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="attr">&quot;item&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;ABC&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;sizes&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;L&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span> <span class="attr">&quot;item&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;EFG&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span> <span class="attr">&quot;item&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;IJK&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;sizes&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;M&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span> <span class="attr">&quot;item&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;LMN&quot;</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<h1 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h1><ul>
<li><a target="_blank" rel="noopener" href="https://docs.mongodb.com/master/core/aggregation-pipeline/">https://docs.mongodb.com/master/core/aggregation-pipeline/</a></li>
</ul>
</div></article><div class="post-meta__tag-list"><a class="post-meta__tags" href="../../../../tags/MongoDB/">MongoDB</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="../2019-02-24-mongodb-3/"><i class="fa fa-chevron-left">  </i><span>Mongo DB Aggregation Pipeline - SpringBoot에서 사용하기</span></a></div><div class="next-post pull-right"><a href="../effective-java-item56/"><span>Item 56. 공개된 API 요소에는 항상 문서화 주석을 작성하라</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'https://jaehun2841.github.io/2019/02/24/2019-02-24-mongodb-2/';
  this.page.identifier = '2019/02/24/2019-02-24-mongodb-2/';
  this.page.title = 'Mongo DB Aggregation Pipeline';
}
var d = document, s = d.createElement('script');
s.src = "https://" + 'Carrey' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2022 By Carrey</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="../../../../js/utils.js?version=1.9.0"></script><script src="../../../../js/fancybox.js?version=1.9.0"></script><script src="../../../../js/sidebar.js?version=1.9.0"></script><script src="../../../../js/copy.js?version=1.9.0"></script><script src="../../../../js/fireworks.js?version=1.9.0"></script><script src="../../../../js/transition.js?version=1.9.0"></script><script src="../../../../js/scroll.js?version=1.9.0"></script><script src="../../../../js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>