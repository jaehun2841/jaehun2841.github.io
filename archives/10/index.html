<!DOCTYPE html><html lang="lang"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="Carrey"><meta name="copyright" content="Carrey"><title>공부하고, 경험하고, 삽질해서 얻은 지식들을 기록합니다. | Carrey`s 기술블로그</title><link rel="shortcut icon" href="../../melody-favicon.ico"><link rel="stylesheet" href="../../css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '6.0.0'
} </script><meta name="generator" content="Hexo 6.0.0"></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="https://www.gravatar.com/avatar/3f8583b7b0f0c1ebd249dffad42707af?s=300"></div><div class="author-info__name text-center">Carrey</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href=".."><span class="pull-left">Articles</span><span class="pull-right">112</span></a><a class="author-info-articles__tags article-meta" href="../../tags"><span class="pull-left">Tags</span><span class="pull-right">27</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="../../index.html">Carrey`s 기술블로그</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">Carrey`s 기술블로그</div><div id="site-sub-title">공부하고, 경험하고, 삽질해서 얻은 지식들을 기록합니다.</div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="../../2018/11/25/2018-11-25-docker-1/">Docker기반 Redis 구축하기 - (1) Docker란 무엇인가?</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-11-25</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="../../tags/Docker/">Docker</a></span><div class="content"><h1 id="Docker란-무엇인가"><a href="#Docker란-무엇인가" class="headerlink" title="Docker란 무엇인가?"></a>Docker란 무엇인가?</h1><p><img src="./docker-logo.png" alt="docker-logo"></p>
<p>Docker란 <strong>Linux 컨테이너(Container) 기반의 오픈소스 가상화 플랫폼</strong> 입니다.</p>
<p>위의 Docker 이미지처럼 선박에 화물을 수송하는 이미지를 떠올리면 이해하기가 쉬운데, 실제 선박에는 자동차, 오토바이, 전자제품등 여러 물건을 담을 수 있습니다.</p>
<p>선박에 대한 이미지를 유지한 채, Web Service 운영환경을 생각해 보면..<br>Web Service 운영환경을 구성하기 위해서는 Web Application이 구동 될 수 있는 WAS와 DataBase가 필요합니다.</p>
<p>이 2가지 프로그램을 Docker라는 선박에 담는다고 생각해 봅시다.<br>그 다음 우리가 배포할 서버를 항구(Port)라고 생각하고,<br>각 서버에 Web Service 운영환경을 싣고 있는 선박을 정착 시켜 서버에서 접근가능한 서비스로 이용할 수 있습니다. 따라서 어떤 서버에서도 Docker만 설치되어 있다면, 다양한 <code>프로그램과 실행환경을 추상화 하여 동일한 인터페이스를 제공</code>하고 서버관리를 쉽고 단순하게 만들어 줄 수 있습니다.</p>
<p>Docker에서는 <code>Image</code>와 <code>Container</code>라는 개념을 사용하는데, 이 두 가지 개념에 대해 알아보도록 하겠습니다.</p>
<h1 id="Docker-Image"><a href="#Docker-Image" class="headerlink" title="Docker Image"></a>Docker Image</h1><p><img src="./docker-image.png" alt="docker-image"></p>
<p>Docker Image는 우리가 사용할 프로그램을 추상화 한 개념입니다.</p>
<p>Image에는 Container 실행에 필요한 파일(redis.conf, redis.log…., docker-entrypoing.sh등)등을 포함하고,<br>설정값(port, env, data directory등) 정보를 포함하고 있습니다.<br><code>1개의 이미지</code>를 바탕으로<code> 여러 개의 컨테이너</code>를 만들 수 있습니다.<br>(ex. 하나의 Redis 이미지를 바탕으로 3개의 Redis Container를 구성하여 Cluster환경을 구성할 수 있습니다.)<br>이 내용을 좀 더 쉽게 이해하자면, 한번 쯤은 WM에 Linux를 설치 해 본 경험이 있을텐데, Linux를 설치 하기 위해선 linux.iso 파일이 필요 합니다.<br>이때 iso파일이 Linux를 구성하기 위한 파일과 설정 정보를 담고 있고 VM에 Linux를 설치 할 수 있게 해줍니다.<br>여기서 <code>iso파일</code>을 <code>Image</code>라고 생각하고, <code>VM위에 설치되는 리눅스</code>를 <code>Container</code>라고 이해 할 수 있겠습니다.</p>
<p>Docker를 이용한 운영 배포 시, 이미지를 <code>Docker Hub</code>라는 곳에 올려 각 서버에서 받아 사용할 수 있습니다.<br>(Docker Hub는 github나 maven repository 같은 클라우드 저장소 같은 개념으로 이해 하시면 됩니다.)</p>
<h1 id="Docker-Container"><a href="#Docker-Container" class="headerlink" title="Docker Container"></a>Docker Container</h1><p>Container란, <strong>프로그램의 실행에 필요한 실행환경을 독립적으로 운용할 수 있도록, 다른 실행환경과의 간섭을 막고 독립성을 확보해 주는 운영체제 수준의 격리 기술</strong>을 의미합니다.</p>
<p>이러한 격리된 환경이 필요한 경우를 생각해 볼 수 있는데, 극단적인 예시로 Java 1.6 환경에서만 실행되는 프로그램과 Java 1.8이상 환경에서만 실행 되는 프로그램을 하나의 서버에 설치한다고 가정하겠습니다.</p>
<p>프로그램이 실행 되기 위해서는 운영체제에 설치 된 라이브러리의 대해 의존성을 가질 수 밖에 없는데, 하나의 OS에서 Java Version에 대한 격리 환경을 가지게 하는 것은 상당히 번거로운 일입니다.<br>이러한 경우 Docker를 사용하면 격리된 구역에서 실행 환경을 만들어 줄 수 있기 때문에 타 시스템에 영향을 주지 않고 안정적으로 운영환경을 구성 할 수 있습니다.</p>
<p>Docker을 처음 공부할 때 Image와 Container 관계가 무척이나 헷갈렸는데.. 예시를 통해 이해해 보겠습니다.<br>Image는 실행 환경에 대한 파일과 설정 정보를 담고 있다고 했습니다. 그리고 프로그램을 추상화 한 개념이라고 하였습니다.<br>이는 Java의 Class와 같은 개념으로 인식 할 수 있습니다.<br>Container는 Image를 기반으로 생성된 격리 된 실행환경이라 했습니다. 그리고 Container를 실행 할 경우 파라미터를 통해 Container 내부 설정정보를 변경 할 수도 있습니다.<br>이는 Class를 바탕으로 만들어진 Instance의 개념으로 이해 할 수 있습니다.<br>이처럼 Java의 Class와 Instance의 관계로 이해한다면, Docker에서의 Image와 Container 관계에 대해 어렵지 않게 이해 할 수 있을 것 같습니다.</p>
<p><img src="./docking-image.png" alt="docking-image"></p>
<p>도킹에 성공한 Container는 Host OS에 설치 된 프로그램 처럼 사용할 수 있다.</p>
<h1 id="Docker-vs-Virtual-Machine"><a href="#Docker-vs-Virtual-Machine" class="headerlink" title="Docker vs Virtual Machine"></a>Docker vs Virtual Machine</h1><p>위에서 설명하길 “Docker란 <strong>Linux 컨테이너(Container) 기반의 오픈소스 가상화 플랫폼</strong>입니다.” 라고 이야기 하였습니다.<br>가상화라고 하면 대표적인 예가 Virtual Machine 즉 VM을 떠올릴 수 있는데요.</p>
<p>VM과 Docker는 몇가지 차이점이 있습니다.<br>먼저 그림으로 그 구조를 확인해 보겠습니다.</p>
<p><img src="./vm-vs-docker.png" alt="vm-vs-docker"></p>
<p>먼저 VM의 가상화 방식은 기존의 <code>Host OS위에 Hyper Visor를 이용</code>하여 가상화 OS를 띄우는 방식으로 많이 구현했습니다.<br>주로 Windows에서 VMWare, Virtual Box, Hyper-V등 가상화 도구를 이용해 Guest OS를 설치하고 그 OS 위에 우리가 사용하고자 하는 프로그램을 설치하여 사용하였습니다.</p>
<p>이러한 방식은 <code>완벽한 수준의 격리</code>이며, Host OS에서 Guest OS의 프로그램을 직접적으로 제어할 수 없습니다<br>또한 Host OS에서 할당한 자원(Resource)밖에 사용할 수 없기 때문에 Host OS에서도 가상 OS에 점유한 자원을 유동적으로 사용할 수 없어 낭비가 생깁니다.</p>
<p>반면에 Container 방식은 <strong>기존의 Host OS위에 Docker를 이용하여 해당 프로그램의 의존성 라이브러리(프로그램 구동에 필요한 라이브러리)만 가지고 Container가 생성</strong>됩니다. 그렇기에 <code>최소한의 용량으로 이미지를 구성</code> 할 수 있습니다.<br>VM에서 사용되는 OS나 Kernel이 없기 때문에 부팅을 할 필요도 없으며, Host OS의 Resource 또한 유동적으로 사용할 수 있어 자원관리가 효율적입니다.</p>
<p>단순히 프로세스를 격리시키는 것이기 때문에 <code>VM에 비해 매우 빠르게 동작</code>합니다.<br>단점인 부분은 <strong>Host OS에 종속적인 부분이 있습니다.</strong><br>VM방식의 경우 각각의 OS에 대한 독립성을 가지고 있어, Host OS에 대해 독립적입니다. (예를들어 Host OS가 리눅스이고, Guest OS가 Windows인 경우, MSSQL을 Guest OS에서 사용할 수 있다)<br>하지만 Container방식은 Host OS의 자원을 기반으로 생성 되기 때문에 <code>Host OS에서 작동할 수 없는 프로그램은 Container 내부에서 작동 할 수 없습니다.</code></p>
<h1 id="Docker-for-XX"><a href="#Docker-for-XX" class="headerlink" title="Docker for XX"></a>Docker for XX</h1><p>Docker는 리눅스 컨테이너 기반으로 동작하지만 최근 Windows와 Mac에 대해서도 Docker를 지원하고 있습니다.<br>하지만 Linux기반 Docker와 조금 차이점이 있습니다.<br>아무래도 Linux 기반 컨테이너이기 때문에 Windows에서는 Hyper-V에 리눅스를 설치하여 연동되게 되어있습니다.<br>이 경우 Host OS가 Windows가 되는 것이 아니라, Hyper-V의 리눅스가 Host OS가 되는 것이기 때문에 Hyper-V에 할당된 메모리와 디스크 용량을 기반으로 자원을 활용하게 됩니다.<br>Linux가 아닌 다른 운영체제에서 Docker 설치 시 유의해야 할 부분입니다.</p>
<h1 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h1><ul>
<li><p><a target="_blank" rel="noopener" href="http://www.sauru.so/blog/getting-started-with-docker/">http://www.sauru.so/blog/getting-started-with-docker/</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://www.sauru.so/blog/getting-started-with-docker/">http://www.sauru.so/blog/getting-started-with-docker/</a>     </p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html">https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.docker.com/enterprise-edition#/platform">https://www.docker.com/enterprise-edition#/platform</a></p>
</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="../../2018/11/25/2018-11-25-spel-expression-2/">SpEL Expression(2)</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-11-25</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="../../tags/Spring/">Spring</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="../../tags/SpEL/">SpEL</a></span><div class="content"><h1 id="리터럴-표현식-Literal-Expression"><a href="#리터럴-표현식-Literal-Expression" class="headerlink" title="리터럴 표현식 (Literal Expression)"></a>리터럴 표현식 (Literal Expression)</h1><p>리터럴 표현식을 제공하는 타입은 문자열(String), 숫자(int, real, hex), boolean, null이다.</p>
<ul>
<li>문자열 (Strings)는 따옴표(‘)로 구분된다 <code>(쌍따옴표가 아님)</code> - 문자열 표현 시, <code>&#39;Hello World&#39;</code> 처럼 SpEL을 작성</li>
</ul>
<p>다음은 리터럴 표현식 (Literal Expression)에 대한 간단한 예제이다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//따옴표로 이루어진 &#x27;Hello World&#x27; =&gt; Hello World라는 문자열로 평가 된다.</span></span><br><span class="line"><span class="type">String</span> <span class="variable">helloWorld</span> <span class="operator">=</span> (String) parser.parseExpression(<span class="string">&quot;&#x27;Hello World&#x27;&quot;</span>).getValue();</span><br><span class="line"><span class="comment">//Double 타입의 숫자로 평가</span></span><br><span class="line"><span class="type">double</span> <span class="variable">avogadrosNumber</span> <span class="operator">=</span> (Double) parser.parseExpression(<span class="string">&quot;6.0221415E+23&quot;</span>).getValue();</span><br><span class="line"><span class="comment">//2147483647로 평가</span></span><br><span class="line"><span class="type">int</span> <span class="variable">maxValue</span> <span class="operator">=</span> (Integer) parser.parseExpression(<span class="string">&quot;0x7FFFFFFF&quot;</span>).getValue();</span><br><span class="line"></span><br><span class="line"><span class="type">boolean</span> <span class="variable">trueValue</span> <span class="operator">=</span> (Boolean) parser.parseExpression(<span class="string">&quot;true&quot;</span>).getValue();</span><br><span class="line"><span class="comment">//null로 평가 된다. -&gt; null String이 아니다. (주의)</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">nullValue</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;null&quot;</span>).getValue();</span><br></pre></td></tr></table></figure>

<ul>
<li>숫자는 음수기호(-), 지수표시(E), 소수점(.)을 지원한다.</li>
<li>기본적으로 실제 숫자는 Double.parseDouble()로 파싱한다.</li>
</ul>
<h1 id="메서드-호출"><a href="#메서드-호출" class="headerlink" title="메서드 호출"></a>메서드 호출</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//String 리터럴 abc에 대한 substring 메서드 호출 -&gt; bc가 리턴된다.</span></span><br><span class="line"><span class="type">String</span> <span class="variable">c</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;&#x27;abc&#x27;.substring(2, 3)&quot;</span>).getValue(String.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">//사용자 정의 메서드 호출 (Return Type : Boolean) -&gt; boolean 타입으로 평가된다.</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">isMember</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;isMember(&#x27;Mihajlo Pupin&#x27;)&quot;</span>).getValue(</span><br><span class="line">        societyContext, Boolean.class);</span><br></pre></td></tr></table></figure>

<p>위의 코드는 메서드 호출에 대한 예제 코드이다.</p>
<ul>
<li>메서드는 Java 문법을 사용하여 호출 할 수 있다.</li>
<li>Literal에 대한 메서드 호출도 가능하다.</li>
<li>Varargs 형식의 파라미터도 지원하고 있다.</li>
</ul>
<h1 id="프로퍼티-배열-리스트-맵에-대한-접근-지원"><a href="#프로퍼티-배열-리스트-맵에-대한-접근-지원" class="headerlink" title="프로퍼티, 배열, 리스트, 맵에 대한 접근 지원"></a>프로퍼티, 배열, 리스트, 맵에 대한 접근 지원</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 발명품 배열</span></span><br><span class="line"><span class="type">StandardEvaluationContext</span> <span class="variable">teslaContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardEvaluationContext</span>(tesla);</span><br><span class="line"></span><br><span class="line"><span class="comment">// &quot;Induction motor&quot;로 평가된다.</span></span><br><span class="line"><span class="type">String</span> <span class="variable">invention</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;inventions[3]&quot;</span>).getValue(teslaContext, String.class); </span><br><span class="line"></span><br><span class="line"><span class="comment">// 회원 리스트</span></span><br><span class="line"><span class="type">StandardEvaluationContext</span> <span class="variable">societyContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardEvaluationContext</span>(ieee);</span><br><span class="line"></span><br><span class="line"><span class="comment">// &quot;Nikola Tesla&quot;로 평가된다.</span></span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;Members[0].Name&quot;</span>).getValue(societyContext, String.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 리스트와 배열 탐색</span></span><br><span class="line"><span class="comment">// &quot;Wireless communication&quot;로 평가된다.</span></span><br><span class="line"><span class="type">String</span> <span class="variable">invention</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;Members[0].Inventions[6]&quot;</span>).getValue(societyContext, String.class);</span><br></pre></td></tr></table></figure>

<ul>
<li>프로퍼티의 맨 첫글자는 대소문자를 구별하지 않는다.</li>
<li>SpEL은 표준 <code>dot 표기법</code>(예: prop1.prop2.prop3)을 사용해서 중첩된 프로퍼티와 프로퍼티의 값 설정도 지원한다.</li>
<li>public 필드에 대한 접근을 지원한다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Officer의 딕션어리</span></span><br><span class="line"><span class="type">Inventor</span> <span class="variable">pupin</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;Officers[&#x27;president&#x27;]&quot;</span>).getValue(societyContext, Inventor.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// &quot;Idvor&quot;로 평가된다</span></span><br><span class="line"><span class="type">String</span> <span class="variable">city</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;Officers[&#x27;president&#x27;].PlaceOfBirth.City&quot;</span>).getValue(societyContext, String.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 값을 설정한다</span></span><br><span class="line">parser.parseExpression(<span class="string">&quot;Officers[&#x27;advisors&#x27;][0].PlaceOfBirth.Country&quot;</span>).setValue(societyContext, <span class="string">&quot;Croatia&quot;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>대괄호<code>[]</code> 를 사용하여 Map의 key를 바탕으로 데이터에 접근한다.<br>(위의 예제에서는 Officers가 <code>Map</code>, president가 <code>key</code>이다.)</li>
<li>SpEL은 표준 ‘dot’ 표기법 (예: prop1.prop2.prop3)을 사용해서 Map내의 value 객체의 프로퍼티에도 접근 가능하다.</li>
<li>setValue 메서드를 통해 데이터를 수정할 수 있다.</li>
</ul>
<h1 id="인라인-리스트-Inline-list"><a href="#인라인-리스트-Inline-list" class="headerlink" title="인라인 리스트 (Inline list)"></a>인라인 리스트 (Inline list)</h1><p>리스트는 {} 표기법을 사용하여 리스트로 사용 할 수 있다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4개의 숫자를 담고 있는 리스트로 평가된다</span></span><br><span class="line">List&lt;Integer&gt; numbers = (List) parser.parseExpression(<span class="string">&quot;&#123;1,2,3,4&#125;&quot;</span>).getValue(context); </span><br><span class="line"></span><br><span class="line"><span class="comment">//List의 List의 형태의 List로 평가된다.</span></span><br><span class="line"><span class="comment">//listOfLists[0] = &#123;&#x27;a&#x27;, &#x27;b&#x27;&#125;</span></span><br><span class="line"><span class="comment">//listOfLists[1] = &#123;&#x27;x&#x27;, &#x27;y&#x27;&#125;</span></span><br><span class="line"><span class="type">List</span> <span class="variable">listOfLists</span> <span class="operator">=</span> (List) parser.parseExpression(<span class="string">&quot;&#123;&#123;&#x27;a&#x27;,&#x27;b&#x27;&#125;,&#123;&#x27;x&#x27;,&#x27;y&#x27;&#125;&#125;&quot;</span>).getValue(context);</span><br></pre></td></tr></table></figure>

<h1 id="배열-생성"><a href="#배열-생성" class="headerlink" title="배열 생성"></a>배열 생성</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] numbers1 = (<span class="type">int</span>[]) parser.parseExpression(<span class="string">&quot;new int[4]&quot;</span>).getValue(context); </span><br><span class="line"></span><br><span class="line"><span class="comment">// initializer가진 배열</span></span><br><span class="line"><span class="type">int</span>[] numbers2 = (<span class="type">int</span>[]) parser.parseExpression(<span class="string">&quot;new int[]&#123;1,2,3&#125;&quot;</span>).getValue(context); </span><br><span class="line"></span><br><span class="line"><span class="comment">// 다차원 배열</span></span><br><span class="line"><span class="type">int</span>[][] numbers3 = (<span class="type">int</span>[][]) parser.parseExpression(<span class="string">&quot;new int[4][5]&quot;</span>).getValue(context);</span><br></pre></td></tr></table></figure>

<ul>
<li>Java 문법과 같은 표현식을 사용하여 배열을 생성 할 수 있다.</li>
<li>{} 표현식을 통해 초기값을 세팅할 수 있다.</li>
<li>2차원 배열이상의 다차원 배열도 선언이 가능하다. (<code>단, 다차원 배열은 초기값을 설정할 수 없다.</code>)</li>
</ul>
<h1 id="연산자"><a href="#연산자" class="headerlink" title="연산자"></a>연산자</h1><h2 id="관계-연산자"><a href="#관계-연산자" class="headerlink" title="관계 연산자"></a>관계 연산자</h2><p>표준 관계 연산자를 사용한다. 사용 할 수 있는 관계 연산자는 아래와 같다.</p>
<ul>
<li>같음 (<code>==</code>)</li>
<li>같지 않음 (<code>!=</code>)</li>
<li>작음 (<code>&lt;</code>)</li>
<li>작거나 같음 (<code>&lt;=</code>)</li>
<li>큼 (<code>&gt;</code>)</li>
<li>크거나 같음 (<code>&gt;=</code>)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// true로 평가된다</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">trueValue</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;2 == 2&quot;</span>).getValue(Boolean.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// false로 평가된다</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">falseValue</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;2 &lt; -5.0&quot;</span>).getValue(Boolean.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// true로 평가된다</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">trueValue</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;&#x27;black&#x27; &lt; &#x27;block&#x27;&quot;</span>).getValue(Boolean.class);</span><br></pre></td></tr></table></figure>

<h2 id="심볼릭-연산자"><a href="#심볼릭-연산자" class="headerlink" title="심볼릭 연산자"></a>심볼릭 연산자</h2><p>XML과 같이 문서형식에 관계 연산자가 제한을 받는 경우, 사용 가능한 문자 표현식을 제공한다.<br>연산자에 대한 대소문자는 구별하지 않는다.</p>
<ul>
<li>같음 (<code>eq</code>)</li>
<li>같지 않음 (<code>ne</code>)</li>
<li>작음 (<code>lt</code>)</li>
<li>작거나 같음 (<code>le</code>)</li>
<li>큼 (<code>gt</code>)</li>
<li>크거나 같음 (<code>gt</code>)</li>
<li>div (<code>/</code>)</li>
<li>mod (<code>%</code>)</li>
<li>not (<code>!</code>)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// true로 평가된다</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">trueValue</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;22 eq 22&quot;</span>).getValue(Boolean.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// false로 평가된다</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">falseValue</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;&#x27;test&#x27; eq &#x27;test!&#x27;&quot;</span>).getValue(Boolean.class);</span><br></pre></td></tr></table></figure>

<h2 id="정규-표현식"><a href="#정규-표현식" class="headerlink" title="정규 표현식"></a>정규 표현식</h2><p>matches를 이용한 정규표현식을 지원한다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// true로 평가된다</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">trueValue</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;&#x27;5.00&#x27; matches &#x27;^-?\\d+(\\.\\d&#123;2&#125;)?$&#x27;&quot;</span>).getValue(Boolean.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// false로 평가된다</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">falseValue</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;&#x27;5.0067&#x27; matches &#x27;^-?\\d+(\\.\\d&#123;2&#125;)?$&#x27;&quot;</span>).getValue(Boolean.class);</span><br></pre></td></tr></table></figure>

<h2 id="instanceof"><a href="#instanceof" class="headerlink" title="instanceof"></a>instanceof</h2><p>Java에서 super타입에 대한 연산을 위해 instanceof를 표현식으로 사용할 수 있다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// false로 평가된다</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">falseValue</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;&#x27;xyz&#x27; instanceof T(int)&quot;</span>).getValue(Boolean.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// true로 평가된다.</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">trueValue</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;&#x27;xyz&#x27; instanceof T(String)&quot;</span>).getValue(Boolean.class);</span><br></pre></td></tr></table></figure>

<h2 id="논리연산자"><a href="#논리연산자" class="headerlink" title="논리연산자"></a>논리연산자</h2><p>AND, OR, NOT에 대한 표현식을 지원한다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -- AND --</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// false로 평가된다</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">falseValue</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;true and false&quot;</span>).getValue(Boolean.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// true로 평가된다</span></span><br><span class="line"><span class="type">String</span> <span class="variable">expression</span> <span class="operator">=</span>  <span class="string">&quot;isMember(&#x27;Nikola Tesla&#x27;) and isMember(&#x27;Mihajlo Pupin&#x27;)&quot;</span>;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">trueValue</span> <span class="operator">=</span> parser.parseExpression(expression).getValue(societyContext, Boolean.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// -- OR --</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// true로 평가된다</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">trueValue</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;true or false&quot;</span>).getValue(Boolean.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// true로 평가된다</span></span><br><span class="line"><span class="type">String</span> <span class="variable">expression</span> <span class="operator">=</span>  <span class="string">&quot;isMember(&#x27;Nikola Tesla&#x27;) or isMember(&#x27;Albert Einstien&#x27;)&quot;</span>;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">trueValue</span> <span class="operator">=</span> parser.parseExpression(expression).getValue(societyContext, Boolean.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// -- NOT --</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// false로 평가된다</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">falseValue</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;!true&quot;</span>).getValue(Boolean.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// -- AND and NOT --</span></span><br><span class="line"><span class="type">String</span> <span class="variable">expression</span> <span class="operator">=</span>  <span class="string">&quot;isMember(&#x27;Nikola Tesla&#x27;) and !isMember(&#x27;Mihajlo Pupin&#x27;)&quot;</span>;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">falseValue</span> <span class="operator">=</span> parser.parseExpression(expression).getValue(societyContext, Boolean.class);</span><br></pre></td></tr></table></figure>

<h2 id="수식-연산자"><a href="#수식-연산자" class="headerlink" title="수식 연산자"></a>수식 연산자</h2><ul>
<li>더하기 (+) 연산자를 숫자, 날짜, 문자열에 사용할 수 있다.</li>
<li>빼기(-) 연산자를 숫자, 날짜에 사용할 수 있다.</li>
<li>곱하기(*), 나누기(&#x2F;), 나머지(%)에 대한 연산은 숫자에만 사용 할 수 있다.</li>
<li>연산자 우선 순위 법칙이 적용된다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 더하기</span></span><br><span class="line"><span class="type">int</span> <span class="variable">two</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;1 + 1&quot;</span>).getValue(Integer.class); <span class="comment">// 2</span></span><br><span class="line"><span class="type">String</span> <span class="variable">testString</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;&#x27;test&#x27; + &#x27; &#x27; + &#x27;string&#x27;&quot;</span>).getValue(String.class);  <span class="comment">// &#x27;test string&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 빼기</span></span><br><span class="line"><span class="type">int</span> <span class="variable">four</span> <span class="operator">=</span>  parser.parseExpression(<span class="string">&quot;1 - -3&quot;</span>).getValue(Integer.class); <span class="comment">// 4</span></span><br><span class="line"><span class="type">double</span> <span class="variable">d</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;1000.00 - 1e4&quot;</span>).getValue(Double.class); <span class="comment">// -9000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 곱하기</span></span><br><span class="line"><span class="type">int</span> <span class="variable">six</span> <span class="operator">=</span>  parser.parseExpression(<span class="string">&quot;-2 * -3&quot;</span>).getValue(Integer.class); <span class="comment">// 6</span></span><br><span class="line"><span class="type">double</span> <span class="variable">twentyFour</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;2.0 * 3e0 * 4&quot;</span>).getValue(Double.class); <span class="comment">// 24.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 나누기</span></span><br><span class="line"><span class="type">int</span> <span class="variable">minusTwo</span> <span class="operator">=</span>  parser.parseExpression(<span class="string">&quot;6 / -3&quot;</span>).getValue(Integer.class); <span class="comment">// -2</span></span><br><span class="line"><span class="type">double</span> <span class="variable">one</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;8.0 / 4e0 / 2&quot;</span>).getValue(Double.class); <span class="comment">// 1.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 계수(Modulus)</span></span><br><span class="line"><span class="type">int</span> <span class="variable">three</span> <span class="operator">=</span>  parser.parseExpression(<span class="string">&quot;7 % 4&quot;</span>).getValue(Integer.class); <span class="comment">// 3</span></span><br><span class="line"><span class="type">int</span> <span class="variable">one</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;8 / 5 % 2&quot;</span>).getValue(Integer.class); <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 연산자 우선순위</span></span><br><span class="line"><span class="type">int</span> <span class="variable">minusTwentyOne</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;1+2-3*8&quot;</span>).getValue(Integer.class); <span class="comment">// -21</span></span><br></pre></td></tr></table></figure>

<h2 id="3항-연산자-If-Then-Else"><a href="#3항-연산자-If-Then-Else" class="headerlink" title="3항 연산자 (If-Then-Else)"></a>3항 연산자 (If-Then-Else)</h2><p>표현식에서 3항연산자를 통해 if-then-else 로직을 수행할 수 있다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//falseExp로 평가 된다.</span></span><br><span class="line"><span class="type">String</span> <span class="variable">falseString</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;false ? &#x27;trueExp&#x27; : &#x27;falseExp&#x27;&quot;</span>).getValue(String.class);</span><br></pre></td></tr></table></figure>

<h2 id="Elvis-연산자"><a href="#Elvis-연산자" class="headerlink" title="Elvis 연산자"></a>Elvis 연산자</h2><ul>
<li>Elvis 연산자는 3항 연산자 구문을 단축시키고 Groovy 언어로 사용된다.</li>
<li>3항 연산자는 변수를 2번 반복해서 써야하는 단점이 있다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;Elvis Presley&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">displayName</span> <span class="operator">=</span> name != <span class="literal">null</span> ? name : <span class="string">&quot;Unknown&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>이런 조잡한 표현식 대신에 Elvis 연산자를 사용하면..</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();</span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;name?:&#x27;Unknown&#x27;&quot;</span>).getValue(String.class);  </span><br><span class="line">System.out.println(name); <span class="comment">// &#x27;Unknown&#x27;</span></span><br></pre></td></tr></table></figure>

<p>간단하게 변수에 대해 <code>?</code> 를 붙여주는 것만으로도 null 체크를 해준다.<br>? 모양이 엘비스 프레슬리의 머리모양을 닮아서 Elvis 연산자라고 명명하였다고 한다.</p>
<h2 id="안전한탐색-Navigation-연산자"><a href="#안전한탐색-Navigation-연산자" class="headerlink" title="안전한탐색(Navigation) 연산자"></a>안전한탐색(Navigation) 연산자</h2><ul>
<li>안전한 탐색 연산자는 NPE를 피하기 위해 사용, Groovy 언어로 제공</li>
<li>java로 코딩을 하다보면 습관적으로 if(variable &#x3D;&#x3D; null) 과 같은 체크를 하게 된다.</li>
<li>하지만 Safe Navigation 연산자를 사용하면 NPE를 발생시키지 않고, 그냥 null을 리턴해 준다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();</span><br><span class="line"></span><br><span class="line"><span class="type">Inventor</span> <span class="variable">tesla</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Inventor</span>(<span class="string">&quot;Nikola Tesla&quot;</span>, <span class="string">&quot;Serbian&quot;</span>);</span><br><span class="line">tesla.setPlaceOfBirth(<span class="keyword">new</span> <span class="title class_">PlaceOfBirth</span>(<span class="string">&quot;Smiljan&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="type">StandardEvaluationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardEvaluationContext</span>(tesla);</span><br><span class="line"></span><br><span class="line"><span class="comment">//placeOfBirth가 null인가? 체크하고 placeOfBirth.city에 대한 연산 수행</span></span><br><span class="line"><span class="type">String</span> <span class="variable">city</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;PlaceOfBirth?.City&quot;</span>).getValue(context, String.class);</span><br><span class="line">System.out.println(city); <span class="comment">// Smiljan</span></span><br><span class="line"></span><br><span class="line">tesla.setPlaceOfBirth(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"> <span class="comment">//placeOfBirth가 null인가? 체크하고 placeOfBirth.city에 대한 연산 수행</span></span><br><span class="line">city = parser.parseExpression(<span class="string">&quot;PlaceOfBirth?.City&quot;</span>).getValue(context, String.class);</span><br><span class="line">System.out.println(city); <span class="comment">// null - null pointer exception이 발생하지 않는다.</span></span><br></pre></td></tr></table></figure>



<h1 id="할당"><a href="#할당" class="headerlink" title="할당"></a>할당</h1><ul>
<li>할당연산자(<code>=</code>)를 이용하여 Context내의 프로퍼티에 value를 할당 할 수 있다.</li>
<li>보통은 setValue 메서드를 이용하여 value를 할당</li>
<li>getValue 메서드를 이용하여 할당 할 수도 있다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Inventor</span> <span class="variable">inventor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Inventor</span>();</span><br><span class="line"><span class="type">StandardEvaluationContext</span> <span class="variable">inventorContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardEvaluationContext</span>(inventor);</span><br><span class="line"><span class="comment">//inventor.name에 Alexander Seovic2 문자열을 할당</span></span><br><span class="line">parser.parseExpression(<span class="string">&quot;Name&quot;</span>).setValue(inventorContext, <span class="string">&quot;Alexander Seovic2&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//할당연산자(`=`)를 이용하여 inventor.name에 Alexander Seovic2 문자열을 할당</span></span><br><span class="line"><span class="type">String</span> <span class="variable">aleks</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;Name = &#x27;Alexandar Seovic&#x27;&quot;</span>).getValue(inventorContext, String.class);</span><br></pre></td></tr></table></figure>

<h1 id="클래스-표현식"><a href="#클래스-표현식" class="headerlink" title="클래스 표현식"></a>클래스 표현식</h1><ul>
<li><code>T</code> 연산자를 통해 클래스의 인스턴스를 지정하는데 사용할 수 있다.</li>
<li><code>T</code> 연산자를 통해 클래스의 static method도 사용할 수 있다.</li>
<li>웬만하면 full package를 적어준다.</li>
<li>StandardEvaluationContext는 타입을 찾으려고 TypeLocator를 사용</li>
<li>StandardTypeLocator는 java.lang 패키지로 만들어진다.</li>
<li>따라서 java.lang.String과 같은 타입은 T(String)으로 간단하게 표현 가능하다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">dateClass</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;T(java.util.Date)&quot;</span>).getValue(Class.class);</span><br><span class="line"></span><br><span class="line"><span class="type">Class</span> <span class="variable">stringClass</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;T(String)&quot;</span>).getValue(Class.class);</span><br><span class="line"></span><br><span class="line"><span class="type">boolean</span> <span class="variable">trueValue</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;T(java.math.RoundingMode).CEILING &lt; T(java.math.RoundingMode).FLOOR&quot;</span>).getValue(Boolean.class);</span><br></pre></td></tr></table></figure>

<h1 id="생성자-호출"><a href="#생성자-호출" class="headerlink" title="생성자 호출"></a>생성자 호출</h1><ul>
<li>생성자는 새로운 연산자를 사용해서 호출할 수 있다.</li>
<li>primitive type(원시 타입 int, double등..)과 String 외에는 모두 정규화된 클래스명을 사용해야 한다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Inventor</span> <span class="variable">einstein</span> <span class="operator">=</span> p.parseExpression(<span class="string">&quot;new org.spring.samples.spel.inventor.Inventor(&#x27;Albert Einstein&#x27;, &#x27;German&#x27;)&quot;</span>).getValue(Inventor.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">//리스트의 add 메서드내에서 새로운 inventor 인스턴스를 생성한다</span></span><br><span class="line">p.parseExpression(<span class="string">&quot;Members.add(new org.spring.samples.spel.inventor.Inventor(&#x27;Albert Einstein&#x27;, &#x27;German&#x27;))&quot;</span>).getValue(societyContext);</span><br></pre></td></tr></table></figure>

<h1 id="변수"><a href="#변수" class="headerlink" title="변수"></a>변수</h1><ul>
<li><code>#</code> 표현식을 통해 표현식 내에 변수를 참조할 수 있다.</li>
<li>StandardEvaluationContext에서 setVariable 메서드를 사용해서 변수를 설정한다.</li>
<li>자주 쓰이는 표현식이다. (@Cacheable Annotation에서도 사용)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Inventor</span> <span class="variable">tesla</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Inventor</span>(<span class="string">&quot;Nikola Tesla&quot;</span>, <span class="string">&quot;Serbian&quot;</span>);</span><br><span class="line"><span class="type">StandardEvaluationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardEvaluationContext</span>(tesla);</span><br><span class="line">context.setVariable(<span class="string">&quot;newName&quot;</span>, <span class="string">&quot;Mike Tesla&quot;</span>); <span class="comment">//newName변수에 대한 value할당</span></span><br><span class="line"></span><br><span class="line">parser.parseExpression(<span class="string">&quot;Name = #newName&quot;</span>).getValue(context);</span><br><span class="line"></span><br><span class="line">System.out.println(tesla.getName()) <span class="comment">// &quot;Mike Tesla&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="root"><a href="#root" class="headerlink" title="#root"></a>#root</h2><ul>
<li>변수 #root는 항상 정의되며 루트 컨텍스트 개체의미</li>
<li>#root는 항상 루트를 나타낸다.</li>
<li>setRootObject 메서드를 통해 root를 정의한다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">StandardEvaluationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardEvaluationContext</span>(tesla);</span><br><span class="line"></span><br><span class="line"><span class="type">SomeCustomObject</span> <span class="variable">someObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SomeCustomObject</span>();</span><br><span class="line">context.setRootObject(someObject);</span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;kocko&quot;</span>;</span><br><span class="line">context.setVariable(<span class="string">&quot;name&quot;</span>, kocko);</span><br><span class="line"><span class="type">String</span> <span class="variable">statement</span> <span class="operator">=</span> <span class="string">&quot;#root.stringLength(#kocko) == 5&quot;</span>;</span><br><span class="line"><span class="type">Expression</span> <span class="variable">expression</span> <span class="operator">=</span> parser.parseExpression(statement);</span><br><span class="line"></span><br><span class="line"><span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> expression.getValue(context, Boolean.class);</span><br></pre></td></tr></table></figure>

<ul>
<li>#root는 SomeCustomObject를 의미</li>
</ul>
<h2 id="this"><a href="#this" class="headerlink" title="#this"></a>#this</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create an array of integers</span></span><br><span class="line">List&lt;Integer&gt; primes = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">primes.addAll(Arrays.asList(<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">17</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 파서를 생성하고 &#x27;primes&#x27; 변수를 정수 배열로 설정한다</span></span><br><span class="line"><span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();</span><br><span class="line"><span class="type">StandardEvaluationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardEvaluationContext</span>();</span><br><span class="line">context.setVariable(<span class="string">&quot;primes&quot;</span>,primes);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 리스트에서 10보다 큰 모든 소수(?&#123;...&#125; 선택을 사용)</span></span><br><span class="line"><span class="comment">// [11, 13, 17]로 평가된다</span></span><br><span class="line">List&lt;Integer&gt;</span><br><span class="line"> primesGreaterThanTen = (List&lt;Integer&gt;) </span><br><span class="line">parser.parseExpression(<span class="string">&quot;#primes.?[#this&gt;10]&quot;</span>).getValue(context);</span><br><span class="line"><span class="comment">//#primes 변수에 대해 평가하며, #this는 2~17까지 값을 의미한다.</span></span><br></pre></td></tr></table></figure>
<ul>
<li>#this는 항상 정의되어 있고, 현재 평가되는 객체를 가리킨다.</li>
<li>#this는 계속 변경될 수 있다. (위의 예제에서 보면 2,3,5,7등 평가 시점에 따라 달라질수 있다.)</li>
</ul>
<h1 id="사용자-정의-함수"><a href="#사용자-정의-함수" class="headerlink" title="사용자 정의 함수"></a>사용자 정의 함수</h1><ul>
<li>표현식 문자열 내에서 호출 가능한 사용자 정의 함수를 등록하여 SpEL의 기능을 확장할 수 있다.</li>
<li>StandardEvaluationContext에 사용자정의 함수를 등록하여 사용하면 된다.</li>
</ul>
<p>예시로 문자열을 reverse 하는 메서드를 구현하였다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">StringUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">reverseString</span><span class="params">(String input)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">backwards</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; input.length(); i++)</span><br><span class="line">            backwards.append(input.charAt(input.length() - <span class="number">1</span> - i));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> backwards.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>메서드를 StandardEvaluationContext에 등록</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();</span><br><span class="line"><span class="type">StandardEvaluationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardEvaluationContext</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//StringUtils 클래스에 정의된 reserveString 메서드를 등록한다.</span></span><br><span class="line"><span class="comment">//파라미터 타입은 String 타입 객체 1개이다.</span></span><br><span class="line">context.registerFunction(<span class="string">&quot;reverseString&quot;</span>, StringUtils.class.getDeclaredMethod(<span class="string">&quot;reverseString&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; String.class &#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">//hello 문자열을 뒤집은 olleh가 리턴된다.</span></span><br><span class="line"><span class="type">String</span> <span class="variable">helloWorldReversed</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;#reverseString(&#x27;hello&#x27;)&quot;</span>).getValue(context, String.class);</span><br></pre></td></tr></table></figure>

<h1 id="Bean-참조"><a href="#Bean-참조" class="headerlink" title="Bean 참조"></a>Bean 참조</h1><p>evaluation context에 Bean Resolver가 설정된 경우 <code>@</code> 표현식으로 bean을 사용할 수 있다.<br>Spring Docs에 있는 예제는 잘 이해가 안되어 직접 테스트 해보았다.</p>
<p>Bean 클래스 생성</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestBean</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;do Test&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">	<span class="meta">@ResponseBody</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();</span><br><span class="line">		<span class="type">StandardEvaluationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardEvaluationContext</span>();</span><br><span class="line"></span><br><span class="line">		<span class="comment">//실용적인 테스트를 위해 Application Context의 BeanFactory를 설정</span></span><br><span class="line">		<span class="type">DefaultListableBeanFactory</span> <span class="variable">factory</span> <span class="operator">=</span> (DefaultListableBeanFactory) ((ConfigurableApplicationContext) applicationContext).getBeanFactory();</span><br><span class="line">		context.setBeanResolver(<span class="keyword">new</span> <span class="title class_">BeanFactoryResolver</span>(factory));</span><br><span class="line"></span><br><span class="line">		<span class="comment">//Application Context에 등록된 testBean이라는 bean을 불러와 test메서드를 실행하였다.</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;@testBean.test()&quot;</span>).getValue(context, String.class);</span><br><span class="line">		<span class="keyword">return</span> result; <span class="comment">//do Test가 리턴되었다.</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="Collection-선택-기능"><a href="#Collection-선택-기능" class="headerlink" title="Collection 선택 기능"></a>Collection 선택 기능</h1><ul>
<li>컬렉션 (Collection) 선택 기능은 Context내의 Collection 필드에 접근하여 조건(Criteria)를 기반으로 서브 컬렉션을 반환 할 수 있다.</li>
<li><code>?[selectionExpression]</code> 표현식을 이용한다.</li>
<li>리스트, 맵에서 모두 사용 가능하다</li>
<li>객체가 context로 들어오는 경우 object.?[필드에 대한 조건]</li>
<li>컬렉션이 context로 들어오는 경우 .?[필드에 대한 조건] (별도의 필드가 없는 경우 #this를 사용)</li>
</ul>
<p>Twice 클래스를 선언</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Twice</span> &#123;</span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Member&gt; members = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Member&gt;() &#123;</span><br><span class="line">        &#123;</span><br><span class="line">            add(<span class="keyword">new</span> <span class="title class_">Member</span>(<span class="string">&quot;지효&quot;</span>, <span class="number">23</span>));</span><br><span class="line">            add(<span class="keyword">new</span> <span class="title class_">Member</span>(<span class="string">&quot;나연&quot;</span>, <span class="number">24</span>));</span><br><span class="line">            add(<span class="keyword">new</span> <span class="title class_">Member</span>(<span class="string">&quot;모모&quot;</span>, <span class="number">23</span>));</span><br><span class="line">            add(<span class="keyword">new</span> <span class="title class_">Member</span>(<span class="string">&quot;사나&quot;</span>, <span class="number">23</span>));</span><br><span class="line">            add(<span class="keyword">new</span> <span class="title class_">Member</span>(<span class="string">&quot;다현&quot;</span>, <span class="number">21</span>));</span><br><span class="line">            add(<span class="keyword">new</span> <span class="title class_">Member</span>(<span class="string">&quot;미나&quot;</span>, <span class="number">23</span>));</span><br><span class="line">            add(<span class="keyword">new</span> <span class="title class_">Member</span>(<span class="string">&quot;채영&quot;</span>, <span class="number">19</span>));</span><br><span class="line">            add(<span class="keyword">new</span> <span class="title class_">Member</span>(<span class="string">&quot;쯔위&quot;</span>, <span class="number">19</span>));</span><br><span class="line">            add(<span class="keyword">new</span> <span class="title class_">Member</span>(<span class="string">&quot;정연&quot;</span>, <span class="number">23</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Member</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Twice&gt; <span class="title function_">twice</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();</span><br><span class="line">    <span class="type">StandardEvaluationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardEvaluationContext</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Twice의 멤버 필드에 접근</span></span><br><span class="line">    <span class="comment">// 컬렉션의 age 필드에 대해 20 이하인 대상을 반환</span></span><br><span class="line">    List&lt;Twice&gt; filterList = (List&lt;Twice&gt;) parser.parseExpression(<span class="string">&quot;members.?[age &lt; 20]&quot;</span>).getValue(<span class="keyword">new</span> <span class="title class_">Twice</span>());</span><br><span class="line">    <span class="keyword">return</span> filterList; <span class="comment">//[&#123;&quot;name&quot;:&quot;채영&quot;,&quot;age&quot;:19&#125;,&#123;&quot;name&quot;:&quot;쯔위&quot;,&quot;age&quot;:19&#125;]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Collection-투영-기능"><a href="#Collection-투영-기능" class="headerlink" title="Collection 투영 기능"></a>Collection 투영 기능</h1><ul>
<li>투영기능은 컬렉션에 하위표현식을 반영하여 새로운 컬렉션을 리턴한다.</li>
<li><code>![projectionExpression]</code> 표현식을 사용한다.</li>
</ul>
<p>위의 Twice 예제를 바탕으로 설명하겠다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">twice2</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();</span><br><span class="line">    <span class="type">StandardEvaluationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardEvaluationContext</span>();</span><br><span class="line"></span><br><span class="line">    List&lt;Member&gt; testList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Member&gt;() &#123;</span><br><span class="line">        &#123;</span><br><span class="line">            add(<span class="keyword">new</span> <span class="title class_">Member</span>(<span class="string">&quot;지효&quot;</span>, <span class="number">23</span>));</span><br><span class="line">            add(<span class="keyword">new</span> <span class="title class_">Member</span>(<span class="string">&quot;나연&quot;</span>, <span class="number">24</span>));</span><br><span class="line">            add(<span class="keyword">new</span> <span class="title class_">Member</span>(<span class="string">&quot;모모&quot;</span>, <span class="number">23</span>));</span><br><span class="line">            add(<span class="keyword">new</span> <span class="title class_">Member</span>(<span class="string">&quot;사나&quot;</span>, <span class="number">23</span>));</span><br><span class="line">            add(<span class="keyword">new</span> <span class="title class_">Member</span>(<span class="string">&quot;다현&quot;</span>, <span class="number">21</span>));</span><br><span class="line">            add(<span class="keyword">new</span> <span class="title class_">Member</span>(<span class="string">&quot;미나&quot;</span>, <span class="number">23</span>));</span><br><span class="line">            add(<span class="keyword">new</span> <span class="title class_">Member</span>(<span class="string">&quot;채영&quot;</span>, <span class="number">19</span>));</span><br><span class="line">            add(<span class="keyword">new</span> <span class="title class_">Member</span>(<span class="string">&quot;쯔위&quot;</span>, <span class="number">19</span>));</span><br><span class="line">            add(<span class="keyword">new</span> <span class="title class_">Member</span>(<span class="string">&quot;정연&quot;</span>, <span class="number">23</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// Twice 멤버 배열을 받아, 컬렉션 투영기능을 이용하여 그중 name에 대한 필드만 뽑아온 것이다.</span></span><br><span class="line">    List&lt;String&gt; filterList = (List&lt;String&gt;) parser.parseExpression(<span class="string">&quot;![name]&quot;</span>).getValue(testList);</span><br><span class="line">    <span class="keyword">return</span> filterList; <span class="comment">//[&quot;지효&quot;,&quot;나연&quot;,&quot;모모&quot;,&quot;사나&quot;,&quot;다현&quot;,&quot;미나&quot;,&quot;채영&quot;,&quot;쯔위&quot;,&quot;정연&quot;]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="표현식-템플릿"><a href="#표현식-템플릿" class="headerlink" title="표현식 템플릿"></a>표현식 템플릿</h1><ul>
<li>표현식 템플릿을 사용하면 평가 블록과 Literal text를 혼합할 수 있다.</li>
<li>평가블록은 prefix와 subfix로 구분</li>
<li>일반적으로 <code>#&#123;</code> 와 <code>&#125;</code>로 구분한다.</li>
<li>parseExpression() 메서드의 두번째 파라미터로 사용자 정의 ParseContext 객체를 넣어준다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TemplateParserContext</span> <span class="keyword">implements</span> <span class="title class_">ParserContext</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getExpressionPrefix</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;#&#123;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getExpressionSuffix</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &quot;random number is 0.7038186818312008&quot;로 평가된다</span></span><br><span class="line"><span class="type">String</span> <span class="variable">randomPhrase</span> <span class="operator">=</span> </span><br><span class="line">   parser.parseExpression(<span class="string">&quot;random number is #&#123;T(java.lang.Math).random()&#125;&quot;</span>, <span class="keyword">new</span> <span class="title class_">TemplateParserContext</span>()).getValue(String.class);</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="../../2018/11/21/2018-11-21-spel-expression/">SpEL Expression(1)</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-11-21</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="../../tags/Spring/">Spring</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="../../tags/SpEL/">SpEL</a></span><div class="content"><h1 id="들어가며"><a href="#들어가며" class="headerlink" title="들어가며"></a>들어가며</h1><p>Spring Cache Abstraction 기능을 사용하게 되면서, key modeling 시, 필요한 SpEL에 대해 알아보게 되었다.<br>기본적인 설명과 예제는 Spring Docs를 기반으로 번역</p>
<h1 id="SpEL-Spring-Expression-Language-이란"><a href="#SpEL-Spring-Expression-Language-이란" class="headerlink" title="SpEL (Spring Expression Language)이란?"></a>SpEL (<u>Sp</u>ring <u>E</u>xpression <u>L</u>anguage)이란?</h1><p>Spring Expression Language (줄여서 SpEL)은 런타임에 쿼리를 지원하고 객체를 조작할 수 있는 강력한 표현식 언어이다. 언어 구문은 Unified EL과 유사하지만, 여러가지 추가 기능을 제공한다.</p>
<p>다른 Java에서 사용가능한 표현식 언어가 있지만, SpEL은 Spring 커뮤니티에 표현식 언어를 제공하기 위해 만들어졌다.<br>Spring 포트폴리오 내에서 표현식 평가 (Expression evaluation)의 기반으로 SpEL을 제공하지만, SpEL은 Spring과 직접 연계되지 않고 독립적으로 사용 할 수 있다.<br>독립적으로 사용하기 위해서는 Parser 같은 Bootstraping 기반 클래스에 대한 설정을 몇가지 할 필요가 있다.<br>하지만 웬만한 개발자들은 이런 기반 클래스에 대한 설정 없이 SpEL 표현식만 잘 작성하면 된다.</p>
<h1 id="SpEL에서-지원하는-기능"><a href="#SpEL에서-지원하는-기능" class="headerlink" title="SpEL에서 지원하는 기능"></a>SpEL에서 지원하는 기능</h1><ul>
<li>리터럴 표현식 (Literal Expression)</li>
<li>Boolean과 관계형 Operator (Boolean and Relational Operator)</li>
<li>정규 표현식 (Regular Expression)</li>
<li>클래스 표현식 (Class Expression)</li>
<li>프로퍼티, 배열, 리스트, 맵에 대한 접근 지원 (Accessing properties, arrays, lists, maps)</li>
<li>메서드 호출 (Method Invocation)</li>
<li>관계형 Operator (Relational Operator)</li>
<li>할당 (Assignment)</li>
<li>생성자 호출 (Calling Constructors)</li>
<li>Bean 참조 (Bean References)</li>
<li>배열 생성 (Array Contruction)</li>
<li>인라인 리스트&#x2F;맵 (Inline List&#x2F;Map)</li>
<li>삼항 연산자 (Ternary Operator)</li>
<li>변수 (Variables)</li>
<li>사용자 정의 함수 (User defined functions)</li>
<li>컬렉션 투영 (Collections Projection)</li>
<li>컬렉션 선택 (Collections Selection)</li>
<li>Template 표현식 (Templated expression)</li>
</ul>
<h1 id="Expression-인터페이스를-이용한-표현식-파싱"><a href="#Expression-인터페이스를-이용한-표현식-파싱" class="headerlink" title="Expression 인터페이스를 이용한 표현식 파싱"></a>Expression 인터페이스를 이용한 표현식 파싱</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExpressionTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> parseExpression(<span class="string">&quot;\&quot;Hello World\&quot;&quot;</span>, String.class);</span><br><span class="line">        System.out.println(message); <span class="comment">//&quot;Hello World&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">message2</span> <span class="operator">=</span> parseExpression(<span class="string">&quot;\&quot;Hello World\&quot;.concat(&#x27;!&#x27;)&quot;</span>, String.class);</span><br><span class="line">        System.out.println(message2); <span class="comment">//&quot;Hello World!&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">parseExpression</span><span class="params">(String expression, Class&lt;T&gt; clazz)</span> &#123;</span><br><span class="line">        <span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();</span><br><span class="line">        <span class="type">Expression</span> <span class="variable">exp</span> <span class="operator">=</span> parser.parseExpression(expression);</span><br><span class="line">        <span class="keyword">return</span> exp.getValue(clazz);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>위의 코드는 SpEL표현식 문자열에 대한 파싱(Parsing) 하는 프로그램의 예제 코드이다.</li>
<li>ExpressionParser Interface를 구현하는 SpelExpressionParser로 SpEL 표현식의 내용을 파싱(Parsing) 할 수 있다.</li>
<li>exp.getValue() 메서드를 이용해 파싱된 결과값을 Object 타입으로 얻거나, Class정보를 파라미터로 추가해 자동으로 타입 캐스팅이 가능하다.</li>
</ul>
<h1 id="EvaluationContext-인터페이스를-이용한-표현식-파싱"><a href="#EvaluationContext-인터페이스를-이용한-표현식-파싱" class="headerlink" title="EvaluationContext 인터페이스를 이용한 표현식 파싱"></a>EvaluationContext 인터페이스를 이용한 표현식 파싱</h1><ul>
<li>Property, Method, Field에 대한 파싱을 처리</li>
<li>타입변환을 수행하는 표현식을 평가 할 때 EvaluationContext 인터페이스를 사용</li>
<li>EvaluationContext의 구현체인 StandardEvaluationContext는 객체를 조작하기 위해 java reflection의 기능을 사용</li>
<li>성능을 향상 시키기 위해 java.lang.reflect의 Method, Field, Constructor를 캐싱한다.</li>
</ul>
<p>SpEL의 더 일반적인 사용법은 특정 객체 인스턴스(root객체)에 대해 평가되는 표현식 문자열을 제공하는 것이다.<br>root객체를 제공하는 방식은 2가지 방식이 있다.</p>
<h2 id="root-객체를-똑같이-제공하는-경우"><a href="#root-객체를-똑같이-제공하는-경우" class="headerlink" title="root 객체를 똑같이 제공하는 경우"></a>root 객체를 똑같이 제공하는 경우</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create and set a calendar</span></span><br><span class="line"><span class="type">GregorianCalendar</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GregorianCalendar</span>();</span><br><span class="line">c.set(<span class="number">1856</span>, <span class="number">7</span>, <span class="number">9</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// name, birthday, nationality를 파라미터로 갖는 생성자이다.</span></span><br><span class="line"><span class="type">Inventor</span> <span class="variable">tesla</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Inventor</span>(<span class="string">&quot;Nikola Tesla&quot;</span>, c.getTime(), <span class="string">&quot;Serbian&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();</span><br><span class="line"><span class="type">Expression</span> <span class="variable">exp</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;name&quot;</span>); <span class="comment">//tesla객체의 name 프로퍼티가 파싱</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Context에 tesla객체를 넣어준다.</span></span><br><span class="line"><span class="type">EvaluationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardEvaluationContext</span>(tesla);</span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> (String) exp.getValue(context); <span class="comment">//name = &quot;Nikola Tesla&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>StandardEvaluationContext는 <code>name</code> 프로퍼티가 평가 될 객체를 지정하는 클래스이다.<br>(위의 예제는 root객체, 즉 tesla 객체를 고정하여 사용하는 예제)</li>
<li>위의 SpelExpressionParser가 표현식을 평가 할 때, 표현식의 대한 기준을 Tesla 객체로 지정하는 부분이다.</li>
<li><code>parser.parseExpression(&quot;name&quot;);</code> 가 실행되면, tesla 객체의 name 프로퍼티가 파싱된다.</li>
<li>name변수에는 <code>Nikola Tesla</code> 문자열이 리턴된다.</li>
<li>타입 캐스팅 실패 시에는, <code>EvaluationException</code>이 throw된다.</li>
</ul>
<h2 id="root-객체가-계속-변경되는-경우"><a href="#root-객체가-계속-변경되는-경우" class="headerlink" title="root 객체가 계속 변경되는 경우"></a>root 객체가 계속 변경되는 경우</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create and set a calendar</span></span><br><span class="line"><span class="type">GregorianCalendar</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GregorianCalendar</span>();</span><br><span class="line">c.set(<span class="number">1856</span>, <span class="number">7</span>, <span class="number">9</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// name, birthday, nationality를 파라미터로 갖는 생성자이다.</span></span><br><span class="line"><span class="type">Inventor</span> <span class="variable">tesla</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Inventor</span>(<span class="string">&quot;Nikola Tesla&quot;</span>, c.getTime(), <span class="string">&quot;Serbian&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">ExpressionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpelExpressionParser</span>();</span><br><span class="line"><span class="type">Expression</span> <span class="variable">exp</span> <span class="operator">=</span> parser.parseExpression(<span class="string">&quot;name&quot;</span>); <span class="comment">//tesla객체의 name 프로퍼티가 파싱</span></span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> (String) exp.getValue(tesla);</span><br></pre></td></tr></table></figure>

<p>getValue 메서드 호출 시에, StandardEvaluationContext를 사용하지 않고 root 객체를 직접 지정해 준다.</p>
<h2 id="두-가지-방식의-차이"><a href="#두-가지-방식의-차이" class="headerlink" title="두 가지 방식의 차이"></a>두 가지 방식의 차이</h2><ul>
<li>StandardEvaluationContext를 사용하는 경우 생성 비용이 상대적으로 많이 든다.</li>
<li>반복적으로 사용하는 동안 <code>Field에 대해 캐싱되고 있기 때문에 표현식 파싱이 더 빠르다</code>는 장점이 있다.</li>
<li>설정 파일에서 SpEL을 사용하는 경우에는, root 객체를 고정하고 SpEL 표현식만 개발자에게 설정 하도록 하는 것이 좋다.</li>
</ul>
<h1 id="Bean을-정의하는-표현식"><a href="#Bean을-정의하는-표현식" class="headerlink" title="Bean을 정의하는 표현식"></a>Bean을 정의하는 표현식</h1><ul>
<li>BeanDefinition을 정의하는 XML이나, Annotation 기반의 설정에는 MetaData와 SpEL표현식을 같이 사용할 수 있다.</li>
<li><code>#&#123;&lt;expression&gt;&#125;</code> 문법으로 사용한다.</li>
</ul>
<h2 id="XML-Based"><a href="#XML-Based" class="headerlink" title="XML Based"></a>XML Based</h2><ul>
<li>프로퍼티나 생성자 Argument 값을 표현식으로 나타낼 수 있다.<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;numberGuess&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.spring.samples.NumberGuess&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;randomNumber&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#&#123; T(java.lang.Math).random() * 100.0 &#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>systemProperties bean을 미리 지정하여 사용할 수 있다. (bean을 사용하였지만 <code>@</code> 문자를 안붙인 것을 주의)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;taxCalculator&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.spring.samples.TaxCalculator&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultLocale&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#&#123; systemProperties[&#x27;user.region&#x27;] &#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>아래 예제 처럼 다른 bean의 Properties를 사용할 수 있다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;numberGuess&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.spring.samples.NumberGuess&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;randomNumber&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#&#123; T(java.lang.Math).random() * 100.0 &#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;shapeGuess&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.spring.samples.ShapeGuess&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;initialShapeSeed&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#&#123; numberGuess.randomNumber &#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Annotation-Based"><a href="#Annotation-Based" class="headerlink" title="Annotation Based"></a>Annotation Based</h2><ul>
<li>기본값을 지정하기 위해 @Value Annotation을 이용해 Field, Method, Method-Parameter에 붙일 수 있다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">FieldValueTestBean</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Value(&quot;#&#123; systemProperties[&#x27;user.region&#x27;] &#125;&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> String defaultLocale;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDefaultLocale</span><span class="params">(String defaultLocale)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">this</span>.defaultLocale = defaultLocale;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getDefaultLocale</span><span class="params">()</span> </span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.defaultLocale;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">PropertyValueTestBean</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> String defaultLocale;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Value(&quot;#&#123; systemProperties[&#x27;user.region&#x27;] &#125;&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDefaultLocale</span><span class="params">(String defaultLocale)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">this</span>.defaultLocale = defaultLocale;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> MovieFinder movieFinder;</span><br><span class="line"><span class="keyword">private</span> String defaultLocale;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(MovieFinder movieFinder, </span></span><br><span class="line"><span class="params">                 <span class="meta">@Value(&quot;#&#123; systemProperties[&#x27;user.region&#x27;] &#125;&quot;&#125; String defaultLocale)</span> &#123;</span></span><br><span class="line"><span class="params">  <span class="built_in">this</span>.movieFinder = movieFinder;</span></span><br><span class="line"><span class="params">  <span class="built_in">this</span>.defaultLocale = defaultLocale;</span></span><br><span class="line"><span class="params">&#125;</span></span><br></pre></td></tr></table></figure>




<h1 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h1><ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/4.3.10.RELEASE/spring-framework-reference/html/expressions.html">https://docs.spring.io/spring/docs/4.3.10.RELEASE/spring-framework-reference/html/expressions.html</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.outsider.ne.kr/835">https://blog.outsider.ne.kr/835</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.outsider.ne.kr/837">https://blog.outsider.ne.kr/837</a></li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="../../2018/11/07/2018-11-04-ehcache-config-for-springboot/">EHCache 설정방법 (Spring Boot)</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-11-07</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="../../tags/Spring/">Spring</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="../../tags/Spring-Boot/">Spring Boot</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="../../tags/EHCache/">EHCache</a></span><div class="content"><h1 id="EHCache-설정하기"><a href="#EHCache-설정하기" class="headerlink" title="EHCache 설정하기"></a>EHCache 설정하기</h1><p>설정 순서는 아래와 같다.</p>
<ol>
<li>Maven Dependency 설정</li>
<li>Ehcache.xml 작성 (ehcache 설정파일)</li>
<li>@EnableCaching 설정</li>
</ol>
<h1 id="Maven-Dependency-설정"><a href="#Maven-Dependency-설정" class="headerlink" title="Maven Dependency 설정"></a>Maven Dependency 설정</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.sf.ehcache<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ehcache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.10.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="Ehcache-xml-작성-ehcache-설정파일"><a href="#Ehcache-xml-작성-ehcache-설정파일" class="headerlink" title="Ehcache.xml 작성 (ehcache 설정파일)"></a>Ehcache.xml 작성 (ehcache 설정파일)</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ehcache</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:noNamespaceSchemaLocation</span>=<span class="string">&quot;http://ehcache.org/ehcache.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">maxBytesLocalHeap</span>=<span class="string">&quot;300M&quot;</span> &lt;!<span class="attr">--</span> <span class="attr">CacheManager</span>에 의해 관리되는 캐시의 메모리를 <span class="attr">300M</span>로 제한 <span class="attr">--</span>&gt;</span></span><br><span class="line">         updateCheck=&quot;false&quot;&gt;</span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 임시저장 경로를 설정 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">diskStore</span> <span class="attr">path</span>=<span class="string">&quot;java.io.tmpdir&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">        Cache에 저장할 레퍼런스의 최대값을 100000으로 지정,</span></span><br><span class="line"><span class="comment">        maxDepthExceededBehavior = &quot;continue&quot; :  초과 된 최대 깊이에 대해 경고하지만 크기가 조정 된 요소를 계속 탐색</span></span><br><span class="line"><span class="comment">        maxDepthExceededBehavior = &quot;abort&quot; : 순회를 중지하고 부분적으로 계산 된 크기를 즉시 반환</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sizeOfPolicy</span> <span class="attr">maxDepth</span>=<span class="string">&quot;100000&quot;</span> <span class="attr">maxDepthExceededBehavior</span>=<span class="string">&quot;continue&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- default Cache 설정 (반드시 선언해야 하는 Cache) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">defaultCache</span></span></span><br><span class="line"><span class="tag">            <span class="attr">eternal</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">timeToIdleSeconds</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">timeToLiveSeconds</span>=<span class="string">&quot;1200&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">overflowToDisk</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">diskPersistent</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">diskExpiryThreadIntervalSeconds</span>=<span class="string">&quot;120&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">memoryStoreEvictionPolicy</span>=<span class="string">&quot;LRU&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">defaultCache</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 사용하고자 하는 캐시 별 설정 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache</span> <span class="attr">name</span>=<span class="string">&quot;LocalCacheData&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">eternal</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">timeToIdleSeconds</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">timeToLiveSeconds</span>=<span class="string">&quot;1200&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">overflowToDisk</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">diskPersistent</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">diskExpiryThreadIntervalSeconds</span>=<span class="string">&quot;120&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">memoryStoreEvictionPolicy</span>=<span class="string">&quot;LRU&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">cache</span> <span class="attr">name</span>=<span class="string">&quot;AuthMemberList&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">eternal</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">timeToIdleSeconds</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">timeToLiveSeconds</span>=<span class="string">&quot;1200&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">overflowToDisk</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">diskPersistent</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">diskExpiryThreadIntervalSeconds</span>=<span class="string">&quot;120&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">memoryStoreEvictionPolicy</span>=<span class="string">&quot;LRU&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ehcache</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>defaultCache는 반드시 구현해야 할 캐시 (직접 생성하는 캐시에 대한 기본 설정)</li>
<li>cache는 하나의 캐시를 사용할 때마다 구현</li>
<li>name 속성은 캐시의 이름을 지정하며, 코드에서는 이 캐시의 이름을 사용하여 사용할 Cache 인스턴스를 구한다.</li>
</ul>
<table>
<thead>
<tr>
<th>속성</th>
<th>설명</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td>name</td>
<td>코드에서 사용할 캐시 name</td>
<td>필수</td>
</tr>
<tr>
<td>maxEntriesLocalHeap</td>
<td>메모리에 생성 될 최대 캐시 갯수</td>
<td>0</td>
</tr>
<tr>
<td>maxEntriesLocalDisk</td>
<td>디스크에 생성 될 최대 캐시 갯수</td>
<td>0</td>
</tr>
<tr>
<td>eternal</td>
<td>영속성 캐시 설정 (지워지는 캐시인지?) <br />external &#x3D; “true”이면, timeToIdleSecond, timeToLiveSeconds 설정이 무시됨</td>
<td>false</td>
</tr>
<tr>
<td>timeToIdleSecond</td>
<td>해당 초동안 캐시가 호출 되지 않으면 삭제</td>
<td>0</td>
</tr>
<tr>
<td>timeToLiveSeconds</td>
<td>해당 초가 지나면 캐시가 삭제</td>
<td>0</td>
</tr>
<tr>
<td>overflowToDisk</td>
<td>오버플로우 된 항목에 대해 disk에 저장할 지 여부</td>
<td>false</td>
</tr>
<tr>
<td>diskPersistent</td>
<td>캐시를 disk에 저장하여, 서버 로드 시 캐시를 말아 둘지 설정</td>
<td>false</td>
</tr>
<tr>
<td>diskExpiryThreadIntervalSeconds</td>
<td>Disk Expiry 스레드의 작업 수행 간격 설정</td>
<td>0</td>
</tr>
<tr>
<td>memoryStoreEvictionPolicy</td>
<td>캐시의 객체 수가 maxEntriesLocalHeap에 도달하면, 객체를 추가하고 제거하는 정책 설정<br />LRU : 가장 오랫동안 호출 되지 않은 캐시를 삭제<br />LFU : 호출 빈도가 가장 적은 캐시를 삭제<br />FIFO : First In First Out, 캐시가 생성된 순서대로 가장 오래된 캐시를 삭제</td>
<td>LRU</td>
</tr>
</tbody></table>
<p>#@EnableCaching 설정 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableCaching(proxyTargetClass = true, mode = AdviceMode.PROXY)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EHCacheConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> EhCacheManagerFactoryBean <span class="title function_">ehCacheManagerFactoryBean</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">EhCacheManagerFactoryBean</span> <span class="variable">ehCacheManagerFactoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EhCacheManagerFactoryBean</span>();</span><br><span class="line">        ehCacheManagerFactoryBean.setConfigLocation(<span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;config/ehcache.xml&quot;</span>));</span><br><span class="line">        ehCacheManagerFactoryBean.setShared(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> ehCacheManagerFactoryBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> EhCacheCacheManager <span class="title function_">ehCacheCacheManager</span><span class="params">(EhCacheManagerFactoryBean ehCacheManagerFactoryBean)</span> &#123;</span><br><span class="line">        <span class="type">EhCacheCacheManager</span> <span class="variable">ehCacheCacheManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EhCacheCacheManager</span>();</span><br><span class="line">        ehCacheCacheManager.setCacheManager(ehCacheManagerFactoryBean.getObject());</span><br><span class="line">        <span class="keyword">return</span> ehCacheCacheManager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>@EnableCaching Annotation은 <code>&lt;cache:annotation-driven&gt;</code>와 마찬가지로 어노테이션 기반 캐시를 사용 할 수 있는 설정</li>
<li>내부적으로 Spring AOP를 통해 @Cacheable, @CacheEvict와 같은 어노테이션을 Pointcut으로 이용해서 Cache기능을 구현하는 듯 하다.</li>
<li>proxyTargetClass : class 기반 프록시를 생성함을 의미 (CGLIB라이브러리에 대한 의존성 필요)</li>
<li>Mode : 어떤 Advisor 모듈을 선택할지에 대한 설정 <ul>
<li>PROXY : Spring AOP Proxy방식을 이용</li>
<li>ASPECTJ : LTW, CTW기능을 이용한 위빙</li>
</ul>
</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="../../2018/11/07/2018-11-04-ehcache-config-for-springframework/">EHCache 설정방법 (Spring Framework)</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-11-07</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="../../tags/Spring/">Spring</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="../../tags/EHCache/">EHCache</a></span><div class="content"><h1 id="EHCache-설정하기"><a href="#EHCache-설정하기" class="headerlink" title="EHCache 설정하기"></a>EHCache 설정하기</h1><p>설정 순서는 아래와 같다.</p>
<ol>
<li>Maven Dependency 설정</li>
<li>Ehcache.xml 작성 (ehcache 설정파일)</li>
<li>CacheManager 설정 (xml)</li>
</ol>
<h1 id="Maven-Dependency-설정"><a href="#Maven-Dependency-설정" class="headerlink" title="Maven Dependency 설정"></a>Maven Dependency 설정</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- EHCache 모듈 (블로그 작성 시점에서 2.10.6이 최신이다.) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.sf.ehcache<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ehcache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.10.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Spring Caching Interface --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.20.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- EHCache Support 모듈, 다른 Caching 지원모듈 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.20.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h1 id="ehcache-xml-작성"><a href="#ehcache-xml-작성" class="headerlink" title="ehcache.xml 작성"></a>ehcache.xml 작성</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ehcache</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:noNamespaceSchemaLocation</span>=<span class="string">&quot;http://ehcache.org/ehcache.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">maxBytesLocalHeap</span>=<span class="string">&quot;300M&quot;</span> &lt;!<span class="attr">--</span> <span class="attr">CacheManager</span>에 의해 관리되는 캐시의 메모리를 <span class="attr">300M</span>로 제한 <span class="attr">--</span>&gt;</span></span><br><span class="line">         updateCheck=&quot;false&quot;&gt;</span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 임시저장 경로를 설정 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">diskStore</span> <span class="attr">path</span>=<span class="string">&quot;java.io.tmpdir&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">        Cache에 저장할 레퍼런스의 최대값을 100000으로 지정,</span></span><br><span class="line"><span class="comment">        maxDepthExceededBehavior = &quot;continue&quot; :  초과 된 최대 깊이에 대해 경고하지만 크기가 조정 된 요소를 계속 탐색</span></span><br><span class="line"><span class="comment">        maxDepthExceededBehavior = &quot;abort&quot; : 순회를 중지하고 부분적으로 계산 된 크기를 즉시 반환</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sizeOfPolicy</span> <span class="attr">maxDepth</span>=<span class="string">&quot;100000&quot;</span> <span class="attr">maxDepthExceededBehavior</span>=<span class="string">&quot;continue&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- default Cache 설정 (반드시 선언해야 하는 Cache) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">defaultCache</span></span></span><br><span class="line"><span class="tag">            <span class="attr">eternal</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">timeToIdleSeconds</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">timeToLiveSeconds</span>=<span class="string">&quot;1200&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">overflowToDisk</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">diskPersistent</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">diskExpiryThreadIntervalSeconds</span>=<span class="string">&quot;120&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">memoryStoreEvictionPolicy</span>=<span class="string">&quot;LRU&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">defaultCache</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 사용하고자 하는 캐시 별 설정 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache</span> <span class="attr">name</span>=<span class="string">&quot;LocalCacheData&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">eternal</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">timeToIdleSeconds</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">timeToLiveSeconds</span>=<span class="string">&quot;1200&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">overflowToDisk</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">diskPersistent</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">diskExpiryThreadIntervalSeconds</span>=<span class="string">&quot;120&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">memoryStoreEvictionPolicy</span>=<span class="string">&quot;LRU&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">cache</span> <span class="attr">name</span>=<span class="string">&quot;AuthMemberList&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">eternal</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">timeToIdleSeconds</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">timeToLiveSeconds</span>=<span class="string">&quot;1200&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">overflowToDisk</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">diskPersistent</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">diskExpiryThreadIntervalSeconds</span>=<span class="string">&quot;120&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">memoryStoreEvictionPolicy</span>=<span class="string">&quot;LRU&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ehcache</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>defaultCache는 반드시 구현해야 할 캐시 (직접 생성하는 캐시에 대한 기본 설정)</li>
<li>cache는 하나의 캐시를 사용할 때마다 구현</li>
<li>name 속성은 캐시의 이름을 지정하며, 코드에서는 이 캐시의 이름을 사용하여 사용할 Cache 인스턴스를 구한다.</li>
</ul>
<table>
<thead>
<tr>
<th>속성</th>
<th>설명</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td>name</td>
<td>코드에서 사용할 캐시 name</td>
<td>필수</td>
</tr>
<tr>
<td>maxEntriesLocalHeap</td>
<td>메모리에 생성 될 최대 캐시 갯수</td>
<td>0</td>
</tr>
<tr>
<td>maxEntriesLocalDisk</td>
<td>디스크에 생성 될 최대 캐시 갯수</td>
<td>0</td>
</tr>
<tr>
<td>eternal</td>
<td>영속성 캐시 설정 (지워지는 캐시인지?) <br />external &#x3D; “true”이면, timeToIdleSecond, timeToLiveSeconds 설정이 무시됨</td>
<td>false</td>
</tr>
<tr>
<td>timeToIdleSecond</td>
<td>해당 초동안 캐시가 호출 되지 않으면 삭제</td>
<td>0</td>
</tr>
<tr>
<td>timeToLiveSeconds</td>
<td>해당 초가 지나면 캐시가 삭제</td>
<td>0</td>
</tr>
<tr>
<td>overflowToDisk</td>
<td>오버플로우 된 항목에 대해 disk에 저장할 지 여부</td>
<td>false</td>
</tr>
<tr>
<td>diskPersistent</td>
<td>캐시를 disk에 저장하여, 서버 로드 시 캐시를 말아 둘지 설정</td>
<td>false</td>
</tr>
<tr>
<td>diskExpiryThreadIntervalSeconds</td>
<td>Disk Expiry 스레드의 작업 수행 간격 설정</td>
<td>0</td>
</tr>
<tr>
<td>memoryStoreEvictionPolicy</td>
<td>캐시의 객체 수가 maxEntriesLocalHeap에 도달하면, 객체를 추가하고 제거하는 정책 설정<br />LRU : 가장 오랫동안 호출 되지 않은 캐시를 삭제<br />LFU : 호출 빈도가 가장 적은 캐시를 삭제<br />FIFO : First In First Out, 캐시가 생성된 순서대로 가장 오래된 캐시를 삭제</td>
<td>LRU</td>
</tr>
</tbody></table>
<h1 id="CacheManager-Bean-설정"><a href="#CacheManager-Bean-설정" class="headerlink" title="CacheManager Bean 설정"></a>CacheManager Bean 설정</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">z<span class="comment">&lt;!-- Annotation 기반 캐시 사용 (@Cacheable, @CacheEvict..) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">cache:annotation-driven</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- EHCache 기반 CacheManager 설정 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cacheManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.cache.ehcache.EhCacheCacheManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;cacheManager&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;ehcache&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- ehcache.xml 설정 로드 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;ehcache&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.cache.ehcache.EhCacheManagerFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:config/ehcache.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;shared&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h1 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h1><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/skoh/common/blob/master/common-web/src/main/resources/ehcache.xml">https://github.com/skoh/common/blob/master/common-web/src/main/resources/ehcache.xml</a></li>
<li><a target="_blank" rel="noopener" href="https://www.mkyong.com/spring/spring-caching-and-ehcache-example/">https://www.mkyong.com/spring/spring-caching-and-ehcache-example/</a></li>
<li><a target="_blank" rel="noopener" href="http://hyeooona825.tistory.com/86">http://hyeooona825.tistory.com/86</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.naver.com/PostView.nhn?blogId=kyung778&amp;logNo=60164009610">http://blog.naver.com/PostView.nhn?blogId=kyung778&amp;logNo=60164009610</a></li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="../../2018/11/07/2018-10-03-spring-ehcache/">Cache에 대하여.. (Spring+EHCache)</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-11-07</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="../../tags/Spring/">Spring</a></span><div class="content"><h1 id="들어가며"><a href="#들어가며" class="headerlink" title="들어가며.."></a>들어가며..</h1><p>엔터프라이즈 급 Application에서는 DBMS의 부하를 줄이고, 성능을 높이기 위해 캐시(Cache)를 사용한다. 우리 회사에서도 EHCache, Redis를 사용하지만, EHCache쪽은 공부한 적이 없어서 이번 기회에 정리하면서 공부해 보게 되었다.<br>대부분 <code>docs.spring.io</code>의 문서를 번역한 내용을 위주로 정리 하였다.</p>
<h1 id="Cache란"><a href="#Cache란" class="headerlink" title="Cache란?"></a>Cache란?</h1><p>Cache의 사전적인 의미를 알아보기 위해 위키백과를 검색해 보았다.</p>
<blockquote>
<p><strong>캐시</strong>(cache, <a target="_blank" rel="noopener" href="https://ko.wikipedia.org/wiki/%EB%AC%B8%ED%99%94%EC%96%B4">문화어</a>: 캐쉬, 고속완충기, 고속완충기억기)는 <a target="_blank" rel="noopener" href="https://ko.wikipedia.org/wiki/%EC%BB%B4%ED%93%A8%ED%84%B0_%EA%B3%BC%ED%95%99">컴퓨터 과학</a>에서 데이터나 값을 미리 복사해 놓는 임시 장소를 가리킨다. 캐시는 캐시의 접근 시간에 비해 원래 데이터를 접근하는 시간이 오래 걸리는 경우나 값을 다시 계산하는 시간을 절약하고 싶은 경우에 사용한다. 캐시에 데이터를 미리 복사해 놓으면 계산이나 접근 시간 없이 더 빠른 속도로 데이터에 접근할 수 있다.</p>
<p>캐시는 시스템의 효율성을 위해 여러 분야에서 두루 쓰인다.</p>
</blockquote>
<p>결국 캐시란, 반복적으로 데이터를 불러올 때 지속적으로 DBMS 혹은 서버에 요청하는 것이 아닌 메모리에 데이터를 저장하였다가 데이터를 불러다가 쓰는 것을 의미한다. 따라서 서버나 DBMS에 부담을 덜어주고, 엄청 빠르기 때문에 많은 시스템에서 사용하고 있다.<br>대표적으로 Browser Cache, Apacha Cache, DNS Cache등 여러가지 형태로 캐시가 사용되고 있다.</p>
<p>EHCache 사이트에서는 캐시에 대한 용어를 이렇게 정리 하였다.</p>
<ul>
<li><strong>Cache</strong> : 캐시는 <code>미래에 필요할 것이고 빠르게 검색할 수 있는 데이터를 담은 저장소</code> 라고 정의 한다. 캐시는 다른 곳에 있는 데이터를 복제하거나, 계산 결과를 임시적으로 저장하는 데이터 저장소이다. 캐시에 있는 데이터는 시간과 자원 면에서 최소한의 비용으로 반복적으로 접근 할 수 있다.</li>
<li><strong>Cache Hit</strong> : 데이터 요소가 캐시에 요청되고 해당 키에 대한 요소가 존재하면 Cache Hit (또는 단순히 ‘Hit’)라고 한다.</li>
<li><strong>Cache Miss</strong>:데이터 요소가 캐시에 요청되고 해당 키에 대해 요소가 존재하지 않으면 Cache Miss (또는 단순히 ‘Miss’)라고 한다.</li>
<li><strong>System-of-record</strong> : 데이터에 대한 신뢰할 수있는 정보원. 이것을 흔히 시스템 레코드(SOR)이라고 한다. 캐시는 시스템 레코드에서 검색되거나 시스템 레코드에 저장된 데이터의 로컬 사본으로 작동된다. Ehcache를 사용하기 위해 SOR은 데이터베이스로 간주된다.</li>
</ul>
<h1 id="Long-Tail-법칙"><a href="#Long-Tail-법칙" class="headerlink" title="Long Tail 법칙"></a>Long Tail 법칙</h1><p><img src="./17110B4350CC5EC51D.jpeg" alt="Long Tail"></p>
<p>20%의 요구가 시스템 리소스의 대부분을 잡아먹는다는 법칙.<br>자주 사용되는 <code>20%의 기능에 캐시를 이용</code>하면 리소스 사용량을 대폭 줄일 수 있어, <code>시스템의 성능을 대폭 향상</code> 시킬 수 있다.</p>
<h1 id="Local-Cache-vs-Global-Cache"><a href="#Local-Cache-vs-Global-Cache" class="headerlink" title="Local Cache vs Global Cache"></a>Local Cache vs Global Cache</h1><ul>
<li><p>Local Cache</p>
<ul>
<li>Local 장비 내에서만 사용 되는 캐시</li>
<li>Local 장비의 Resource를 이용한다 (Memory, Disk)</li>
<li>Local에서 작동 되기 때문에 속도가 빠르다.</li>
<li>Local에서만 작동되기 때문에 다른 서버와 데이터 공유가 어렵다</li>
</ul>
</li>
<li><p>Global Cache</p>
<ul>
<li>여러 서버에서 Cache Server에 접근하여 사용하는 캐시</li>
<li>데이터를 분산하여 저장 할 수 있다. <ul>
<li>Replication - 데이터를 복제</li>
<li>Sharding - 데이터를 분산하여 저장</li>
</ul>
</li>
<li>Local Cache에 비해 상대적으로 느리다 (네트워크 트래픽)</li>
<li>별도의 Cache Server를 이용하기 때문에 서버 간 데이터 공유가 쉽다.</li>
</ul>
</li>
</ul>
<h1 id="Spring-Cache-Abstraction"><a href="#Spring-Cache-Abstraction" class="headerlink" title="Spring Cache Abstraction"></a>Spring Cache Abstraction</h1><p>Spring 3.1버전부터 Spring Application에 캐시를 쉽게 추가할 수 있도록 기능을 제공하게 되었다. 유사 트랜잭션을 지원하고, 사용하고 있는 코드(메소드)에 영향을 최소화 하면서 일관된 방법으로 캐시를 사용 할 수 있게 되었다.</p>
<p>Spring에서 캐시 추상화는 메소드를 통해 기능을 지원하는데, 메소드가 실행되는 시점에 파라미터에 대한 캐시 존재 여부를 판단하여 없으면 캐시를 등록하게 되고, 캐시가 있으면 메소드를 실행 시키지 않고 캐시 데이터를 Return 해주게 된다.</p>
<p>Spring 캐시 추상화를 지원하기 때문에 개발자는 별도의 캐시 로직을 작성하지 않아도 된다. 하지만 캐시를 저장하는 저장소는 직접 설정을 해주어야 한다. Spring에서는 <code>CacheManager</code>라는 Interface를 제공하여 캐시를 구현하도록 하고 있다.</p>
<br/>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Spring Boot에서는 <code>spring-boot-starter-cache</code> Artifact를 추가 하여 CacheManager를 구성 할 수 있다.<br>기본적으로 별도의 추가적인 서드파티 모듈이 없는 경우에는 Local Memory에 저장이 가능한 ConcurrentMap기반인 <code>ConcurrentMapCacheManager</code>가 Bean으로 자동 생성 된다.</p>
<p>이외에도 EHCache, Redis등의 서드파티 모듈을 추가 하게 되면 <code>EHCacheCacheManager</code>, <code>RedisCacheManager</code>를 Bean으로 등록 하여 사용할 수 있다. 이렇게 되면 별도로 다른 설정 없이도  단순 Memory Cache가 아닌 Cache Server를 대상으로 캐시를 저장 할 수 있도록 지원하고 있다.</p>
<h1 id="Spring-Cache-Annotation"><a href="#Spring-Cache-Annotation" class="headerlink" title="Spring Cache Annotation"></a>Spring Cache Annotation</h1><p>Spring에서는 Cache Annotation을 지원하여 좀 더 쉽게 메서드에 대한 캐시를 제어할 수 있다.</p>
<ul>
<li>@EnableCaching<ul>
<li>Annotation 기반 캐싱 설정을 사용 (내부적으로 Spring AOP 이용)</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>속성</th>
<th>설명</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td>proxyTargetClass</td>
<td>클래스 기반의 Proxy생성 여부<br />false인 경우 JDK Dynamic Proxy 사용 (Interface 기반)<br />true인 경우 CGLIB Proxy 사용 (Class 기반)</td>
<td>false</td>
</tr>
<tr>
<td>mode</td>
<td>위빙 (Weaving) 모드에 대한 설정<br />PROXY : 기존의 Spring AOP 방식을 이용한 RTW방식 사용<br />ASPECTJ : aspectj 라이브러리를 이용한 CTW, LTW 방식 지원</td>
<td>PROXY</td>
</tr>
<tr>
<td>order</td>
<td>AOP order 설정</td>
<td>Integer.MAX_VALUE</td>
</tr>
</tbody></table>
<ul>
<li>@Cacheable<ul>
<li>캐싱할 수 있는 메서드를 지정하기 위해 사용</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>속성</th>
<th>설명</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td>value, cacheName</td>
<td>캐시 명</td>
<td>{}</td>
</tr>
<tr>
<td>key</td>
<td>같은 캐시명을 사용 할 때, 구분되는 구분 값 (KeyGenerator와 함께 쓸 수 없다.)</td>
<td>“”</td>
</tr>
<tr>
<td>keyGenerator</td>
<td>특정 로직에 의해 cache key를 만들고자 하는 경우 사용<br />4.0이후 버전 부터 SimpleKeyGenerator를 사용<br />Custom Key Generator를 사용하고 싶으면, KeyGenerator 인터페이스를 별도로 구현</td>
<td>“”</td>
</tr>
<tr>
<td>cacheManager</td>
<td>사용할 CacheManager를 지정 (EHCacheManager, RedisCacheManager등)</td>
<td>“”</td>
</tr>
<tr>
<td>cacheResolver</td>
<td>Cache 키에 대한 결과값을 돌려주는 Resolver (Interceptor역할)<br />CacheResolver를 구현하여 Custom하게 처리 할 수도 있다.</td>
<td>“”</td>
</tr>
<tr>
<td>condition</td>
<td>SpEL 표현식을 통해 특정 조건에 부합하는 경우에만 캐시 사용<br />and, or 표현식등을 통해 복수 조건 사용가능<br />연산 조건이 <code>true</code>인 경우에만 캐싱</td>
<td>“”</td>
</tr>
<tr>
<td>unless</td>
<td>캐싱이 이루어지지 않는 조건을 설정<br />연산 조건이 <code>true</code> 이면 경우에는 캐싱되지 않는다<br />예시 : id가 null아 아닌 경우에만 캐싱 (unless &#x3D; “#id &#x3D;&#x3D; null”)</td>
<td>“”</td>
</tr>
<tr>
<td>sync</td>
<td>캐시 구현체가 Thread safe 하지 않는 경우, 자체적으로 캐시에 동기화를 거는 속성</td>
<td>false</td>
</tr>
</tbody></table>
<ul>
<li>@CacheEvict<ul>
<li>메서드 실행 시, 해당 캐시를 삭제</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>속성</th>
<th>설명</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td>value, cacheName</td>
<td>캐시 명</td>
<td>{}</td>
</tr>
<tr>
<td>key</td>
<td>같은 캐시명을 사용 할 때, 구분되는 구분 값 (KeyGenerator와 함께 쓸 수 없다.)</td>
<td>“”</td>
</tr>
<tr>
<td>keyGenerator</td>
<td>특정 로직에 의해 cache key를 만들고자 하는 경우 사용<br />4.0이후 버전 부터 SimpleKeyGenerator를 사용<br />Custom Key Generator를 사용하고 싶으면, KeyGenerator 인터페이스를 별도로 구현</td>
<td>“”</td>
</tr>
<tr>
<td>cacheManager</td>
<td>사용할 CacheManager를 지정 (EHCacheManager, RedisCacheManager등)</td>
<td>“”</td>
</tr>
<tr>
<td>cacheResolver</td>
<td>Cache 키에 대한 결과값을 돌려주는 Resolver (Interceptor역할)<br />CacheResolver를 구현하여 Custom하게 처리 할 수도 있다.</td>
<td>“”</td>
</tr>
<tr>
<td>condition</td>
<td>SpEL 표현식을 통해 특정 조건에 부합하는 경우에만 캐시 사용<br />and, or 표현식등을 통해 복수 조건 사용가능<br />연산 조건이 <code>true</code>인 경우에만 캐시 삭제</td>
<td>“”</td>
</tr>
<tr>
<td>allEntries</td>
<td>Cache Key에 대한 전체 데이터 삭제 여부</td>
<td>false</td>
</tr>
<tr>
<td>beforeInvocation</td>
<td>true면 메서드 실행 이전에 캐시 삭제, false면 메서드 실행 이후 삭제</td>
<td>false</td>
</tr>
</tbody></table>
<ul>
<li>@CachePut<ul>
<li>메서드 실행에 영향을 주지 않고 캐시를 갱신해야 하는 경우 사용</li>
<li>보통은 @Cacheable과 @CachePut Annotation을 같이 사용하지 않는다.<br>(둘은 다른 동작을 하기 때문에, 실행순서에 따라 다른 결과가 나올 수 있다.)</li>
<li>@CachePut Annotation은 캐시 생성용으로만 사용한다.</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>속성</th>
<th>설명</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td>value, cacheName</td>
<td>캐시 명</td>
<td>{}</td>
</tr>
<tr>
<td>key</td>
<td>같은 캐시명을 사용 할 때, 구분되는 구분 값 (KeyGenerator와 함께 쓸 수 없다.)</td>
<td>“”</td>
</tr>
<tr>
<td>keyGenerator</td>
<td>특정 로직에 의해 cache key를 만들고자 하는 경우 사용<br />4.0이후 버전 부터 SimpleKeyGenerator를 사용<br />Custom Key Generator를 사용하고 싶으면, KeyGenerator 인터페이스를 별도로 구현</td>
<td>“”</td>
</tr>
<tr>
<td>cacheManager</td>
<td>사용할 CacheManager를 지정 (EHCacheManager, RedisCacheManager등)</td>
<td>“”</td>
</tr>
<tr>
<td>cacheResolver</td>
<td>Cache 키에 대한 결과값을 돌려주는 Resolver (Interceptor역할)<br />CacheResolver를 구현하여 Custom하게 처리 할 수도 있다.</td>
<td>“”</td>
</tr>
<tr>
<td>condition</td>
<td>SpEL 표현식을 통해 특정 조건에 부합하는 경우에만 캐시 사용<br />and, or 표현식등을 통해 복수 조건 사용가능<br />연산 조건이 <code>true</code>인 경우에만 캐싱</td>
<td>“”</td>
</tr>
<tr>
<td>unless</td>
<td>캐싱이 이루어지지 않는 조건을 설정<br />연산 조건이 <code>true</code> 이면 경우에는 캐싱되지 않는다<br />예시 : id가 null아 아닌 경우에만 캐싱 (unless &#x3D; “#id &#x3D;&#x3D; null”)</td>
<td>“”</td>
</tr>
</tbody></table>
<ul>
<li>@Caching<ul>
<li>@CacheEvict이나 @CachePut을 여러개 지정해야 하는 경우에 사용</li>
<li>조건식이나 표현식이 다른 경우에 사용한다.</li>
<li>여러가지의 key에 대한 캐시를 중첩적으로 삭제해야 할 때 사용</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>속성</th>
<th>설명</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td>cacheable[]</td>
<td>@Cacheable 적용할 Annotation을 등록한다.</td>
<td>{}</td>
</tr>
<tr>
<td>put[]</td>
<td>@CachePut 적용할 Annotation을 등록한다.</td>
<td>{}</td>
</tr>
<tr>
<td>evict[]</td>
<td>@CacheEvic 적용할 Annotation을 등록한다.</td>
<td>{}</td>
</tr>
</tbody></table>
<ul>
<li>@CacheConfig<ul>
<li>클래스 단위로 캐시설정을 동일하게 하는데 사용</li>
<li>이 설정은 CacheManager가 여러개인 경우에만 사용</li>
<li>Member조회 클래스에서는 Redis기반 캐시를 사용하고<br>Product 조회 클래스에서는 EHCache 기반 캐시를 사용할 때<br>각 클래스 별로 CacheManager를 지정 가능</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>속성</th>
<th>설명</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td>cacheNames</td>
<td>캐시 명</td>
<td>{}</td>
</tr>
<tr>
<td>keyGenerator</td>
<td>특정 로직에 의해 cache key를 만들고자 하는 경우 사용<br />4.0이후 버전 부터 SimpleKeyGenerator를 사용<br />Custom Key Generator를 사용하고 싶으면, KeyGenerator 인터페이스를 별도로 구현</td>
<td>“”</td>
</tr>
<tr>
<td>cacheManager</td>
<td>사용할 CacheManager를 지정 (EHCacheManager, RedisCacheManager등)</td>
<td>“”</td>
</tr>
<tr>
<td>cacheResolver</td>
<td>Cache 키에 대한 결과값을 돌려주는 Resolver (Interceptor역할)<br />CacheResolver를 구현하여 Custom하게 처리 할 수도 있다.</td>
<td>“”</td>
</tr>
</tbody></table>
<h1 id="EHCache"><a href="#EHCache" class="headerlink" title="EHCache"></a>EHCache</h1><p><img src="./EHCACHE.png" alt="EHCACHE"></p>
<ul>
<li>EHCache는 오픈 소스 기반의 Local Cache이다. </li>
<li>속도가 빠르며 경량 Cache라는 장점이 있다.</li>
<li>Disk, Memory 저장이 가능한 형태</li>
<li>서버 간 분산 캐시를 지원한다 (동기&#x2F;비동기 복제)</li>
<li>JSR107 JCache 표준을 지원한다.<br>따라서 JCache에서 제공하는 Annotation을 통해 이미 작성된 코드에 간단하게 기능 추가가 쉽다.<blockquote>
<p><strong>JSR-107</strong> : (JCACHE – Java Temporary Caching API) 객체 생성, 공유 액세스, 스풀링, 무효화 및 JVM 전반에 걸친 일관성을 포함하여 Java 객체의 메모리 캐싱에서 사용할 API 에 대한 기준으로 볼 수 있다.    해당 Spec 으로 구현된 cache로는 EhCache가 유명하며, Hazelcast, Infinispan, Couchbase, Redis, Caffeine 등도 해당 기준을 따르는 것으로 알려져 있다.</p>
</blockquote>
</li>
</ul>
<h1 id="EHCache-설정-방법"><a href="#EHCache-설정-방법" class="headerlink" title="EHCache 설정 방법"></a>EHCache 설정 방법</h1><p>내용이 길어 질 것 같아 별도의 포스트로 작성</p>
<ul>
<li><a href="http://jaehun2841.github.io/2018/11/07/2018-11-04-ehcache-config-for-springframework/">EHCache 설정방법 (Spring Framework)</a></li>
<li><a href="http://jaehun2841.github.io/2018/11/07/2018-11-04-ehcache-config-for-springboot/">EHCache 설정방법 (Spring Boot)</a></li>
</ul>
<h1 id="EHCache-예시-코드"><a href="#EHCache-예시-코드" class="headerlink" title="EHCache 예시 코드"></a>EHCache 예시 코드</h1><p>테스트 시나리오</p>
<ol>
<li>가상으로 DBMS에서 데이터를 조회 하는 Repository를 생성</li>
<li>3초 정도 슬로우쿼리가 실행된다고 가정</li>
<li>최초 1회는 DB에서 조회, 2회차 부턴 캐시 사용</li>
<li>캐시를 조회했을 때, 걸리는 시간 확인</li>
<li>캐시가 만료되었을때, 걸리는 시간 확인</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EHCacheController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EHCacheRepository repository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/data/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getData</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="type">int</span> id)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> repository.getData(id);</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;쿼리 수행 시간 : &#123;&#125;ms&quot;</span>, end-start);</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/data/delete/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getExpireCache</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> <span class="type">int</span> id)</span> &#123;</span><br><span class="line">        repository.evictCache(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EHCacheRepository</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cacheable(cacheNames = &quot;testData&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getData</span><span class="params">(<span class="type">int</span> id)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;test-data&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@CacheEvict(cacheNames = &quot;testData&quot;, allEntries = true)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">evictCache</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;delete cache all&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableCaching(proxyTargetClass = true, mode = AdviceMode.PROXY)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EHCacheConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> EhCacheManagerFactoryBean <span class="title function_">ehCacheManagerFactoryBean</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">EhCacheManagerFactoryBean</span> <span class="variable">ehCacheManagerFactoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EhCacheManagerFactoryBean</span>();</span><br><span class="line">        ehCacheManagerFactoryBean.setConfigLocation(<span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;config/ehcache.xml&quot;</span>));</span><br><span class="line">        ehCacheManagerFactoryBean.setShared(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> ehCacheManagerFactoryBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> EhCacheCacheManager <span class="title function_">ehCacheCacheManager</span><span class="params">(EhCacheManagerFactoryBean ehCacheManagerFactoryBean)</span> &#123;</span><br><span class="line">        <span class="type">EhCacheCacheManager</span> <span class="variable">ehCacheCacheManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EhCacheCacheManager</span>();</span><br><span class="line">        ehCacheCacheManager.setCacheManager(ehCacheManagerFactoryBean.getObject());</span><br><span class="line">        <span class="keyword">return</span> ehCacheCacheManager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ehcache</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:noNamespaceSchemaLocation</span>=<span class="string">&quot;http://ehcache.org/ehcache.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">maxBytesLocalHeap</span>=<span class="string">&quot;300M&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">updateCheck</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">diskStore</span> <span class="attr">path</span>=<span class="string">&quot;java.io.tmpdir&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sizeOfPolicy</span> <span class="attr">maxDepth</span>=<span class="string">&quot;100000&quot;</span> <span class="attr">maxDepthExceededBehavior</span>=<span class="string">&quot;continue&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">defaultCache</span></span></span><br><span class="line"><span class="tag">            <span class="attr">eternal</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">timeToIdleSeconds</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">timeToLiveSeconds</span>=<span class="string">&quot;1200&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">overflowToDisk</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">diskPersistent</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">diskExpiryThreadIntervalSeconds</span>=<span class="string">&quot;120&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">memoryStoreEvictionPolicy</span>=<span class="string">&quot;LRU&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">defaultCache</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache</span> <span class="attr">name</span>=<span class="string">&quot;LocalCacheData&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">eternal</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">timeToIdleSeconds</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">timeToLiveSeconds</span>=<span class="string">&quot;1200&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">overflowToDisk</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">diskPersistent</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">diskExpiryThreadIntervalSeconds</span>=<span class="string">&quot;120&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">memoryStoreEvictionPolicy</span>=<span class="string">&quot;LRU&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache</span> <span class="attr">name</span>=<span class="string">&quot;testData&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">eternal</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">timeToIdleSeconds</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">timeToLiveSeconds</span>=<span class="string">&quot;100&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">overflowToDisk</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">diskPersistent</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">memoryStoreEvictionPolicy</span>=<span class="string">&quot;LRU&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ehcache</span>&gt;</span></span><br></pre></td></tr></table></figure>

<br/>

<p>결과</p>
<p><img src="./ehcache-test.png" alt="ehcache-test"></p>
<ol>
<li>최초로 <code>GET localhost:8080/data/1</code> 요청 시, 3초 이상의 슬로우 쿼리가 실행</li>
<li>두번째로 동일하게 <code>GET localhost:8080/data/1</code> 요청 시, 3ms의 빠른 실행 결과가 나타남 (캐시 적용)</li>
<li><code>GET localhost:8080/data/delete/1</code> 요청으로 캐시 삭제</li>
<li><code>GET localhost:8080/data/1</code> 요청 시, 3초 이상의 슬로우 쿼리가 실행 (캐시 삭제 후 요청)</li>
<li><code>GET localhost:8080/data/1</code> 요청 시, 3ms의 빠른 실행 결과가 나타남 (캐시 적용)</li>
</ol>
<blockquote>
<p>주의 할 점! </p>
<p>EHCache는 ehcache.xml 또는 Java 코드에서 addCache를 이용하여 반드시 Cache Key를 등록해 줘야 함<br>이거를 안 등록하고 Cache Key를 막쓰다가.. 계속 Cache Key가 없다는 오류가 발생하여 잠깐 삽질..</p>
</blockquote>
<h1 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h1><ul>
<li><a target="_blank" rel="noopener" href="http://www.ehcache.org/documentation/2.8/integrations/spring.html#introduction">http://www.ehcache.org/documentation/2.8/integrations/spring.html#introduction</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/current/spring-framework-reference/integration.html#cache">https://docs.spring.io/spring/docs/current/spring-framework-reference/integration.html#cache</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.breakingthat.com/2018/03/19/springboot-ehcache-%EC%A0%81%EC%9A%A9/">http://blog.breakingthat.com/2018/03/19/springboot-ehcache-%EC%A0%81%EC%9A%A9/</a></li>
<li><a target="_blank" rel="noopener" href="https://jojoldu.tistory.com/57">https://jojoldu.tistory.com/57</a></li>
<li><a target="_blank" rel="noopener" href="http://www.ehcache.org/documentation/2.8/configuration/index.html">http://www.ehcache.org/documentation/2.8/configuration/index.html</a></li>
<li><a target="_blank" rel="noopener" href="https://www.slideshare.net/heungrae_kim/spring-31-ehcache">https://www.slideshare.net/heungrae_kim/spring-31-ehcache</a></li>
<li><a target="_blank" rel="noopener" href="https://shortstories.gitbooks.io/studybook/content/cache.html">https://shortstories.gitbooks.io/studybook/content/cache.html</a></li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="../../2018/10/21/2018-10-21-java-config-import/">@Import와 @ImportResource Annotation</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-10-21</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="../../tags/Spring/">Spring</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="../../tags/Java-Config/">Java-Config</a></span><div class="content"><h1 id="들어가며"><a href="#들어가며" class="headerlink" title="들어가며"></a>들어가며</h1><p>회사 프로젝트 설정은 대부분이 xml설정으로 되어있다.<br>아무도 그 xml설정을 건드리지 않고 있는데, 내가 차츰차츰 Java-Config로 바꾸자고 주장하고 있었고<br>최근에 일부 xml Config를 Java Config로 전환하는 작업을 진행 하였다.<br>그 때 사용한 @Import, @ImportResource Annotation에 대한 기록을 남겨보고자 한다.</p>
<h1 id="Import"><a href="#Import" class="headerlink" title="@Import"></a>@Import</h1><p>@Import Annotation은 기본적으로 Java 파일에 대한 Import를 위해 사용한다.<br>사용하는 개념은 기존에 xml 파일을 import하는.. <import /> 구분과 동일하게 사용된다.</p>
<p>예를 들어 Cache에 대한 Datasource를 설정하는 부분이 있다고 가정을 하면..</p>
<p><strong>RedisClusterConfig</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import(value = RedisShardsConfig.class)</span> <span class="comment">// Redis Shard정보에 대한 Config이다.</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisClusterConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="meta">@Qualifier(&quot;redisConfig&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Properties redisConfig;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="keyword">public</span> GenericObjectPoolConfig <span class="title function_">jedisPoolConfig</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="type">JedisPoolConfig</span> <span class="variable">poolConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JedisPoolConfig</span>();</span><br><span class="line">	    poolConfig.setMaxTotal(redisConfig.getProperty(<span class="string">&quot;redis.cluster.connectionCount&quot;</span>));</span><br><span class="line">		poolConfig.setMaxIdle(commonConfig.getProperty(<span class="string">&quot;redis.cluster.connectionCount&quot;</span>));</span><br><span class="line">		poolConfig.setMinIdle(commonConfig.getProperty(<span class="string">&quot;redis.cluster.connectionCount&quot;</span>));</span><br><span class="line">		poolConfig.setNumTestsPerEvictionRun(<span class="number">2</span>);</span><br><span class="line">		poolConfig.setTestOnBorrow(<span class="literal">true</span>);</span><br><span class="line">		poolConfig.setTestOnReturn(<span class="literal">false</span>);</span><br><span class="line">		poolConfig.setTestWhileIdle(<span class="literal">true</span>);</span><br><span class="line">		poolConfig.setTimeBetweenEvictionRunsMillis(<span class="number">300000</span>);</span><br><span class="line">		<span class="keyword">return</span> poolConfig;</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//따로 @Autowired 하지 않고, 변수명 = bean이름으로 자동으로 매칭될 수 있게 설정하였다.</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="keyword">public</span> ShardedJedisPool <span class="title function_">masterShardedPool</span><span class="params">(GenericObjectPoolConfig jedisPoolConfig, List&lt;JedisShardInfo&gt; redisMasterShards)</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ShardedJedisPool</span>(jedisPoolConfig, redisMasterShards, Hashing.MURMUR_HASH);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="keyword">public</span> ShardedJedisPool <span class="title function_">slaveShardedPool</span><span class="params">(GenericObjectPoolConfig jedisPoolConfig, List&lt;JedisShardInfo&gt; redisSlaveShards)</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ShardedJedisPool</span>(jedisPoolConfig, redisSlaveShards, Hashing.MURMUR_HASH);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>RedisShardsConfig.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisShardsConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">	<span class="meta">@Qualifier(&quot;redisConfig&quot;)</span></span><br><span class="line">	<span class="keyword">private</span> Properties redisConfig;</span><br><span class="line">    </span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="keyword">public</span> List&lt;JedisShardInfo&gt; <span class="title function_">redisMasterShards</span><span class="params">()</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> redisConfig.getProperty(<span class="string">&quot;redis.cluster.url&quot;</span>);</span><br><span class="line">        <span class="comment">//Integer 형변환 생략함...(길어져서 안보임)</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">masterPort1</span> <span class="operator">=</span> redisConfig.getProperty(<span class="string">&quot;redis.cluster.master.port1&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">masterPort2</span> <span class="operator">=</span> redisConfig.getProperty(<span class="string">&quot;redis.cluster.master.port2&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">masterPort3</span> <span class="operator">=</span> redisConfig.getProperty(<span class="string">&quot;redis.cluster.master.port3&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">masterShardKey1</span> <span class="operator">=</span> redisConfig.getProperty(<span class="string">&quot;redis.cluster.master.key1&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">masterShardKey2</span> <span class="operator">=</span> redisConfig.getProperty(<span class="string">&quot;redis.cluster.master.key2&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">masterShardKey3</span> <span class="operator">=</span> redisConfig.getProperty(<span class="string">&quot;redis.cluster.master.key3&quot;</span>);</span><br><span class="line">        </span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;JedisShardInfo&gt;() &#123;</span><br><span class="line">			&#123;</span><br><span class="line">				add(<span class="keyword">new</span> <span class="title class_">JedisShardInfo</span>(url, masterPort1, masterShardKey1));</span><br><span class="line">				add(<span class="keyword">new</span> <span class="title class_">JedisShardInfo</span>(url, masterPort2, masterShardKey2));</span><br><span class="line">				add(<span class="keyword">new</span> <span class="title class_">JedisShardInfo</span>(url, masterPort3, masterShardKey3));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="keyword">public</span> List&lt;JedisShardInfo&gt; <span class="title function_">redisSlaveShards</span><span class="params">()</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> redisConfig.getProperty(<span class="string">&quot;redis.cluster.url&quot;</span>);</span><br><span class="line">        <span class="comment">//Integer 형변환 생략함...(길어져서 안보임)</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">slavePort1</span> <span class="operator">=</span> redisConfig.getProperty(<span class="string">&quot;redis.cluster.slave.port1&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">slavePort2</span> <span class="operator">=</span> redisConfig.getProperty(<span class="string">&quot;redis.cluster.slave.port2&quot;</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">slavePort3</span> <span class="operator">=</span> redisConfig.getProperty(<span class="string">&quot;redis.cluster.slave.port3&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">slaveShardKey1</span> <span class="operator">=</span> redisConfig.getProperty(<span class="string">&quot;redis.cluster.slave.key1&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">slaveShardKey2</span> <span class="operator">=</span> redisConfig.getProperty(<span class="string">&quot;redis.cluster.slave.key2&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">slaveShardKey3</span> <span class="operator">=</span> redisConfig.getProperty(<span class="string">&quot;redis.cluster.slave.key3&quot;</span>);</span><br><span class="line">        </span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;JedisShardInfo&gt;() &#123;</span><br><span class="line">			&#123;</span><br><span class="line">				add(<span class="keyword">new</span> <span class="title class_">JedisShardInfo</span>(url, slavePort1, slaveShardKey1));</span><br><span class="line">				add(<span class="keyword">new</span> <span class="title class_">JedisShardInfo</span>(url, slavePort2, slaveShardKey2));</span><br><span class="line">				add(<span class="keyword">new</span> <span class="title class_">JedisShardInfo</span>(url, slavePort3, slaveShardKey3));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>RedisClusterConfig.java에서는 실제 Redis Cluster Bean을 생성하는 코드이다.<br>RedisShardsConfig.java에서는 Shard Node에 대한 설정을 하는 부분이다.<br>이렇게 설정을 두개로 분리하여 @Import를 Annotation을 사용 하여 상속보다는 유동적으로 Config 설정을 할 수 있다.<br>이 설정은 기본 Spring Configuration 설정 보다는 Test Case작성 시에 큰 힘을 발휘 할 것이라고 생각된다.<br>xml을 로드해서 전체 Bean을 올리는게 아닌, 필요한 Bean 설정만 Import해서 올릴 수 있기 때문이다.</p>
<h1 id="ImportResource"><a href="#ImportResource" class="headerlink" title="@ImportResource"></a>@ImportResource</h1><p>모든 설정을 JavaConfig로 변경하면 좋겠지만, 시간 관계상이나 복잡한것들은 나중에 하려고 xml파일 형태로 남겨둔 것들이 있다. (예를들면 Datasource나… 외부 연동 Bean들…)</p>
<p>그런 configuration들을 import해주기 위해 @ImportResource Annotation을 사용하였다.<br>사용법은 간단하다. @ImportResource Annotation value에 배열 형태로 선언만 해주면 되기 때문이다.</p>
<p>예시는 아래와 같다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ImportResource(value = &#123;</span></span><br><span class="line"><span class="meta">		&quot;classpath:applicationContextForExternalMember.xml&quot;,    //External-Member</span></span><br><span class="line"><span class="meta">		&quot;classpath*:applicationContextForExternalAPI.xml&quot;,      //External-API</span></span><br><span class="line"><span class="meta">		&quot;classpath*:applicationContextForExternalLogger.xml&quot;    //External-Logger</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExternalConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 위와같이 설정하면, @Configuration Annotation에 의해 Component-scan 되는 시점에 해당 파일들이 import되어 Configuration 설정이 적용된다.</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="../../2018/10/21/2018-10-21-spring-context/">Application-Context와 Servlet-Context</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-10-21</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="../../tags/Spring/">Spring</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="../../tags/WAS/">WAS</a></span><div class="content"><h1 id="들어가며"><a href="#들어가며" class="headerlink" title="들어가며"></a>들어가며</h1><p>회사 업무 중에 AOP를 이용하여 개발 중에 AOP가 제대로 설정이 되지 않는 문제가 있었다.<br>문제의 원인은 Component-scan 위치에 따른 Bean 생성 위치에 있었다.<br>core가 되는 프로젝트는 applicationContext에서 component-scan을 통해 bean을 생성 하고 있었고,<br>각 endpoint가 되는 프로젝트내의 패키지는 모두 servlet-context에서 component-scan을 하고 있었다.<br>Bean의 생성 위치 상, AOP를 적용할 수 없었기 때문에 발생한 문제 였다.</p>
<p>이번 기회에 Application Context와 Servlet Context의 계층을 알게 되어 나름대로 정리 해보고자 한다.</p>
<h1 id="Web-Application-Context"><a href="#Web-Application-Context" class="headerlink" title="Web Application Context"></a>Web Application Context</h1><p><img src="./99A34C3359FEAA8410.png" alt="img"></p>
<h2 id="Application-Context"><a href="#Application-Context" class="headerlink" title="Application Context"></a>Application Context</h2><ul>
<li>Web Application 최상단에 위치하고 있는 Context</li>
<li>Spring에서 ApplicationContext란 BeanFactory를 상속받고 있는 Context</li>
<li>Spring에서 root-context.xml, applicationContext.xml 파일은 ApplicationContext 생성 시 필요한<br>설정정보를 담은 파일 (Bean 선언 등..)</li>
<li>Spring에서 생성되는 Bean에 대한 IoC Container (또는 Bean Container)</li>
<li>특정 Servlet설정과 관계 없는 설정을 한다 (@Service, @Repository, @Configuration, @Component)</li>
<li>서로 다른 여러 Servlet에서 공통적으로 공유해서 사용할 수 있는 Bean을 선언한다.</li>
<li><strong>Application Context에 정의된 Bean은 Servlet Context에 정의 된 Bean을 사용할 수 없다.</strong></li>
</ul>
<h2 id="Servlet-Context-servlet-context-xml"><a href="#Servlet-Context-servlet-context-xml" class="headerlink" title="Servlet-Context (servlet-context.xml)"></a>Servlet-Context (servlet-context.xml)</h2><ul>
<li>Servlet 단위로 생성되는 context</li>
<li>Spring에서 servlet-context.xml 파일은 DispatcherServlet 생성 시에 필요한 설정 정보를 담은 파일<br>(Interceptor, Bean생성, ViewResolver등..)</li>
<li>URL설정이 있는 Bean을 생성 (@Controller, Interceptor)</li>
<li>Application Context를 자신의 부모 Context로 사용한다.</li>
<li>Application Context와 Servlet Context에 같은 id로 된 Bean이 등록 되는 경우,<br>Servlet Context에 선언된 Bean을 사용한다.</li>
<li>Bean 찾는 순서 <ul>
<li>Servlet Context에서 먼저 찾는다.</li>
<li>만약 Servlet Context에서 bean을 못찾는 경우 Application Context에 정의된 bean을 찾는다.</li>
</ul>
</li>
<li><strong>Servlet Context에 정의된 Bean은 Application Context의 Bean을 사용할 수 있다.</strong></li>
</ul>
<h1 id="web-xml-설정-살펴보기"><a href="#web-xml-설정-살펴보기" class="headerlink" title="web.xml 설정 살펴보기"></a>web.xml 설정 살펴보기</h1><h2 id="web-xml-이란"><a href="#web-xml-이란" class="headerlink" title="web.xml 이란"></a>web.xml 이란</h2><p>서블릿 클래스는 JSP 페이지와 달리 설치뿐만 아니라 등록을 하는 과정을 필요로 한다.<br>여기서 서블릿 클래스를 등록하는 곳의 이름을 <code>Web application deployment descriptor</code>라고 하는데 (줄여서 DD-Deployment Descriptor) 이 역할을 하는 것이 바로 <code>web.xml</code>이다. <code>web.xml</code> 파일은 웹 애플리케이션 디렉터리마다 딱 하나씩만 존재할 수 있다.</p>
<p>DD는 WAS 구동 시 <code>/WEB-INF</code> 디렉토리에 존재하는 <code>web.xml</code>을 읽어 웹 애플리케이션의 설정을 구성하기 위해 존재한다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">version</span>=<span class="string">&quot;2.5&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!-- The definition of the Root Spring Container shared by all Servlets and Filters --&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- applicationContext.xml에서 설정한 Bean은 모든 서블릿, 필터에서 공유 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">context-param</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/WEB-INF/spring/applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">&lt;!-- Creates the Spring Container shared by all Servlets and Filters --&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 서블릿과 필터에 공유 할 수 있도록 리스너를 설정 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span></span><br><span class="line">              org.springframework.web.context.ContextLoaderListener</span><br><span class="line">          <span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">      <span class="comment">&lt;!-- Processes application requests --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">servlet</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span> </span><br><span class="line">              <span class="tag">&lt;<span class="name">param-value</span>&gt;</span></span><br><span class="line">                  <span class="comment">&lt;!-- dispatcherServlet 생성 시, 서블릿 설정파일 로드 --&gt;</span></span><br><span class="line">                  /WEB-INF/spring/appServlet/servlet-context.xml</span><br><span class="line">              <span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">    <span class="comment">&lt;!-- dispatcherServlet 대한 url-pattern을 정의 </span></span><br><span class="line"><span class="comment">        /로 들어오는 모든 요청은 DispatcherServlet에서 처리 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span>  </span><br><span class="line">            <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h1 id="그래서-Context-설정은-어떻게-쓰냐"><a href="#그래서-Context-설정은-어떻게-쓰냐" class="headerlink" title="그래서 Context 설정은 어떻게 쓰냐?"></a>그래서 Context 설정은 어떻게 쓰냐?</h1><p>Spring에서 Application Context와 Servlet Context를 나누는 기준은 간단하다.</p>
<ul>
<li>Application Context<ul>
<li>공통 기능을 할 수 있는 Bean설정 (Datasource, Service 등..)</li>
<li>각 Servlet에서 공유할 수 있는 Bean</li>
</ul>
</li>
<li>Servlet Context<ul>
<li>Servlet 구성에 필요한 Bean 설정 (Controller, Interceptor, MappingHandler등..)</li>
</ul>
</li>
</ul>
<p>가장 중요한 게 Bean을 자동으로 scan하여 생성하는 component-scan이라고 생각된다.<br>각 applicationContext.xml과 servletContext.xml 파일을 설정한다고 가정하면 아래와 같이 설정 할 수 있다.</p>
<p>ApplicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.myapp.core, com.myapp.app&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Component-scan대상에서 @Controller annotation Class는 제외한다. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>Servlet-Context.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.myapp.app&quot;</span> <span class="attr">use-default-filters</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Component-scan대상은 @Controller annotation Class만 scan한다. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Servlet-Context.xml 설정 시, <code>use-default-filters</code> 속성을 <code>false</code>로 처리 하였다.<br><code>use-default-filters</code> 속성은 원래 <code>default가 true</code>인데,<br>@Compont Annotation(@Controller, @Service, @Repository등..) 의 <code>클래스를 자동으로 Bean으로 등록해 주는 filter속성</code>이다.<br>따라서 위의 필터를 false로 변경하고, scan할 대상에 대한 Annotation만 include-filter에 추가하였다.</p>
<h1 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h1><ul>
<li><a target="_blank" rel="noopener" href="http://hoonmaro.tistory.com/31">http://hoonmaro.tistory.com/31</a></li>
<li><a target="_blank" rel="noopener" href="https://plus4070.github.io/nhn%20entertainment%20devdays/Web.xml.html">https://plus4070.github.io/nhn%20entertainment%20devdays/Web.xml.html</a></li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="../../2018/09/22/2018-09-21-spring-ioc-2/">Spring IoC &amp; DI(2)</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-09-22</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="../../tags/Spring/">Spring</a></span><div class="content"><h1 id="IoC란"><a href="#IoC란" class="headerlink" title="IoC란?"></a>IoC란?</h1><p>Inversion of Control (제어의 역전) 이라는 의미로 사용되고 있다.<br>보통의 프로그램에서는 개발자가 필요한 객체를 직접 new를 통해 생성하여 사용한다.<br>하지만 Spring과 같은 프레임워크에서는 흐름의 주체가 Container가 되어 Container에서 객체의 생성과 소멸을 관리하며<br>개발자가 개발한 애플리케이션 코드를 호출하여 프로그램의 흐름을 관장한다.</p>
<p>따라서 프로그램의 흐름을 개발자가 관장하는 것이 아닌 프레임워크에게 그 권한이 넘어갔다(역전되었다.) 하여<br>제어의 역전 (Inversion of Control)이라 불린다.</p>
<h1 id="Container가-도데체-뭐람"><a href="#Container가-도데체-뭐람" class="headerlink" title="Container가 도데체 뭐람?"></a>Container가 도데체 뭐람?</h1><p><img src="./containers.jpg" alt="containers"></p>
<p>개발 공부를 하다보면 은근 컨테이너(Container)라는 용어를 많이 듣게 된다.<br>Spring 컨테이너, 서블릿 컨테이너, EJB컨테이너등등.. Container라는 용어를 듣게 되는데 컨테이너는 도데체 무엇일까?<br>위의 이미지와 연상해보면 무엇인가를 담아놓은 박스를 연상할 수 있다.<br>이러한 컨테이너 말고도, 컨테이너 처럼 생긴 공장도 있다. 이게 개발자가 상상해야 하는 컨테이너와 부합하는 이미지 같다.<br>컨테이너 내부에 물건을 적재하고 물건에 대한 관리도 하는.. 컨테이너를 생각하는 것이 도움이 될 것 같다.<br>실제 프레임워크에서의 컨테이너도 같은 역할을 한다. </p>
<p><strong>이는 객체에 대한 생성부터 소멸까지 생명주기를 관리하며, 시스템이 로드 될 때, 필요한 객체를 생성하여 컨테이너에 담아두고 필요 할 때 사용한다. 뿐만아니라 객체에 대한 추가적인 기능을 제공하는 주체</strong>라고 할 수 있다. </p>
<p>위에서 예시로 든 컨테이너를 바탕으로 생각을 해보면</p>
<p>서블릿 (Servlet) 컨테이너는 WAS(Web Application Server) 내 에서 서블릿 객체의 생성, 소멸 대한 처리를 담당하며,<br>외부에서 요청이 들어오면 서블릿 객체를 사용한다. 이 뿐만 아니라 Spring Security 같은 Servlet filter를 이용하여 추가적인 기능을 제공한다.</p>
<p>Spring Container는 POJO 클래스를 Bean으로 생성하고 소멸까지 생명주기를 관리한다. 또한 Bean이 호출 될 때 의존성을 갖는 클래스에 대해 컨테이너에서 필요한 객체를 찾아 주입해 준다. 이 뿐만 아니라 객체에 대한 Transaction, Security, Pooling에 대한 기능을 추가적으로 제공하고 있다.</p>
<h1 id="DI란"><a href="#DI란" class="headerlink" title="DI란?"></a>DI란?</h1><p>DI란 Dependency Injection의 의미로 의존성 주입이라는 뜻을 가지고 있다.<br>DI는 IoC라는 개념을 실제로 구현한 대표적인 예이며, 대부분 IoC와 혼용하여 사용한다.<br>개념 자체는 <code>IoC의 형태 중 하나</code>라고 볼 수 있다.</p>
<p>DI는 Spring 프레임워크에서 객체의 의존성 관계를 생성하는 역할을 한다.<br>클래스 내에서 개발자가 new를 통해 객체 생성을 직접 하지 않아도 DI를 통해 객체를 주입하여 컴포넌트화 하여 객체 내에서 사용 할 수 있다는 장점이 있다.</p>
<p>Spring에서는 @Autowired 어노테이션을 통해 간단하게 의존성 주입 설정을 할 수 있으며<br>객체 내에 의존성 객체를 주입하는 방식은 4가지 정도 있다.</p>
<ol>
<li>Constructor Injection</li>
<li>Dependency Constructor Injection</li>
<li>Setter Injection</li>
<li>Field Injection</li>
</ol>
<h1 id="의존성-주입-Annotation"><a href="#의존성-주입-Annotation" class="headerlink" title="의존성 주입 Annotation"></a>의존성 주입 Annotation</h1><p>Spring&#x2F;Java에서는 의존성 주입을 위한 어노테이션을 제공하여 간단하게 의존성 주입을 구현할 수 있다.</p>
<ul>
<li>@Autowired<ul>
<li>Spring에서 지원하는 Annotation</li>
<li><code>Type</code>에 맞춰서 주입이 된다.</li>
<li>Interface에 상응하는 Bean이 2개 이상 인 경우에는 <code>@Qualifier(&quot;beanName&quot;)을 혼용</code>하여<br>필요한 Bean객체를 주입한다.</li>
</ul>
</li>
<li>@Inject<ul>
<li>Java에서 지원하는 Annotation</li>
<li><code>Type</code>에 맞춰서 주입이 된다.</li>
</ul>
</li>
<li>@Resource<ul>
<li>Java에서 지원하는 Annotation</li>
<li><code>이름</code>에 맞춰서 주입이 된다.</li>
</ul>
</li>
</ul>
<p>Spring Framework 기반에서 Java Framework로의 Conversion 계획이 있다면, @Inject&#x2F;@Resource를 사용하면 문제는 없을 것이나.. 대부분은 @Autowired를 사용한다.</p>
<h1 id="DI-구현방식"><a href="#DI-구현방식" class="headerlink" title="DI 구현방식"></a>DI 구현방식</h1><h2 id="Constructor-Injection"><a href="#Constructor-Injection" class="headerlink" title="Constructor Injection"></a>Constructor Injection</h2><p>생성자에 @Autowired 어노테이션을 이용하여 UserRepository 객체를 삽입하는 방법이다.<br>이 방법은 xml 설정 시에 유용한 방법이다.<br>객체 생성 시, 주입을 하기 때문에 객체가 생성된 이후에는 주입된 객체를 변경 할 수 없다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Class UserService &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserService</span><span class="params">(UserRepository userRepository)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userRepository = userRepository;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userRepository&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.user.UserRepository&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span>, <span class="attr">class</span>=<span class="string">&quot;com.example.user.UserService&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">construct-args</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;userRepository&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">construct-args</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="Extension-Constructor-Injection"><a href="#Extension-Constructor-Injection" class="headerlink" title="Extension Constructor Injection"></a>Extension Constructor Injection</h2><p>Spring 4에 추가된 DI방법이다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Class UserService &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserService</span><span class="params">(UserRepository userRepository)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userRepository = userRepository;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserService에 @Autowired를 선언 하지 않아도 의존성 주입을 할 수 있게 되었다.<br>어찌보면 당연한 내용 같은데…  Lombok을 이용해서 의존성 주입이 가능해 졌다는 점이다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> Class UserService &#123;</span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Setter-Injection"><a href="#Setter-Injection" class="headerlink" title="Setter Injection"></a>Setter Injection</h2><p>Setter를 통해 DI하는 방법이다.<br>이 방법은 외부에서 setter를 통해 의존성 객체를 변경 할 수 있는 소지가 있어 상당히 주의해야 한다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Class UserService &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">setUserRepository</span><span class="params">(UserRepository userRepository)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userRepository = userRepository;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Field-Injection"><a href="#Field-Injection" class="headerlink" title="Field Injection"></a>Field Injection</h2><p>Spring을 사용하는 개발자들이 가장많이 사용하는 DI방법이다.<br>아무래도 코드량이 적으니 다들 많이 사용하는 방법인 듯 싶다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Class UserService &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="용어-설명"><a href="#용어-설명" class="headerlink" title="용어 설명"></a>용어 설명</h1><ul>
<li>Bean<ul>
<li>Spring Container에 등록 되는 POJO객체 </li>
<li>Spring Application의 Component들이 등록 된다.</li>
<li>기본적으로 Bean은 특별한 경우가 아닌이상 Stateless(상태정보는 없음) Bean을 등록한다.</li>
</ul>
</li>
<li>Bean Factory<ul>
<li>Spring IoC를 담당하는 핵심 컨테이너</li>
<li>Bean에 대한 등록&#x2F;생성&#x2F;조회&#x2F;소멸을 관리한다.</li>
<li>BeanFactory는 interface이며 주로 구현체인 ApplicationContext를 사용한다.</li>
<li>대표적으로 getBean() 메서드를 제공한다. (Bean의 Meta 정보를 바탕으로 Bean 조회)</li>
</ul>
</li>
<li>Application Context<ul>
<li>BeanFactory 인터페이스의 구현체 ()<ul>
<li>정확히는 ListableBeanFactory</li>
<li>Bean을 Listable하게 보관하는 인터페이스를 말한다.</li>
</ul>
</li>
<li>BeanFactory의 기능 이외에 Spring의 추가적인 기능을 제공한다.<ul>
<li>ResourceLoader - ApplicationContext 로드에 필요한 설정 파일들을 로드한다.</li>
<li>ApplicationEventPublisher - 이벤트 발생을 관장한다.</li>
<li>MessageSource - properties파일을 통해 다국어 설정이 가능</li>
<li>BeanLifecycle - Bean의 초기화, 소멸을 담당한다.</li>
</ul>
</li>
</ul>
</li>
<li>Configuration Meta Data <ul>
<li>Application Context에서 IoC 설정을 위해 사용되는 메타정보</li>
<li>컨테이너에 어떤 기능을 세팅할때 사용</li>
<li>Bean 생성&#x2F;구성할 경우에도 사용</li>
<li>@Configuration 어노테이션을 통해 클래스로 설정 정보 구현이 가능</li>
</ul>
</li>
</ul>
<h1 id="Bean-등록-방법"><a href="#Bean-등록-방법" class="headerlink" title="Bean 등록 방법"></a>Bean 등록 방법</h1><h2 id="Component-Scan"><a href="#Component-Scan" class="headerlink" title="Component-Scan"></a>Component-Scan</h2><p>Spring에서 가장 편하게 Bean을 등록할 수 있는 방법이다.<br>Spring에서 component-scan에 package나 class를 설정하면 해당 class들에 대해 @Component 어노테이션이 달려 있는 경우 자동으로 Spring Bean으로 등록 해주는 기능이다.<br>분명 편리한 기능이긴 하지만 여러 프로젝트에서 공통적으로 패키지를 사용하는 경우에는 안쓰는 Bean들도 생길 수 있기 때문에<br>불필요한 메모리 할당이 이루어질 수 있다.<br>그렇기는 해도 최근 Spring을 사용하여 개발하는 경우에는 <code>가장 많이 하는 설정</code>이 아닐까 싶다.</p>
<ul>
<li>@Component 종류<ul>
<li>@Controller : Presentaion Layer의 Bean을 선언 (주로 외부로부터 요청을 받는 Controller Class)</li>
<li>@Service :  Service Layer의 Bean을 선언 (핵심 비지니스 로직을 구현한 Class)</li>
<li>@Repository : Persistent Layer의 Bean을 선언 (주로 DB, Cache와 같은 저장소와 연동을 위한 Class)</li>
<li>@Configuration : Configuration Layer의 Bean을 선언 (주로 Bean을 생성하거나, Spring Container에 대한 설정을 하는 Class)</li>
</ul>
</li>
</ul>
<h2 id="Servlet-Context-xml"><a href="#Servlet-Context-xml" class="headerlink" title="Servlet-Context.xml"></a>Servlet-Context.xml</h2><p>기존 Bean 생성을 xml로 등록하는 방식이다.<br>이 방식을 Bean등록을 한군데에서 모아 볼 수 있다는 장점이 있지만…<br>보통의 Enterprise급 프로젝트에서는 설정하는 Bean이 너무 많아 오히려 복잡하다.<br>위에서 언급한 <code>Component-scan</code>을 주로 사용하는 것이 좋다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;beanNameViewResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.BeanNameViewResolver&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;order&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;internalResourceViewResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/views/&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;order&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="Configuration"><a href="#Configuration" class="headerlink" title="@Configuration"></a>@Configuration</h2><p>xml파일에서 Bean등록을 하던 역할을 Java Config로 할 수 있도록 해준다.<br>뿐만아니라 @Configuration 어노테이션을 붙인 클래스는 Spring Container에 대한 설정까지 추가 할 수 있다.<br>Bean을 추가하고자 하는 경우에는 추가하고자 하는 Bean을 return 하는 메서드를 만들어 <code>@Bean</code> 어노테이션을 붙여주면 된다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> UserService <span class="title function_">userService</span><span class="params">()</span> &#123; <span class="comment">//메소드 명이 기본적으로 Bean Name으로 추가된다.</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Java Config를 이용할 수 있다는 장점과 Test Case 작성 시 Mock객체를 Bean으로 생성해야 하는 경우<br>아주 유용한 방법이라 할 수 있겠다.</p>
<h1 id="Bean-생명주기"><a href="#Bean-생명주기" class="headerlink" title="Bean 생명주기"></a>Bean 생명주기</h1><p>Spring Container에서는 Bean의 생성~소멸까지 Bean을 관리한다.<br>Bean의 생성 시점과 소멸 시점에 대한 처리를 할 수 있는 기능을 제공하고 있다.</p>
<p>Bean 생명주기 처리를 하는 방법은 3가지 방식이 있다.</p>
<ol>
<li>InitializingBean, DisposableBean 인터페이스 구현</li>
<li>Bean정의 시 , 메소드 지정</li>
<li>@PostConstruct, @PreDestroy Annotation 사용</li>
</ol>
<h2 id="InitializingBean-DisposableBean-인터페이스-구현"><a href="#InitializingBean-DisposableBean-인터페이스-구현" class="headerlink" title="InitializingBean, DisposableBean 인터페이스 구현"></a>InitializingBean, DisposableBean 인터페이스 구현</h2><p>InitializingBean, DisposableBean 인터페이스를 구현 하여, Bean의 생성과 소멸 시<br>기능을 확장 할 수 있다.</p>
<p>InitializingBean, DisposableBean 클래스는 Spring에서 제공하는 인터페이스 이기 때문에<br>Spring에 종속적이게 된다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestBeanClass</span> <span class="keyword">implements</span> <span class="title class_">InitializingBean</span>, DisposableBean&#123;</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">private</span> Connection conn;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//자원의 할당 처리</span></span><br><span class="line">        conn = DBConnectionCaller.getConnection();</span><br><span class="line">        System.out.println(<span class="string">&quot;bean 생성 및 초기화 : afterPropertiesSet() 호출됨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//주로 할당된 자원의 해제를 한다.</span></span><br><span class="line">        <span class="keyword">if</span>(conn != <span class="literal">null</span>) conn.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;bean 소멸 : destroy 호출됨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="Bean정의-시-메소드-지정"><a href="#Bean정의-시-메소드-지정" class="headerlink" title="Bean정의 시 , 메소드 지정"></a>Bean정의 시 , 메소드 지정</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;testBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.TestBeanClass&quot;</span>                      </span></span><br><span class="line"><span class="tag">   <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;destroy&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>xml설정 파일 <bean>에서 <strong>init-method</strong> 지정 시 Bean생성과 properties의존성 주입 후 지정한 메소드 호출</li>
<li>xml설정 파일 <bean>에서 <strong>destroy-method</strong> 지정 시 Bean소멸 전 콜백으로 지정한 메소드 호출</li>
</ul>
<h2 id="PostConstruct-PreDestroy-Annotation-사용"><a href="#PostConstruct-PreDestroy-Annotation-사용" class="headerlink" title="@PostConstruct, @PreDestroy Annotation 사용"></a>@PostConstruct, @PreDestroy Annotation 사용</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestBeanClass</span> &#123;be</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">private</span> Connection conn;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//자원의 할당 처리</span></span><br><span class="line">        conn = DBConnectionCaller.getConnection();</span><br><span class="line">        System.out.println(<span class="string">&quot;bean 생성 및 초기화&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PreDestroy</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//주로 할당된 자원의 해제를 한다.</span></span><br><span class="line">        <span class="keyword">if</span>(conn != <span class="literal">null</span>) conn.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;bean 소멸&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@PostConstuct, @PreDestroy 은 <code>JSR-250 Annotation</code> 기반이다 (한마디로 자바기반)<br>따라서 Spring프레임워크에 종속적이지 않다는 장점이 있다. 따라서 Spring 기반에서 다른 Java기반의 프레임워크로 이식 할 경우 별도로 수정할 필요가 없다.</p>
<p>@PostConstuct, @PreDestroy 을 사용하기 위해서는<br><code>&lt;annotation-config/&gt; </code>설정이나, <code>@AnnotationDrivenConfig </code>어노테이션을 붙여줘야 한다.</p>
<h1 id="Bean-Scope"><a href="#Bean-Scope" class="headerlink" title="Bean Scope"></a>Bean Scope</h1><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/3.0.0.M3/reference/html/ch04s04.html">https://docs.spring.io/spring/docs/3.0.0.M3/reference/html/ch04s04.html</a> 을 참고함</p>
<ul>
<li>Singleton Scope : IoC Container 단위 별로 Bean이 생성 된다.</li>
<li>Prototype Scope : Bean이 사용되는 시점 별로 다른 Bean이 생성된다.</li>
<li>Request Scope : Web프로젝트에서 http 요청 별로 Bean이 생성된다. http의 Lifecycle동안 같은 Bean을 사용</li>
<li>Session Scope : Request Scope와 마찬가지로 Web 프로젝트에서 사용하며, Session별로 Bean이 생성된다.<br>(이 경우에는 Bean에 Session정보를 세팅하여 사용할 수 있다.)</li>
<li>Global Session Scope : Request Scope와 마찬가지로 Web 프로젝트에서 사용하며, Global Http Session별로 다른 Bean을 생성한다. 일반적으로 Portlet Context에서 사용된다.</li>
</ul>
<h1 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h1><p><a target="_blank" rel="noopener" href="http://www.javajigi.net/pages/viewpage.action?pageId=3664&amp;focusedCommentId=3751#Spring%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC%EC%86%8C%EA%B0%9C%EC%99%80IoC%EB%B0%8FSpringIoC%EC%9D%98%EA%B0%9C%EB%85%90-2.1IoC%EB%9E%80%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80%3F">http://www.javajigi.net/pages/viewpage.action?pageId=3664&amp;focusedCommentId=3751#Spring%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC%EC%86%8C%EA%B0%9C%EC%99%80IoC%EB%B0%8FSpringIoC%EC%9D%98%EA%B0%9C%EB%85%90-2.1IoC%EB%9E%80%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80%3F</a><br><a target="_blank" rel="noopener" href="http://wiki.javajigi.net/pages/viewpage.action?pageId=281">http://wiki.javajigi.net/pages/viewpage.action?pageId=281</a><br><a target="_blank" rel="noopener" href="https://jongmin92.github.io/2018/02/11/Spring/spring-ioc-di/">https://jongmin92.github.io/2018/02/11/Spring/spring-ioc-di/</a><br><a target="_blank" rel="noopener" href="https://okky.kr/article/415474">https://okky.kr/article/415474</a><br><a target="_blank" rel="noopener" href="http://www.javajigi.net/pages/viewpage.action?pageId=68">http://www.javajigi.net/pages/viewpage.action?pageId=68</a><br><a target="_blank" rel="noopener" href="http://www.javajigi.net/download/attachments/5614/V3_InversionOfControl.pdf?version=1">http://www.javajigi.net/download/attachments/5614/V3_InversionOfControl.pdf?version=1</a><br><a target="_blank" rel="noopener" href="http://isstory83.tistory.com/91">http://isstory83.tistory.com/91</a><br><a target="_blank" rel="noopener" href="https://spring.io/blog/2016/03/04/core-container-refinements-in-spring-framework-4-3">https://spring.io/blog/2016/03/04/core-container-refinements-in-spring-framework-4-3</a><br>토비의 스프링 VOL.2 Spring IoC</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="../../2018/09/21/2018-09-12-spring-ioc/">Spring IoC &amp; DI(1) - IoC 등장배경(과정)</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-09-21</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="../../tags/Spring/">Spring</a></span><div class="content"><h1 id="IoC-등장배경"><a href="#IoC-등장배경" class="headerlink" title="IoC 등장배경"></a>IoC 등장배경</h1><p>IoC의 등장배경을 알기 위해서는 EJB나 Spring과 같은 프레임워크를 사용하기 이전 시대의 개발 방식에 대해 얘기를 해야한다.<br>온고지신(?)이라 하였던가.. IoC를 이해하기 위해 옛날이야기를 해보도록 하겠다.</p>
<p>태초에 Java로 만든 프로그램은 main()이라는 메소드에서 시작이 되었다.<br>main() 메소드 내에서 필요한 클래스를 개발자가 직접 코드내에서 생성하여 사용하였다.<br>어떠한 프로그램을 만들던지 간에 프로그램에는 <code>모델(Model)</code>이라는 개념이 생겨나게 된다.<br>이렇게 만들어진 클래스 간에서는 <code>관계(Relation)</code>과 <code>의존성(Dependency)</code>가 생기게 된다. </p>
<p><code>의존성이란?</code> A클래스에서 B클래스의 기능을 사용할 때 클래스A는 클래스B에 의존적이다 라고 하며<br>A –&gt; B 라고 표현한다 (UML에서는 클래스 간의 Dependency를 점선으로 표현한다.)<br>즉, B클래스의 기능이 변하게 되면 A클래스에도 영향이 생긴다는 말로 직역할 수 있다.</p>
<p>이해를 돕기위해 급식을 받는 학생에 대한 예제를 들어보겠다.<br>(이 학교는 아침&#x2F;점심&#x2F;저녁을 다 주는 좋은 학교이다)</p>
<h2 id="클래스-gt-클래스-호출-관계"><a href="#클래스-gt-클래스-호출-관계" class="headerlink" title="클래스 -&gt; 클래스 호출 관계"></a>클래스 -&gt; 클래스 호출 관계</h2><p><img src="./image-20180921143924788.png" alt="image-20180921143924788"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		</span><br><span class="line">        <span class="type">Restaurant</span> <span class="variable">restaurant</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Restaurant</span>();</span><br><span class="line">        <span class="comment">//식사 시작</span></span><br><span class="line">        restaurant.eatBreakfast();</span><br><span class="line">        restaurant.eatLunch();</span><br><span class="line">        restaurant.eatDinner();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Restaurant</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eatBreakfast</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Breakfast</span> <span class="variable">breakfast</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Breakfast</span>();</span><br><span class="line">        System.out.println(breakfast.getInfo() + <span class="string">&quot;을 먹었습니다.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eatLunch</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Lunch</span> <span class="variable">lunch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Lunch</span>();</span><br><span class="line">        System.out.println(lunch.getInfo() + <span class="string">&quot;을 먹었습니다.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eatDinner</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Dinner</span> <span class="variable">dinner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dinner</span>();</span><br><span class="line">        System.out.println(dinner.getInfo() + <span class="string">&quot;을 먹었습니다.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Student 클래스는 밥을 먹기위해 Restaurant클래스를 new로 생성하였다.<br>Restaurant클래스 내에서는 아침&#x2F;점심&#x2F;저녁을 먹을 수 있도록 각각 Breakfast, Lunch, Dinner클래스를 new로 생성하였다.<br>위의 의존성에 대해 위 예제를 풀어보면 Student는 Restaurant에 대해 의존적이다. (Student —&gt; Restaurant)<br>Student클래스에서 Restaurant클래스를 생성하여 밥을 먹기 때문이다. 만약에 Restaurant 클래스에서 밥을 못먹게 하면<br>Student클래스는 정상적으로 밥을 먹는 기능을 수행할 수 없다.<br>Restaurant클래스는 Breakfast&#x2F;Lunch&#x2F;Dinner에 대해 의존적이다.<br>각각의 메소드에서 Breakfast&#x2F;Lunch&#x2F;Dinner클래스를 생성하여 밥을 먹는 행위를 하도록 하고있다.</p>
<p>가만히 보게 되면 의존성에 대한 공통점을 발견할 수 있다.<br>그것은 바로 <code>new</code>이다. <code>클래스 내에서의 new는 곧 의존성을 의미</code>하게 된다. new로 생성한 클래스가 문제가 생기면 사용을 하는 클래스의 기능에도 문제가 생기기 떄문이다.</p>
<p>따라서 <strong>프로그래밍의 의존성은 new이다</strong> 로 간단하게 정의를 내릴 수 있겠다.</p>
<h2 id="클래스-gt-인터페이스-interface-gt-클래스-구조"><a href="#클래스-gt-인터페이스-interface-gt-클래스-구조" class="headerlink" title="클래스 -&gt; 인터페이스(interface) -&gt; 클래스 구조"></a>클래스 -&gt; 인터페이스(interface) -&gt; 클래스 구조</h2><p>클래스 내에서 클래스를 생성하여 호출 하는 경우에는 변경에 많은 비용이 발생하게 된다.<br>만약에 학교에서 야식까지 먹어가며 밤을 새는 경우에는 야식이라는 의존성을 또 추가하게 된다.<br>뿐만 아니라 Breakfast&#x2F;Lunch&#x2F;Dinner 클래스에 변경이 생기는 경우에도 Restaurant 클래스는 영향을 받게 된다.</p>
<p>이와 같은 문제를 쪼금 더 편하게 해결 할 수 있게 Java에서는 interface라는게 있다.<br>(개인적으로 Service나 Repository 같은 클래스들을 생성 할 때 웬만하면 interface를 선언하는 편이다.)</p>
<p>차후에 Mock객체 생성하기도 좋고, 요구사항이 변경 되었을 때 유연하게 대응 할 수 있어 개인적으로는 Interface를 자주 사용하는 편이다.</p>
<p>Breakfast&#x2F;Lunch&#x2F;Dinner클래스를 자세히 보면… getInfo() 메소드가 공통적으로 쓰이고 있다.<br>(getInfo메소드는 식단에 대한 정보이다.)<br>따라서 하나의 interface로 Breakfast&#x2F;Lunch&#x2F;Dinner클래스를 추상화 할 수 있다.<br>그렇게 되면 eat이라는 메소드 하나만으로도 아침~저녁을 먹을 수 있는 기능을 구현할 수 있다.<br>위에서 말로 한 얘기를 코드로 풀어보면..</p>
<p><img src="./image-20180921145310488.png" alt="image-20180921145310488"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		</span><br><span class="line">        <span class="type">Restaurant</span> <span class="variable">restaurant</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Restaurant</span>();</span><br><span class="line">        <span class="comment">//식사 시작</span></span><br><span class="line">        restaurant.eat(<span class="keyword">new</span> <span class="title class_">Breakfast</span>());</span><br><span class="line">        restaurant.eat(<span class="keyword">new</span> <span class="title class_">Lunch</span>());</span><br><span class="line">        restaurant.eat(<span class="keyword">new</span> <span class="title class_">Dinner</span>());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Eatable</span>() &#123;</span><br><span class="line">	String <span class="title function_">getInfo</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Restaurant</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">(Eatable eatable)</span> &#123;</span><br><span class="line">        System.out.println(eatable.getInfo() + <span class="string">&quot;을 먹었습니다.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>위의 클래스 -&gt; 클래스 간의 Dependency 구조보다는 interface를 사용하므로써 많이 결합도가 완화된 모습이다.<br>이전에는 Restaurant 클래스가 Break&#x2F;Lunch&#x2F;Dinner에 대해 모두 Dependency를 가지고 가는 구조여서 결합도가 강한 형태였는데, interface를 사용하여 결합도를 많이 약화 시켰다.</p>
<p>자세히 보면 <code>Student클래스에서 Break/Lunch/Dinner를 생성하여 Restaurant에 주입</code>해 주었다.<br>이러한 모습이 향후 DI의 개념과 비슷한 개념으로 발전하게 된다.<br>Restaurant입장에서는 개발자가 생성한 객체가 아닌 <code>외부로 부터 주입받은 형태</code>로 Break&#x2F;Lunch&#x2F;Dinner에 대해 사용을 하기 때문이다.<br>이 부분을 잘 이해하면 차후 IoC와 DI를 이해하는데 크게 도움이 된다.</p>
<h2 id="클래스-gt-팩토리-factory-패턴"><a href="#클래스-gt-팩토리-factory-패턴" class="headerlink" title="클래스 -&gt; 팩토리(factory) 패턴"></a>클래스 -&gt; 팩토리(factory) 패턴</h2><p>디자인 패턴 중에는 팩토리(Factory) 패턴이라는 구현 방식이 있다.<br>팩토리 패턴에 대해 간단하게 설명하자면, 객체의 상태(State) 또는 구분자(Type)을 통해 필요한 객체를 Return 해주는 패턴이다. 위에서 설명한 클래스 -&gt; 인터페이스 방식을 차용하여 한 단계 더 Wrapping한 개념이라고 생각하면 편하다.<br>팩토리 패턴을 이용하면 아예 <code>개발자에게 객체 생성에 대한 권한을 주지 않겠다! </code>를 구현 할 수 있게 된다.<br><strong>개발자가 객체 생성을 직접 하지 않고도 시스템에 요청하여 원하는 객체를 얻어낼 수 있다.</strong> &lt;– 이 내용은 DL(Dependency Lookup)과 비슷한 개념으로 통할 수 있을 것 같다.</p>
<p>팩토리 패턴으로 만든 코드를 만들게 된다면, 아래와 같이 만들 수 있을 것이다.</p>
<p><img src="./image-20180921153027741.png" alt="image-20180921153027741"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		</span><br><span class="line">        <span class="type">Restaurant</span> <span class="variable">restaurant</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Restaurant</span>();</span><br><span class="line">        <span class="comment">//식사 시작</span></span><br><span class="line">        restaurant.eat(EatFactory.get(Meal.BREAKFAST));</span><br><span class="line">        restaurant.eat(EatFactory.get(Meal.LUNCH));</span><br><span class="line">        restaurant.eat(EatFactory.get(Meal.DINNER));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Meal</span> &#123;</span><br><span class="line">   BREAKFAST, LUNCH, DINNER;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EatFactory</span>() &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Eatable <span class="title function_">get</span><span class="params">(Meal meal)</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span>(meal) &#123;</span><br><span class="line">            <span class="keyword">case</span> BREAKFAST : <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Breakfast</span>();</span><br><span class="line">            <span class="keyword">case</span> LUNCH : <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Lunch</span>();</span><br><span class="line">            <span class="keyword">case</span> DINNER : <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Dinner</span>();</span><br><span class="line">            <span class="keyword">default</span>: <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Not using Meal Type&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Eatable</span>() &#123;</span><br><span class="line">	String <span class="title function_">getInfo</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Restaurant</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">(Eatable eatable)</span> &#123;</span><br><span class="line">        System.out.println(eatable.getInfo() + <span class="string">&quot;을 먹었습니다.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>이제 개발자가 개발하는 코드에서 Breakfast&#x2F;Lunch&#x2F;Dinner에 대한 Dependency는 완전히 제거 되었다.<br>야식이라는 식사 메뉴가 추가되어도 Meal enum에 야식 항목을 추가하고, EatFactory에 야식에 대한 case만 추가 해 주면<br>Student 클래스는 유연하게 추가된 기능에 대해 대처가 가능하다.</p>
<h2 id="IoC-패턴"><a href="#IoC-패턴" class="headerlink" title="IoC 패턴"></a>IoC 패턴</h2><p>IoC패턴을 알기 전에 IoC에 대해 간단히 설명하자면..<br>기능을 담당하는 POJO class를 프로그램 시작 시, IoC 컨테이너에 Bean이라는 이름으로 객체를 생성해 둔다.<br>이렇게 싱글톤으로 생성된 객체들을 필요한 시점에 IoC 컨테이너에서 의존성을 가지는 객체에 직접 주입을 해주는 패턴을 IoC패턴이라 한다.</p>
<p>쉽게 말하면 객체의 멤버에 대한 상태가 없고(stateless) 기능의 역할을 담은 클래스들을 1개씩 IoC컨테이너라는 상자에 담아두고, 의존성 객체가 필요한 경우 IoC컨테이너에서 필요한 객체를 주입해준다. 라고 생각하면 편할 것 같다.<br>객체에 대해 new 생성자를 통해 객체를 생성할 필요가 없으니, 메모리적인 낭비가 없다는 장점이 있을 뿐 더러 개발자에게 객체 관리에 대한 미시적인 역할을 맡기지 않아도 되는 장점이 있다. 자세한 내용은 다음 장에 기술하도록 하겠다.</p>
<p>위의 내용을 Spring을 사용한 개발이라고 한다면… 아래와 같이 코드를 짤 수 있겠다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication(scanBasePackages = &quot;com.example.ioc&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Restaurant restaurant;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EatFactory eatFactory;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        </span><br><span class="line">		SpringApplication.run(SpringStudyApplication.class, args);</span><br><span class="line">        <span class="comment">//식사 시작</span></span><br><span class="line">        restaurant.eat(eatFactory.get(Meal.BREAKFAST));</span><br><span class="line">        restaurant.eat(eatFactory.get(Meal.LUNCH));</span><br><span class="line">        restaurant.eat(eatFactory.get(Meal.DINNER));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Meal</span> &#123;</span><br><span class="line">   BREAKFAST, LUNCH, DINNER;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EatFactory</span>() &#123;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="meta">@Qualifier(&quot;breakfast&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Eatable breakfast;</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="meta">@Qualifier(&quot;lunch&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Eatable lunch;</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="meta">@Qualifier(&quot;dinner&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Eatable dinner;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Eatable <span class="title function_">get</span><span class="params">(Meal meal)</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span>(meal) &#123;</span><br><span class="line">            <span class="keyword">case</span> BREAKFAST : breakfast;</span><br><span class="line">            <span class="keyword">case</span> LUNCH : lunch;</span><br><span class="line">            <span class="keyword">case</span> DINNER : dinner;</span><br><span class="line">            <span class="keyword">default</span>: <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Not using Meal Type&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Eatable</span>() &#123;</span><br><span class="line">	String <span class="title function_">getInfo</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Restaurant</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">(Eatable eatable)</span> &#123;</span><br><span class="line">        System.out.println(eatable.getInfo() + <span class="string">&quot;을 먹었습니다.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Spring에서는 component-scan이라는 기능을 통해 @Component 어노테이션이 붙은 클래스는 IoC 컨테이너에 Bean으로써 자동 등록 해준다. 이러한 Bean은 @Autowired &#x2F; @Inject 와 같은 어노테이션을 통해 클래스에 주입을 해줄 수 있다.<br>이렇게 되면 개발자가 new를 통해 의존성을 강제화 하지 않고 프레임워크가 이 역할을 대신 수행해 준다.</p>
<p>개발자가 객체 생성과 의존성 주입에 대한 역할을 대신 해준다<br>Inversion of Control (객체 관리과 의존성 관리를 시스템에서 해준다 : 제어의 역전) 이라고 불리게 되었다.</p>
<h1 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h1><p><a target="_blank" rel="noopener" href="http://www.javajigi.net/pages/viewpage.action?pageId=3664&amp;focusedCommentId=3751#Spring%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC%EC%86%8C%EA%B0%9C%EC%99%80IoC%EB%B0%8FSpringIoC%EC%9D%98%EA%B0%9C%EB%85%90-2.1IoC%EB%9E%80%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80%3F">http://www.javajigi.net/pages/viewpage.action?pageId=3664&amp;focusedCommentId=3751#Spring%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC%EC%86%8C%EA%B0%9C%EC%99%80IoC%EB%B0%8FSpringIoC%EC%9D%98%EA%B0%9C%EB%85%90-2.1IoC%EB%9E%80%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80%3F</a><br><a target="_blank" rel="noopener" href="http://wiki.javajigi.net/pages/viewpage.action?pageId=281">http://wiki.javajigi.net/pages/viewpage.action?pageId=281</a><br><a target="_blank" rel="noopener" href="https://jongmin92.github.io/2018/02/11/Spring/spring-ioc-di/">https://jongmin92.github.io/2018/02/11/Spring/spring-ioc-di/</a><br><a target="_blank" rel="noopener" href="https://okky.kr/article/415474">https://okky.kr/article/415474</a><br><a target="_blank" rel="noopener" href="http://www.javajigi.net/pages/viewpage.action?pageId=68">http://www.javajigi.net/pages/viewpage.action?pageId=68</a><br><a target="_blank" rel="noopener" href="http://www.javajigi.net/download/attachments/5614/V3_InversionOfControl.pdf?version=1">http://www.javajigi.net/download/attachments/5614/V3_InversionOfControl.pdf?version=1</a><br><a target="_blank" rel="noopener" href="http://isstory83.tistory.com/91">http://isstory83.tistory.com/91</a><br>토비의 스프링 VOL.2 Spring IoC</p>
</div><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="../9/"><i class="fa fa-chevron-left"></i></a><a class="page-number" href="../../">1</a><span class="space">&hellip;</span><a class="page-number" href="../9/">9</a><span class="page-number current">10</span><a class="page-number" href="../11/">11</a><a class="page-number" href="../12/">12</a><a class="extend next" rel="next" href="../11/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2022 By Carrey</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="../../js/utils.js?version=1.9.0"></script><script src="../../js/fancybox.js?version=1.9.0"></script><script src="../../js/sidebar.js?version=1.9.0"></script><script src="../../js/copy.js?version=1.9.0"></script><script src="../../js/fireworks.js?version=1.9.0"></script><script src="../../js/transition.js?version=1.9.0"></script><script src="../../js/scroll.js?version=1.9.0"></script><script src="../../js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>