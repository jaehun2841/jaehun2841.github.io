<!DOCTYPE html><html lang="lang"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="Carrey"><meta name="copyright" content="Carrey"><title>공부하고, 경험하고, 삽질해서 얻은 지식들을 기록합니다. | Carrey`s 기술블로그</title><link rel="shortcut icon" href="../../melody-favicon.ico"><link rel="stylesheet" href="../../css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '6.0.0'
} </script><meta name="generator" content="Hexo 6.0.0"></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="https://www.gravatar.com/avatar/3f8583b7b0f0c1ebd249dffad42707af?s=300"></div><div class="author-info__name text-center">Carrey</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href=".."><span class="pull-left">Articles</span><span class="pull-right">112</span></a><a class="author-info-articles__tags article-meta" href="../../tags"><span class="pull-left">Tags</span><span class="pull-right">27</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="../../index.html">Carrey`s 기술블로그</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">Carrey`s 기술블로그</div><div id="site-sub-title">공부하고, 경험하고, 삽질해서 얻은 지식들을 기록합니다.</div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="../../2019/01/08/effective-java-item8/">Item 8. Finalizer와 Cleaner 사용은 피하라</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-01-08</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="../../tags/Effective-Java/">Effective-Java</a></span><div class="content"><h1 id="서론"><a href="#서론" class="headerlink" title="서론"></a>서론</h1><p>Java에서는 2가지의 객체 소멸자를 제공한다.</p>
<ul>
<li>finalzier</li>
<li>cleaner</li>
</ul>
<p>이 2가지 객체 소멸자는 JVM내의 GC가 작동할 때 실행되는 구문이다.<br>기본적으로 이 2가지 구문은 <strong>사용하지 말아야 한다.</strong><br>현재 Java 9 버전 부터는 Object 클래스에 대한 finalizer를 <code>Deprecated</code> 처리하였다.<br>아래에 사용하지 말아햐 하는 이유를 하나씩 보도록 하겠다.</p>
<h1 id="finalizer와-cleaner를-사용하지-말아야-하는-이유"><a href="#finalizer와-cleaner를-사용하지-말아야-하는-이유" class="headerlink" title="finalizer와 cleaner를 사용하지 말아야 하는 이유"></a>finalizer와 cleaner를 사용하지 말아야 하는 이유</h1><h2 id="실행을-보장할-수-없다"><a href="#실행을-보장할-수-없다" class="headerlink" title="실행을 보장할 수 없다."></a>실행을 보장할 수 없다.</h2><p>finalizer에 특정 로직을 삽입하는 경우 실행을 보장 할 수 없다.<br>기본적으로 GC가 발생할 때 실행되는 로직이지만, Java Application이 죽는다던지의 이유로 finalizer 실행이 되지 않을 수 있다.<br>그렇기 때문에 제 때 실행되어야 하거나, 뭔가 상태를 수정하는 행위를 절대적으로 하면은 안된다.</p>
<h2 id="느리다"><a href="#느리다" class="headerlink" title="느리다."></a>느리다.</h2><p>Effective Java 책의 예제에서는 AutoCloseable과 finalizer의 성능비교를 한 문단이 있다.<br>Autocloseable을 사용한 GC 수행시간은 12ns였지만, finalizer를 사용한 GC 수행 시간은 550ns가 걸렸다고 한다.<br>finalizer가 가비지 컬렉터의 효율을 떨어뜨리기 때문이다.</p>
<h2 id="시스템-전체-장애를-유발-할-수-있다"><a href="#시스템-전체-장애를-유발-할-수-있다" class="headerlink" title="시스템 전체 장애를 유발 할 수 있다."></a>시스템 전체 장애를 유발 할 수 있다.</h2><p>Java API 문서 상에서는 GC가 UnReachable 상태의 객체를 가비지 컬렉션 할 때 finalizer가 호출된다고 명시하고 있다.<br>하지만 finalizer가 실행되는 시점은 GC 발생 시 즉각적으로 이루어지는게 아니다.<br>finalizer queue에 삽입되어 순차적으로 finalizer를 실행하게 된다.<br>그렇기 때문에 finalizer메소드 실행이 느린 경우 객체 소멸이 느려지므로  <code>Out of Memory</code>와 같은 오류를 발생 시킬 가능성이 높아지게 된다.</p>
<h2 id="finalizer-공격에-취약하다"><a href="#finalizer-공격에-취약하다" class="headerlink" title="finalizer 공격에 취약하다."></a>finalizer 공격에 취약하다.</h2><p>위에 적은 것 처럼 finalizer 메소드 실행시간이 오래 걸리게 만들면 시스템에 심각한 장애를 유발할 수 있다.<br>finalizer 메서드를 override해서 악의적으로 느리게 할 수 있기 떄문에 finalizer를 사용해야 하는 경우라면<br>메소드에 <code>final</code> 키워드를 붙여서 상속하지 못하도록 해야한다.</p>
<h1 id="그럼-finalizer나-cleaner는-어디서-쓰나"><a href="#그럼-finalizer나-cleaner는-어디서-쓰나" class="headerlink" title="그럼 finalizer나 cleaner는 어디서 쓰나?"></a>그럼 finalizer나 cleaner는 어디서 쓰나?</h1><ul>
<li>개발자가 객체의 close를 호출하지 않는 경우 -&gt; 자원 해제를 안하느니 느리더라도 하는게 낫다.<br>(이 경우는 동의 못하겠다. 개발자가 close를 시켜야 한다.)</li>
<li>native peer와 연결된 객체<ul>
<li>native peer는 자바 객체가 아니기 떄문에 가비지 컬렉터의 관리 대상이 아니다.<br>그렇기 때문에 native peer가 회수 될때 finalizer 메서드를 실행해 자원을 해제 할 수 있다.</li>
</ul>
</li>
</ul>
<h1 id="finalizer-기능이-필요한-경우에는-어떻게"><a href="#finalizer-기능이-필요한-경우에는-어떻게" class="headerlink" title="finalizer 기능이 필요한 경우에는 어떻게?"></a>finalizer 기능이 필요한 경우에는 어떻게?</h1><p>Autocloseable Interface를 사용하여 close를 호출시키도록 하자.<br>다음장의 try-catch-resource 구문에서 설명하도록 하겠다.</p>
<h1 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h1><ul>
<li>Effective Java 3rd Edition - Item 8. finalizer와 cleaner 사용은 피하라</li>
<li><a target="_blank" rel="noopener" href="http://www.yunsobi.com/blog/entry/finalize-%EB%A9%94%EC%86%8C%EB%93%9C%EC%9D%98-%EC%98%A4%EB%B2%84%EB%9D%BC%EC%9D%B4%EB%94%A9%EC%9D%84-%EC%9E%90%EC%A0%9C%ED%95%B4%EC%95%BC%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0">finalize 메소드의 오버라이딩을 자제해야 하는 이유.</a></li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="../../2019/01/07/effective-java-item7/">Item 7. 다 쓴 객체는 참조를 해제하라</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-01-07</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="../../tags/Effective-Java/">Effective-Java</a></span><div class="content"><h1 id="서론"><a href="#서론" class="headerlink" title="서론"></a>서론</h1><p>Java의 장점 중 하나는 가비지 컬렉션을 지원하는 언어라는 점이다.<br>C, C++ 처럼 개발자가 메모리를 직접 할당하고 해제하는 방식이 아니기 때문에 Java에서는 메모리 관리가 굉장히 편하다는 장점이 있다.</p>
<p>하지만 <code>아예 신경을 안써도 되는 것은 아니다.</code><br>가비지 컬렉션을 통해 소멸 대상이 되는 객체가 되기 위해서는 어떠한 reference 변수에서 가르키지 않아야 한다.<br>다 쓴 객체에 대한 참조를 해제하지 않으면 가비지 컬렉션의 대상이 되지 않아 계속 메모리가 할당 되는 <strong>메모리 누수</strong> 현상이 발생 된다.</p>
<p>가비지 컬렉션을 지원하는 언어에서는 메모리 누수를 찾기가 까다롭다<br>객체 참조(reference)를 하나 살려두면, 가비지 컬렉터는 그 객체 뿐만 아니라 그 객체 내에서 참조하고 있는 객체까지 회수 할 수 없다.</p>
<p>이로 인해 잠재적으로 성능에 악영향을 줄 수 있다.</p>
<h1 id="가비지-컬렉션의-소멸-대상이-되기-위해서는…"><a href="#가비지-컬렉션의-소멸-대상이-되기-위해서는…" class="headerlink" title="가비지 컬렉션의 소멸 대상이 되기 위해서는…"></a>가비지 컬렉션의 소멸 대상이 되기 위해서는…</h1><h2 id="직접-할당-해제"><a href="#직접-할당-해제" class="headerlink" title="직접 할당 해제"></a>직접 할당 해제</h2><ul>
<li>이 방법은 굉장히 단순하다.<br>말 그대로 객체 참조 변수를 null로 초기화 한다.<br>그렇게 되면 실제 heap 메모리에 존재하는 객체는 어떠한 참조(reference)도 가지지 않기 때문에<br><code>가비지 컬렉션의 소멸 대상</code>이 된다.</li>
<li>하지만 바람직한 방법은 아니다. 반드시 필요한 경우에만 사용 할 수 있도록 하는 것이 좋다.<br>(소스코드가 드러워짐 -_-)</li>
<li>클래스 내에서 메모리를 관리 하는 객체(Stack 같은…)라면 이 방법을 통해 다 쓴 객체는 할당을 해제 하는 것이 옳다.</li>
</ul>
<h2 id="Scope를-통한-자동-할당-해제"><a href="#Scope를-통한-자동-할당-해제" class="headerlink" title="Scope를 통한 자동 할당 해제"></a>Scope를 통한 자동 할당 해제</h2><ul>
<li>보통은 변수 선언<code>(대게 지역변수)</code>과 동시에 초기화를 사용한다.<br>그 변수에 대한 scope가 종료되는 순간 reference가 해제되어 가비지 컬렉션의 대상이 된다.</li>
<li>try<del>catch와 같은 구문에서는 catch 구문에서 try내에서 사용하는 변수를 참조하지 못하므로<br>try</del>catch 변수 초기화를 하기 어렵다.<br>그렇게 때문에 finally 구문에서 변수에 대한 참조를 해제한다.</li>
</ul>
<h1 id="메모리-누수를-일으키는-주범"><a href="#메모리-누수를-일으키는-주범" class="headerlink" title="메모리 누수를 일으키는 주범"></a>메모리 누수를 일으키는 주범</h1><ul>
<li>첫번째는 위에서 설명한 class내에서 instance에 대한 참조(reference)를 관리하는 객체이다.</li>
<li>두번째는 Map과 같은 캐시</li>
<li>세번째는 리스너(Listener) 혹은 콜백(Callback)</li>
</ul>
<p>Map과 같은 캐시에 객체참조를 넣어두고 사용이 끝났는데도 초기화를 안시켜주는 경우 메모리 누수가 발생한다.<br>엔트리가 살아있는 동안만 캐시를 사용하려면 <code>WeakHashMap</code>을 사용하자.<br>WeakHashMap을 이해하려면 Java의 Reference를 좀 알아야 한다.</p>
<h2 id="Java-Reference"><a href="#Java-Reference" class="headerlink" title="Java Reference"></a>Java Reference</h2><p>Java에는 4가지의 Reference가 있다.</p>
<ul>
<li><p>Strong Reference</p>
<ul>
<li>우리가 흔히 사용하는 reference</li>
<li>String str &#x3D; new String(“abc”); 와 같은 형태</li>
<li>Strong Reference는 GC의 대상이 되지 않는다. </li>
<li>Strong Reference관계의 객체가 GC가 되기 위해선 null로 초기화해<br>객체에 대한 Reachability상태를 UnReachable 상태로 만들어 줘야 한다.</li>
</ul>
</li>
<li><p>Soft Reference</p>
<ul>
<li>객체의 Reachability가 Strongly Reachable 객체가 아닌 객체 중 Soft Reference만 있는 상태</li>
<li>SoftReference<Class> ref &#x3D; new SoftReference&lt;&gt;(new String(“abc”));와 같은 형태로 사용</li>
<li>Soft Reference는 대게 GC대상이 아니다가 <code>out of memory에러</code>가 나기 직전까지 가면<br>Soft Reference 관계에 있는 객체들은 GC대상이 된다.</li>
</ul>
</li>
<li><p>Weak Reference</p>
<ul>
<li>객체의 Reachability가 Strongly Reachable 객체가 아닌 객체 중 Soft Reference가 없고 Weak Reference만 있는 상태</li>
<li>WeakReference<Class> ref &#x3D; new WeakReference<Class>(new String(“abc”)); 와 같은 형태로 사용</li>
<li>WeakReference는 GC가 발생 할 때마다 대상이 된다.</li>
</ul>
</li>
<li><p>Phantomly Reference</p>
<ul>
<li>객체의 Reachability가 Strongly Reachable 객체가 아닌 객체 중 Soft Reference와 Weak Referencerk 모두가 해당되지 않는 객체</li>
<li>finalize 되었지만 메모리가 아직 회수 되지 않은 객체</li>
<li>아직 잘 이해가… 안됨</li>
</ul>
</li>
</ul>
<h2 id="WeakHashMap"><a href="#WeakHashMap" class="headerlink" title="WeakHashMap"></a>WeakHashMap</h2><p>Weak Reference를 이용한 HashMap<br>아래의 예제코드를 보자</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassWeakHashMap</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Referred</span> &#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">finalize</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Good bye cruel world&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * GC를 발생 시켜 메모리를 회수하는 코드</span></span><br><span class="line"><span class="comment">    * System.gc()가 잘 동작할지는 모르겠다.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">collect</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Suggesting collection&quot;</span>);</span><br><span class="line">        System.gc();</span><br><span class="line">        System.out.println(<span class="string">&quot;Sleeping&quot;</span>);</span><br><span class="line">        Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Creating weak references&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// This is now a weak reference. </span></span><br><span class="line">        <span class="comment">// The object will be collected only if no strong references. </span></span><br><span class="line">        <span class="type">Referred</span> <span class="variable">strong</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Referred</span>(); <span class="comment">//Strong Reference로 하나 추가</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//Weak Reference를 이용한 WeakHashMap에 엔트리를 추가하여</span></span><br><span class="line">        <span class="comment">//Weak Reference 추가</span></span><br><span class="line">        Map&lt;Referred, String&gt; metadata = <span class="keyword">new</span> <span class="title class_">WeakHashMap</span>&lt;Referred, String&gt;();</span><br><span class="line">        metadata.put(strong, <span class="string">&quot;WeakHashMap&#x27;s make my world go around&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Attempt to claim a suggested reference. </span></span><br><span class="line">        ClassWeakHashMap.collect();</span><br><span class="line">        <span class="comment">//여기서는 gc가 발생해도 GC대상이 아니게 된다.</span></span><br><span class="line">        <span class="comment">//strong이라는 변수를 통해 Strong Reference를 가지므로 GC 대상이 아니다.</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Still has metadata entry? &quot;</span> + (metadata.size() == <span class="number">1</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;Removing reference&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// The object may be collected. </span></span><br><span class="line">        <span class="comment">//Strong Reference를 끊었다.</span></span><br><span class="line">        strong = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//여기서는 Weak Reference만 남아 있기 때문에 GC대상이 된다.</span></span><br><span class="line">        ClassWeakHashMap.collect();</span><br><span class="line">        System.out.println(<span class="string">&quot;Still has metadata entry? &quot;</span> + (metadata.size() == <span class="number">1</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;Done&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Weak Reference를 가지고 있으면 GC가 발생되기 전까지 객체에 접근이 가능하기 때문에 메모리 누수의 입장으로 볼 때 유리한 것 같다.<br>한번 캐싱하고 사용하고 버리는 대상에 좋은 방법이다.</p>
<p>하지만 static한 Map을 사용하는 경우에는 비추이다.<br>언제 GC가 일어날지 모를 뿐더러.. 갑자기 데이터가 사라져 자칫 하면 장애가 발생 할 수 있으니,<br>특별한 경우에만 WeakHashMap을 사용해야 한다.</p>
<h2 id="리스너-혹은-콜백"><a href="#리스너-혹은-콜백" class="headerlink" title="리스너 혹은 콜백"></a>리스너 혹은 콜백</h2><p>리스너와 콜백은 root set에 대한 직접 참조가 아닌 객체에서 참조를 가지고 있다.<br>그렇기 때문에 리스너와 콜백을 사용하는 객체가 unreachable 상태가 되지 않는 이상 메모리에서 GC대상이 되지 않는다.<br>이 경우 weak reference를 이용하면 리스너와 콜백을 사용하고, GC 작동 시에 메모리 해제를 시킬 수 있어, 메모리 누수에 도움이 된다.</p>
<h1 id="추가적으로"><a href="#추가적으로" class="headerlink" title="추가적으로.."></a>추가적으로..</h1><p>메모리 누수는 겉으로 잘 드러나지 않아 수년 간 잠복하는 사례가 있다고 한다.<br>이런 누수는 철저한 코드리뷰나 힙 프로파일링 도구를 통해 디버깅을 동원해야 발견할 수 있으므로,<br>평소에 코드를 작성할 때 메모리 누수에 대한 부분을 신경을 써주는 것이 중요하다.</p>
<h1 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h1><ul>
<li>Effective Java 3rd Edition - Item 7. 다 쓴 객체는 참조를 해제하라</li>
<li><a target="_blank" rel="noopener" href="https://d2.naver.com/helloworld/329631">https://d2.naver.com/helloworld/329631</a></li>
<li><a target="_blank" rel="noopener" href="https://tourspace.tistory.com/42">https://tourspace.tistory.com/42</a></li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="../../2019/01/07/effective-java-item6/">Item 6. 불필요한 객체 생성을 피하라</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-01-07</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="../../tags/Effective-Java/">Effective-Java</a></span><div class="content"><h1 id="서론"><a href="#서론" class="headerlink" title="서론"></a>서론</h1><p>똑같은 기능의 객체를 매번 생성하기 보다는 객체 하나는 재사용하는 편이 나을 때가 많다. (아니 거의 무조건 재사용 할 수 있으면 하는 게 좋다.)<br>재사용은 빠르고 세련되며, 특히 불변 객체는 언제든지 안전하게 재사용 할 수 있다.</p>
<h1 id="아주-안-좋은-객체-생성의-예"><a href="#아주-안-좋은-객체-생성의-예" class="headerlink" title="아주 안 좋은 객체 생성의 예"></a>아주 안 좋은 객체 생성의 예</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;Hello&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>이러한 코드는 매번 새로운 String 객체를 생성하게 된다.</p>
<h1 id="String-Constant-pool"><a href="#String-Constant-pool" class="headerlink" title="String Constant pool"></a>String Constant pool</h1><p>위의 코드를 조금 더 보완하면 아래 코드 처럼 사용할 수 있다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;Hello&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>Java JVM에는 String Constant pool 이라는 것이 있다.<br>(Java 7 버전을 기점으로 Perm영역 -&gt; Heap 영역으로 변경되었다.)<br>위 처럼 쓰는 방식을 String 리터럴 방식이라 한다.  </p>
<p>String 리터럴을 사용할 경우 기본적으로 String 내장 메서드인 intern()이라는 메서드를 호출하게 된다. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">a</span> <span class="operator">=</span> <span class="string">&quot;Hello&quot;</span>; <span class="comment">// 1</span></span><br><span class="line"><span class="type">String</span> <span class="variable">b</span> <span class="operator">=</span> <span class="string">&quot;Hello&quot;</span>; <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<ol>
<li>최초로 Hello라는 String 리터럴을 사용하였기 때문에 intern() 메서드가 호출된다.</li>
</ol>
<p>–&gt; String Constant pool에서 해당 문자열을 검색하였지만 존재 하지 않기 때문에 String Constant pool에 넣고 새로운 주소값을 반환한다.</p>
<ol start="2">
<li>두번째로 Hello라는 String 리터럴을 사용하였기 때문에 마찬가지로 intern() 메서드가 호출된다.</li>
</ol>
<p>–&gt; String Constant pool에서 해당 문자열을 검색하니 기존에 등록된 주소 값이 반환된다.</p>
<p>실질적으로 a와 b는 같은 주소값을 가지게 된다.</p>
<p>그렇기 때문에 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(a == b);      <span class="comment">//true</span></span><br><span class="line">System.out.println(a.equals(b)); <span class="comment">//true</span></span><br></pre></td></tr></table></figure>

<p>위의 코드를 실행해 보면 객체의 동등성 비교와 동일성 비교에서 모두 true가 나온다.</p>
<ul>
<li>동등성(equality) : 두 객체의 내용이 같은지 비교</li>
<li>동일성(identity) : 두 객체가 같은 객체인지 hashcode를 비교</li>
</ul>
<p>그렇기 때문에 String을 사용할 경우에는 new를 이용한 객체 생성 방식보다 String 리터럴을 사용하는 방식이 더 좋다. (같은 객체를 재사용 하기 때문)</p>
<blockquote>
<p>그렇다고 실제 코드에서 String 리터럴을 사용했다고 <code>==</code> 을 이용한 동일성 비교는 하지말자.<br>상당히 위험한 코드이고, 다른 결과를 초래 할 가능성이 매우 높다.</p>
</blockquote>
<h1 id="Boolean의-예시"><a href="#Boolean의-예시" class="headerlink" title="Boolean의 예시"></a>Boolean의 예시</h1><p>Boolean의 경우 new Boolean(true)보다 Boolean.valueOf를 사용하는 것이 더 좋다.</p>
<p>Boolean 클래스를 보면..</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Boolean</span> <span class="keyword">implements</span> <span class="title class_">java</span>.io.Serializable,</span><br><span class="line">                                      Comparable&lt;Boolean&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The &#123;<span class="doctag">@code</span> Boolean&#125; object corresponding to the primitive</span></span><br><span class="line"><span class="comment">     * value &#123;<span class="doctag">@code</span> true&#125;.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Boolean</span> <span class="variable">TRUE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Boolean</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The &#123;<span class="doctag">@code</span> Boolean&#125; object corresponding to the primitive</span></span><br><span class="line"><span class="comment">     * value &#123;<span class="doctag">@code</span> false&#125;.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Boolean</span> <span class="variable">FALSE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Boolean</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The value of the Boolean.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@serial</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">boolean</span> value;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** use serialVersionUID from JDK 1.0.2 for interoperability */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">3665804199014368530L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Deprecated(since=&quot;9&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Boolean</span><span class="params">(<span class="type">boolean</span> value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Deprecated(since=&quot;9&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Boolean</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(parseBoolean(s));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">parseBoolean</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;true&quot;</span>.equalsIgnoreCase(s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@HotSpotIntrinsicCandidate</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">booleanValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@HotSpotIntrinsicCandidate</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Boolean <span class="title function_">valueOf</span><span class="params">(<span class="type">boolean</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (b ? TRUE : FALSE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>new Boolean의 경우 그때그때 새로운 객체를 생성하게 된다.<br>(로컬 컴퓨터에는 OpenJDK 11이 설치되어있는데 Java 9 버전 부터 Boolean 생성자는 Deprecated 처리 되었다.)</p>
<p>하지만, Boolean.valueOf 라는 정적 메서드는 TRUE, FLASE라는 정적 필드에 이미 생성한 인스턴스를 사용하고 있기 때문에<br>객체를 추가적으로 생성하지 않아 성능상 이점이 있기 때문이다.</p>
<h1 id="Auto-Boxing을-주의하라"><a href="#Auto-Boxing을-주의하라" class="headerlink" title="Auto Boxing을 주의하라!"></a>Auto Boxing을 주의하라!</h1><p>오토박싱은 Java 5 부터 나온 기능이다.<br>primitive 타입과 Class 타입을 자동으로 변환해 주는 기능이다.<br>이 기능에 대해 간과하게 되면 쓸 데 없는 객체를 많이 만들어 낼 수 있다.  </p>
<p>책에 소개 된 예제를 잠깐 돌아보면..</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">sum</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">Long</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0L</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">long</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= Integer.MAX_VALUE; i++) &#123;</span><br><span class="line">    sum += i; <span class="comment">//i에 대해 Auto Boxing이 일어나고 있다.</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>i가 더해질 때 마다 AutoBoxing이 발생하게 된다.<br>sum 변수를 쓸데 없이 long으로 선언해서 Long객체가 2^32개 만큼 쓸데 없이 생성 되었다. (책에는 231개라고 나와있는데 오타일 거라 생각한다.)<br>sum을 long으로만 바꿔줘도 불필요한 객체가 생성되는 일은 없을 것이며, 성능도 더 빨라지게 된다. (책에서는 6.3초 -&gt; 0.59초로 성능 향상을 보았다고 한다.)</p>
<h1 id="나만의-객체-Pool을-만들지-말자"><a href="#나만의-객체-Pool을-만들지-말자" class="headerlink" title="나만의 객체 Pool을 만들지 말자"></a>나만의 객체 Pool을 만들지 말자</h1><p>객체를 생성하는 비용이 많이 드는 객체라면 미리 pool을 생성하여 사용하면 좋다.<br>JDBC에서 사용하는 Connection pool은 생성비용이 높기 때문에 재사용성을 높이기 위해 pool을 사용하는 것이 좋다.<br>하지만 일반적으로 개인이 만든 pool은 코드를 헷갈리게 하고 성능을 떨어뜨린다.<br>(요즘 GC는 최적화가 잘되서, pool을 만드는 것보다 그냥 객체를 생성하는게 더 빠르다고 한다.)</p>
<h1 id="예외는-있다"><a href="#예외는-있다" class="headerlink" title="예외는 있다."></a>예외는 있다.</h1><p>방어적 복사본을 만들어야 하는 경우가 있다.<br>불변 객체를 유지하기 위해 객체를 수정할 때 마다 새로운 객체를 만들어서 데이터를 수정하는 방식인데, 얼핏 보면 쓸 떼 없는 객체를 생성하는 것 처럼 보인다.<br>하지만 객체를 좀 더 만드는 피해보다, 객체가 재사용 되면서 불변성이 깨져 버그가 발생하는 피해가 더 크다는 사실을 명심해야 한다.</p>
<h1 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h1><ul>
<li>Effective Java 3rd Edition - Item 6. 불필요한 객체 생성을 피하라</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="../../2019/01/07/effective-java-item5/">Item 5. 자원을 직접 명시하지 말고 의존 객체 주입을 사용하라</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-01-07</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="../../tags/Effective-Java/">Effective-Java</a></span><div class="content"><h1 id="서론"><a href="#서론" class="headerlink" title="서론"></a>서론</h1><p>사용하는 자원에 따라 동작이 달라지는 클래스에는 정적 유틸리티 방식이나, 싱글턴 방식이 적합하지 않다.<br>자원에 따라 동작이 달라진다면, 자원의 수만큼 인스턴스를 만들어 동작하게 하는 것이 좋다.<br>이를 <code>의존 객체 주입</code>이라고 하는데 Spring과 같은 프레임워크에서 DI의 개념으로 많이 쓰이고 있다.</p>
<p>의존 객체 주입은 생성자, 정적팩터리, 빌더 혹은 Setter를 이용해서 자원을 넘겨 줄 수 있다.</p>
<h1 id="팩터리-메서드-패턴-사용하여-자원-넘겨주기"><a href="#팩터리-메서드-패턴-사용하여-자원-넘겨주기" class="headerlink" title="팩터리 메서드 패턴 사용하여 자원 넘겨주기"></a>팩터리 메서드 패턴 사용하여 자원 넘겨주기</h1><p>자바8에서는 Supplier<T> 인터페이스가 팩터리를 표현한 완벽한 예다.<br>Supplier<T>를 입력으로 받는 메서드는 일반적으로 한정적 와일드 카드 타입을 사용해 팩터리의 타입 매개변수를 제한한다.</p>
<p>아래의 예제처럼 사용한다.<br>타일들을 이용해 모자이크를 만드는 예제이다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mosaic <span class="title function_">create</span><span class="params">(Supplier&lt;? extends Tile&gt; tileFactory)</span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<h1 id="요약"><a href="#요약" class="headerlink" title="요약"></a>요약</h1><ul>
<li>클래스가 내부적으로 하나 이상의 자원에 의존하고, 그 자원이 클래스 동작에 영향을 준다면 싱글턴과 정적 유틸 클래스는 사용하지 말자!</li>
<li>필요한 자원 또는 팩터리를 생성자나 빌더를 통해 의존 객체를 주입하도록 하자</li>
<li>의존 객체 주입은 유연성, 재사용성, 테스트 용이성을 높여 줄 것이다.</li>
</ul>
<h1 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h1><ul>
<li>Effective Java 3rd Edition - Item 5. 자원을 직접 명시하지 말고 의존 객체 주입을 사용하라</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="../../2019/01/07/effective-java-item4/">Item 4. 인스턴스화를 막으려거든 Private 생성자를 사용하라</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-01-07</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="../../tags/Effective-Java/">Effective-Java</a></span><div class="content"><h1 id="서론"><a href="#서론" class="headerlink" title="서론"></a>서론</h1><p>단순히 static 메서드와 static 필드만을 담은 클래스를 만들고 싶을 때가 있다.<br>보통 Utils 클래스를 정의할 떄 이런식으로 많이 사용하는데, 이러한 클래스는 인스턴스를 만들어서 사용하고자 만든 목적이 아니기 때문에 인스턴스화를 막아야 한다.<br>생성자를 하나도 명시 하지 않으면 Java에서는 매개변수가 없는 default 생성자를 만들어 준다. </p>
<h1 id="추상-클래스로-만들면"><a href="#추상-클래스로-만들면" class="headerlink" title="추상 클래스로 만들면?"></a>추상 클래스로 만들면?</h1><p>추상 클래스로 만드는 것으로는 인스턴스 화를 막을 수 없다.<br>단순히 상속을 통해 인스턴스를 만들 수 있기 때문이다. 오히려 abstract 클래스는 하위클래스를 만들어서 사용하라는 뉘앙스가 더 강하다.</p>
<h1 id="private-생성자를-만들자"><a href="#private-생성자를-만들자" class="headerlink" title="private 생성자를 만들자"></a>private 생성자를 만들자</h1><p>private 생성자를 만드는 것 만으로도 인스턴스화를 막을 수 있다.<br>외부에서 new 키워드를 통해 인스턴스를 만들 수 없기 때문이다.</p>
<p>이중 보안을 하자면.. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="title function_">Utils</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AssertionError</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이런 식으로 Error를 발생 시켜주자.</p>
<p>평소 코딩할 때는 Lombok을 이용해서 깔끔하게 등록해 주는 것도 방법이다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NoArgsConstructor(access = AccessLevel.PRIVATE)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Utils</span>() &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h1><ul>
<li>Effective Java 3rd Edition - Item 4. 인스턴스화를 막으려거든 private 생성자를 사용하라</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="../../2019/01/07/effective-java-item3/">Item 3. Private 생성자나 열거 타입으로 싱글턴임을 보증하라</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-01-07</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="../../tags/Effective-Java/">Effective-Java</a></span><div class="content"><h1 id="싱글턴이란"><a href="#싱글턴이란" class="headerlink" title="싱글턴이란?"></a>싱글턴이란?</h1><p>싱글턴 객체란 Application내에서 단 1개의 인스턴스만 생성할 수 있는 클래스를 의미한다.<br>시스템에서 유일성을 보장하기 위해 1개만 만들어야 하는 경우도 있고, 시스템 구조 상 1개 이상이 되면 개념적으로 맞지 않는 상황도 있기 때문이다.</p>
<h1 id="싱글턴을-만드는-방법"><a href="#싱글턴을-만드는-방법" class="headerlink" title="싱글턴을 만드는 방법"></a>싱글턴을 만드는 방법</h1><h2 id="private-생성자-static-객체"><a href="#private-생성자-static-객체" class="headerlink" title="private 생성자 + static 객체"></a>private 생성자 + static 객체</h2><p>private 생성자를 통해 내부에서만 객체를 생성 할 수 있도록 하고,<br>public static final 키워드를 이용해 static 변수로 1개의 인스턴스만 제공하는 방식이다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Elvis</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Elvis</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Elvis</span>();</span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">Elvis</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>사용자가 Elvis 객체를 클라이언트에서 사용하기 위해서는<br>외부로 노출 된 생성자가 없기 때문에 Elvis.INSTANCE의 형태로 사용해야만 한다.<br>최초로 INSTANCE 변수가 초기화 될 때 private 생성자를 통해 단 한번 인스턴스가 생성되게 된다.</p>
<blockquote>
<p>하지만, Java의 Reflection기능을 이용하여, AccessibleObject.setAccessible(true)를 이용하면 private 생성자를 호출 할 수 있다.<br>(이런 부분은 논외로 한다.)  여차하면 두번째 호출 부터 Exception을 발생 시켜 싱글턴을 보장할 수 있도록 방어로직을 심을 수 있다.</p>
</blockquote>
<h2 id="정적-팩터리-메서드"><a href="#정적-팩터리-메서드" class="headerlink" title="정적 팩터리 메서드"></a>정적 팩터리 메서드</h2><p>위의 private 생성자 + static 객체에서 조금 진화된 형태가 클래스에서 정적 팩터리 메서드를 제공하는 case이다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Elvis</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Elvis</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Elvis</span>();</span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">Elvis</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Elvis <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> INSTANCE;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><p>지금은 싱글턴 객체를 리턴하는 정적 메서드이지만, 향후 필요에 따라 변경될 수 있는 확장성을 가지고 있다.<br>특정 파라미터나, 특정 스레드에는 다른 인스턴스를 리턴한다던지에 대해 확장과 변경에 열려 있는 장점이 있다.</p>
</li>
<li><p>원한다면 정적 팩터리를 제네릭 싱글턴 팩터리로 만들 수 있다.</p>
</li>
<li><p>정적 팩터리 메서드의 참조를 공급자(Supplier)로 만들 수 있다.</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Elvis</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Elvis</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Elvis</span>();</span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">Elvis</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Elvis <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> INSTANCE;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Supplier&lt;Elvis&gt; <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> () -&gt; INSTANCE;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="열거-타입-Enum-을-이용한-싱글턴-객체-생성"><a href="#열거-타입-Enum-을-이용한-싱글턴-객체-생성" class="headerlink" title="열거 타입(Enum)을 이용한 싱글턴 객체 생성"></a>열거 타입(Enum)을 이용한 싱글턴 객체 생성</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Elvis</span> &#123;</span><br><span class="line">  INSTANCE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>1번째 예시와 비슷하지만 가장 안전하고 좋은 방법이다.<br>복잡한 직렬화 상황이나, 리플렉션 공격에도 안전하다.<br>단, 만들려는 싱글턴이 Enum이외의 클래스를 상속해야 한다면 이 방법은 사용할 수 없다.<br>(열거 타입이 다른 인터페이스를 구현하도록 하는 건 가능.)</p>
<h1 id="싱글턴-객체의-직렬화"><a href="#싱글턴-객체의-직렬화" class="headerlink" title="싱글턴 객체의 직렬화"></a>싱글턴 객체의 직렬화</h1><p>싱글턴 클래스를 직렬화 하기 위해서는 Serializable을 구현한다고 선언하는 것 만으로는 부족하다.<br>모든 인스턴스 필드에 transient 예약어를 붙여 직렬화를 막은 다음 readResolve 메서드를 제공해야 한다.<br>이렇게 하지 않으면 역직렬화 시점에 새로운 인스턴스가 생성 된다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Elvis</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Elvis</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Elvis</span>();</span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">Elvis</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Elvis <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> INSTANCE;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//역직렬화가 되어 새로운 인스턴스가 생성되더라도, </span></span><br><span class="line">  <span class="comment">//클래스간 공유 변수인 static 변수를 이용하면 싱글턴을 보장 할 수 있다.</span></span><br><span class="line">  <span class="comment">// 새로운 인스턴스는 GC에 의해 UnReachable 형태로 판별되어 제거된다.</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">readResolve</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> INSTANCE;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h1><ul>
<li>Effective Java 3rd Edition - Item 3. private 생성자나 열거 타입으로 싱글턴임을 보증하라</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="../../2019/01/06/effective-java-item2/">Item 2. 생성자에 매개변수가 많다면 빌더를 고려하라</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-01-06</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="../../tags/Effective-Java/">Effective-Java</a></span><div class="content"><h1 id="서론"><a href="#서론" class="headerlink" title="서론"></a>서론</h1><p>정적 팩터리 메서드 팩터리와 생성자에는 똑같은 제약이 하나 있다.<br>선택적 매개변수가 많을 경우에 적절하게 대응하기 어렵다는 점이다.<br>매개변수가 3~4개까지는 어떻게 해보겠지만 엄청 많은 경우에는 생성자를 이용해 객체를 생성하는 과정부터가 곤욕이다.</p>
<p>아래의 예시를 보자</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NutritionFacts</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> servingSize;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> servings;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> calories;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> fat;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> sodium;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> carbohydrate;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">NutritionFacts</span><span class="params">()</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">NutritionFacts</span><span class="params">(<span class="type">int</span> servingSize, <span class="type">int</span> servings, <span class="type">int</span> calories, <span class="type">int</span> fat, <span class="type">int</span> sodium, <span class="type">int</span> carbonhydrate)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.servingSize = servingSize;    <span class="comment">//필수</span></span><br><span class="line">    <span class="built_in">this</span>.servings = servings;          <span class="comment">//필수</span></span><br><span class="line">    <span class="built_in">this</span>.calories = calories;          <span class="comment">//선택</span></span><br><span class="line">    <span class="built_in">this</span>.fat = fat;                    <span class="comment">//선택</span></span><br><span class="line">    <span class="built_in">this</span>.sodium = sodium;              <span class="comment">//선택</span></span><br><span class="line">    <span class="built_in">this</span>.carbohydrate = carbohydrate;  <span class="comment">//선택</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>매개변수가 int만 6개로 이루어져 있다.<br>그리고 default value가 정해져 있지 않기 때문에, servingSize 같은 변수는 정의하기 싫으면 0으로 해야할 지, 아니면 최소값이 있을지 알기가 어렵다.<br>그리고 매개변수 선언 순서가 바뀌면 의도하지 않은 객체가 생성되기 때문에 코딩 할 때 매우 주의를 요해야 한다.</p>
<h1 id="점층적-생성자-패턴"><a href="#점층적-생성자-패턴" class="headerlink" title="점층적 생성자 패턴"></a>점층적 생성자 패턴</h1><p>위와 같은 문제를 조금이나마 해결해 보려는 노력이 점층적 생성자 패턴이다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">NutritionFacts</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> servingSize;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> servings;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> calories;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> fat;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> sodium;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> carbohydrate;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">NutritionFacts</span><span class="params">()</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">NutritionFacts</span><span class="params">(<span class="type">int</span> servingSize, <span class="type">int</span> servings)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.servingSize = servingSize;    <span class="comment">//필수</span></span><br><span class="line">    <span class="built_in">this</span>.servings = servings;          <span class="comment">//필수</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">NutritionFacts</span><span class="params">(<span class="type">int</span> servingSize, <span class="type">int</span> servings, <span class="type">int</span> calories)</span> &#123;</span><br><span class="line">     <span class="built_in">this</span>(servingSize, servings);</span><br><span class="line">     <span class="built_in">this</span>.calories = calories;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">NutritionFacts</span><span class="params">(<span class="type">int</span> servingSize, <span class="type">int</span> servings, <span class="type">int</span> calories, <span class="type">int</span> fat)</span> &#123;</span><br><span class="line">     <span class="built_in">this</span>(servingSize, servings, calories);</span><br><span class="line">     <span class="built_in">this</span>.fat = fat;     </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">NutritionFacts</span><span class="params">(<span class="type">int</span> servingSize, <span class="type">int</span> servings, <span class="type">int</span> calories, <span class="type">int</span> fat, <span class="type">int</span> sodium, <span class="type">int</span> carbonhydrate)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.servingSize = servingSize;    <span class="comment">//필수</span></span><br><span class="line">    <span class="built_in">this</span>.servings = servings;          <span class="comment">//필수</span></span><br><span class="line">    <span class="built_in">this</span>.calories = calories;          <span class="comment">//선택</span></span><br><span class="line">    <span class="built_in">this</span>.fat = fat;                    <span class="comment">//선택</span></span><br><span class="line">    <span class="built_in">this</span>.sodium = sodium;              <span class="comment">//선택</span></span><br><span class="line">    <span class="built_in">this</span>.carbohydrate = carbohydrate;  <span class="comment">//선택</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>이것도 선택사항에 대해 하나의 방법으로 작용할 수 있지만, 코드가 길어지고 가독성이 떨어지게 된다.<br>실제로 매개변수의 위치에 따라 의도하지 않은 객체가 생성될 수 있기 때문에 주의를 요해야 하는 코드이다.</p>
<h1 id="Java-Beans-패턴"><a href="#Java-Beans-패턴" class="headerlink" title="Java Beans 패턴"></a>Java Beans 패턴</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">NutritionFacts</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">servingSize</span> <span class="operator">=</span> -<span class="number">1</span>; </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">servings</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">calories</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">fat</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">sodium</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">carbohydrate</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">NutritionFacts</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setServingSize</span><span class="params">(<span class="type">int</span> servingSize)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.servingSize = servingSize;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setServings</span><span class="params">(<span class="type">int</span> servings)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.servings = servings;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCalories</span><span class="params">(<span class="type">int</span> calories)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.calories = calories;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFat</span><span class="params">(<span class="type">int</span> fat)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.fat = fat;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSodium</span><span class="params">(<span class="type">int</span> sodium)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.sodium = sodium;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCarboHydrate</span><span class="params">(<span class="type">int</span> carbohydrate)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.carbohydrate = carbohydrate;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="type">NutritionFacts</span> <span class="variable">nutritionFacts</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NutritionFacts</span>();</span><br><span class="line"></span><br><span class="line">nutritionFacts.setServingSize(<span class="number">240</span>);</span><br><span class="line">nutritionFacts.setServings(<span class="number">8</span>);</span><br><span class="line">nutritionFacts.setCalories(<span class="number">100</span>);</span><br><span class="line">nutritionFacts.setFat(<span class="number">20</span>);</span><br><span class="line">nutritionFacts.setSodium(<span class="number">35</span>);</span><br><span class="line">nutritionFacts.setCarboHydrate(<span class="number">27</span>);</span><br></pre></td></tr></table></figure>
<p>자바 빈즈 패턴에서는 객체 하나를 만드느느데 메서드를 여러개 호출 해야한다.  객체가 완전히 생성되기 전까지는 일관성이 무너진 상태에 놓이게 된다.<br>또한 객체의 불변셩이 깨지게 되어 코드에서 버그를 생성할 수 있다.</p>
<h1 id="Builder-패턴"><a href="#Builder-패턴" class="headerlink" title="Builder 패턴"></a>Builder 패턴</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">NutritionFacts</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> servingSize;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> servings;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> calories;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> fat;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> sodium;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> carbohydrate;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Builder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> servingSize;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> servings;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">calories</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">fat</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">sodium</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">carbohydrate</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Builder</span><span class="params">(<span class="type">int</span> servingSize, <span class="type">int</span> servings)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.servingSize = servingSize;    <span class="comment">//필수</span></span><br><span class="line">      <span class="built_in">this</span>.servings = servings;          <span class="comment">//필수</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Builder <span class="title function_">calories</span><span class="params">(<span class="type">int</span> calories)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.calories = calories;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Builder <span class="title function_">fat</span><span class="params">(<span class="type">int</span> fat)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.fat = fat;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Builder <span class="title function_">sodium</span><span class="params">(<span class="type">int</span> sodium)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.sodium = sodium;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Builder <span class="title function_">carbohydrate</span><span class="params">(<span class="type">int</span> carbohydrate)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.carbohydrate = carbohydrate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> NutritionFacts <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">NutritionFacts</span>(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">NutritionFacts</span><span class="params">(<span class="type">int</span> servingSize, <span class="type">int</span> servings, <span class="type">int</span> calories, <span class="type">int</span> fat, <span class="type">int</span> sodium, <span class="type">int</span> carbonhydrate)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.servingSize = servingSize;    <span class="comment">//필수</span></span><br><span class="line">      <span class="built_in">this</span>.servings = servings;          <span class="comment">//필수</span></span><br><span class="line">      <span class="built_in">this</span>.calories = calories;          <span class="comment">//선택</span></span><br><span class="line">      <span class="built_in">this</span>.fat = fat;                    <span class="comment">//선택</span></span><br><span class="line">      <span class="built_in">this</span>.sodium = sodium;              <span class="comment">//선택</span></span><br><span class="line">      <span class="built_in">this</span>.carbohydrate = carbohydrate;  <span class="comment">//선택</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">NutritionFacts</span> <span class="variable">nutritionFacts</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NutritionFacts</span>.Builder(<span class="number">240</span>, <span class="number">8</span>)</span><br><span class="line">                                                  .calories(<span class="number">100</span>).sodium(<span class="number">35</span>).carbohydrate(<span class="number">27</span>).build()</span><br></pre></td></tr></table></figure>
<p>빌더 패턴은 (파이썬과 스칼라에 있는) 명명된 선택적 매개변수를 흉내낸 것이다.<br>이런 식으로 하면 Java Beans 패턴의 set 역할을 해주면서 build()를 호출 하는 시점에 변수를 freezing 시켜 불변식을 유지 할 수 있다.<br>하지만 시간이 지날 수록 매개 변수가 늘어날 가능성이 있음을 항상 주의 해야 한다.</p>
<h1 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h1><ul>
<li>Effective Java 3rd Edition - Item 2. 생성자에 매개변수가 많다면 빌더를 고려하라</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="../../2019/01/06/effective-java-item1/">Item 1. 생성자 대신 정적 팩터리 메서드를 고려하라</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-01-06</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="../../tags/Effective-Java/">Effective-Java</a></span><div class="content"><h1 id="서론"><a href="#서론" class="headerlink" title="서론"></a>서론</h1><p>개발자가 클래스의 인스턴스를 생성하는 방법은 new 키워드를 통한 생성자 호출이다.<br>이외에도 생성자와 별도로 정적 팩터리 메서드를 이용해서 메서드 내부에서 생성자나, 이미 생성된 인스턴스를 반환하여 클라이언트 코드에서 인스턴스를 사용 할 수 있다.</p>
<h1 id="정적-Static-팩터리-메서드가-좋은-점"><a href="#정적-Static-팩터리-메서드가-좋은-점" class="headerlink" title="정적(Static) 팩터리 메서드가 좋은 점"></a>정적(Static) 팩터리 메서드가 좋은 점</h1><h2 id="이름을-가질-수-있다"><a href="#이름을-가질-수-있다" class="headerlink" title="이름을 가질 수 있다."></a>이름을 가질 수 있다.</h2><p>생성자의 파라미터 시그니처만으로는 어떤 객체를 반환 할 지에 대한 특성을 이해하기 어렵다.<br>하지만, 정적 팩터리 메서드의 경우는 메서드 이름으로 충분히 유추 할 수 있기 때문에 가독성이 좋아진다.</p>
<h2 id="호출-될-때-마다-인스턴스를-생성하지-않아도-된다"><a href="#호출-될-때-마다-인스턴스를-생성하지-않아도-된다" class="headerlink" title="호출 될 때 마다 인스턴스를 생성하지 않아도 된다."></a>호출 될 때 마다 인스턴스를 생성하지 않아도 된다.</h2><p>new를 통해 인스턴스를 생성하게 되면, 불필요한 중복 객체를 생성할 가능성이 많이진다.<br>하나의 객체를 이용해 캐싱하고 쓰는 경우 정적 팩터리 메서드를 사용하는 게 장점이 될 수 있다.</p>
<p>대표적으로 Boolean에 대한 예시가 있다.<br>매번 new Boolean(false)처럼 사용을 하면 사용할 때 마다 중복되는 Boolean 객체를 생성하게 된다.  </p>
<p>하지만 대충 이런식으로 정적 팩터리 메서드를 제공하는 경우</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Class Boolean&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Boolean</span> <span class="variable">FLASE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Boolean</span>(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Boolean.TRUE = <span class="keyword">new</span> <span class="title class_">Boolean</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="title function_">valueOf</span><span class="params">(<span class="type">boolean</span> b)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> b ? TRUE : FALSE;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>쓸 데 없는 boolean 객체를 만들지 않아도 되기 때문에 메모리 관리 측면에서 유리하다.<br>또한 객체를 싱글턴(singleton)으로 제공할 수 있고, 인스턴스화 불가로 만들 수 도 있다.  </p>
<blockquote>
<p>반복되는 요청에 같은 객체를 반환하는 식으로 정적 팩터리 방식의 클래스는 언제 어느 인스턴스를 살아 있게 할지를 철저히 통제 할 수 있다.<br>이런 클래스를 <strong>인스턴스 통제(instance-controlled) 클래스</strong>라 한다.</p>
</blockquote>
<h2 id="반환타입의-하위타입-객체-Child-를-반환-할-수-있다"><a href="#반환타입의-하위타입-객체-Child-를-반환-할-수-있다" class="headerlink" title="반환타입의 하위타입 객체(Child)를 반환 할 수 있다."></a>반환타입의 하위타입 객체(Child)를 반환 할 수 있다.</h2><p>인터페이스를 사용해 하위타입 객체를 반환 할 수 있다. 인터페이스 기반 프레임워크의 핵심 기술이라고 볼 수 있다.<br>SpringFramework를 사용하는 경우에도 유용하게 사용 할 수 있다.<br>아래와 같은 예시 코드를 보자</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> PaymentService kakaoPaymentService;</span><br><span class="line"><span class="keyword">private</span> PaymentService naverPaymentService;</span><br><span class="line"><span class="keyword">private</span> PaymentService paycoPaymentService;</span><br><span class="line"><span class="keyword">private</span> PaymentService rocketPaymentService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> PaymentService <span class="title function_">getType</span><span class="params">(PaymentType payentType)</span> &#123;</span><br><span class="line">  <span class="keyword">case</span> KAKAO: <span class="keyword">return</span> kakaoPaymentService;</span><br><span class="line">  <span class="keyword">case</span> NAVER: <span class="keyword">return</span> naverPaymentService;</span><br><span class="line">  <span class="keyword">case</span> PAYCO: <span class="keyword">return</span> paycoPaymentService;</span><br><span class="line">  <span class="keyword">case</span> ROCKET: <span class="keyword">return</span> rocketPaymentService;</span><br><span class="line">  <span class="keyword">default</span>: <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>외부 결제 모듈을 사용한다고 가정 했을 때 이런식으로 Interface를 통한 하위타입 객체를 제공할 수 있다.</p>
<h2 id="입력-매개변수에-따라-매번-다른-클래스의-객체를-반환-할-수-있다"><a href="#입력-매개변수에-따라-매번-다른-클래스의-객체를-반환-할-수-있다" class="headerlink" title="입력 매개변수에 따라 매번 다른 클래스의 객체를 반환 할 수 있다."></a>입력 매개변수에 따라 매번 다른 클래스의 객체를 반환 할 수 있다.</h2><p>EnumSet 클래스는 public 생성자 없이 오직 정적 팩터리 메서드만 제공한다.<br>OpenJDK에서는 원소가 64개 이하이면 원소들을 long변수 하나로 관리하는 RegularEnumSet의 인스턴스를 리턴하고,<br>65개 이상이면 long배열로 관리하는 JumboEnumSet의 인스턴스를 반환한다.</p>
<p>클라이언트는 EnumSet 객체이면 되기 때문에 무슨객체가 리턴되든 알 필요가 없다. </p>
<h2 id="정적-팩터리-메서드를-작성하는-시점에는-반환할-객체의-클래스가-존재하지-않아도-된다"><a href="#정적-팩터리-메서드를-작성하는-시점에는-반환할-객체의-클래스가-존재하지-않아도-된다" class="headerlink" title="정적 팩터리 메서드를 작성하는 시점에는 반환할 객체의 클래스가 존재하지 않아도 된다."></a>정적 팩터리 메서드를 작성하는 시점에는 반환할 객체의 클래스가 존재하지 않아도 된다.</h2><p>이러한 유연함은 Service Provider 프레임워크의 근간이 된다.<br>대표적인 예로 JDBC가 있다.</p>
<ol>
<li>DriverManager.registerDriver() 메서드로 각 DBMS별 Driver를 설정한다. (제공자 등록 API)  </li>
<li>DriverManager.getConnection() 메서드로 DB 커넥션 객체를 받는다. (service access API)</li>
<li>Connection Interface는 DBMS 별로 동작을 구현하여 사용할 수 있다. (service Interface)</li>
</ol>
<p>위와 같이 동작하게 된다면 차후에 다른 DBMS가 나오더라도 같은 Interface를 사용하여 기존과 동일하게 사용이 가능하다.</p>
<h1 id="정적-Static-팩터리-메서드의-단점"><a href="#정적-Static-팩터리-메서드의-단점" class="headerlink" title="정적(Static) 팩터리 메서드의 단점"></a>정적(Static) 팩터리 메서드의 단점</h1><h2 id="상속을-하려면-public-x2F-protected-생성자가-필요하다"><a href="#상속을-하려면-public-x2F-protected-생성자가-필요하다" class="headerlink" title="상속을 하려면 public&#x2F;protected 생성자가 필요하다."></a>상속을 하려면 public&#x2F;protected 생성자가 필요하다.</h2><p>상속을 하기 위해서는 public&#x2F;protected 생성자가 필요하니, 정적 팩터리 메서드만 제공하면 하위클래스를 만들 수가 없다.</p>
<blockquote>
<p>컬렉션 프레임 워크의 유틸리티 구현 클래스는 private 생성자만 제공하므로 상속이 불가하다.<br>이러한 제약은 상속보다 컴포지션을 사용하도록 유도되어 오히려 더 장점으로 작용한다.</p>
</blockquote>
<h2 id="정적-팩터리-메서드는-개발자가-찾기-어렵다"><a href="#정적-팩터리-메서드는-개발자가-찾기-어렵다" class="headerlink" title="정적 팩터리 메서드는 개발자가 찾기 어렵다."></a>정적 팩터리 메서드는 개발자가 찾기 어렵다.</h2><p>생성자 처럼 API 설명에 명확히 드러나지 않으니 사용자는 정적 팩터리 메서드 방식 클래스를 인스턴스화 할 방법을 찾아야 한다.</p>
<h1 id="정적-static-팩터리-메서드-명명-규칙"><a href="#정적-static-팩터리-메서드-명명-규칙" class="headerlink" title="정적(static) 팩터리 메서드 명명 규칙"></a>정적(static) 팩터리 메서드 명명 규칙</h1><ul>
<li>from - 매개변수를 하나만 받아서 해당 타입의 인스턴스를 반환하는 메서드<ul>
<li>예시) Date date &#x3D; Date.from(dateStr);</li>
</ul>
</li>
<li>of - 여러 매개변수를 받아 적합한 타입의 인스턴스를 반환하는 집계 메서드<ul>
<li>예시) Set<Rank> faceCards &#x3D; EnumSet.of(JACK, QUEEN, KING);</li>
</ul>
</li>
<li>valueOf - from과 of의 더 자세한 버전<ul>
<li>BigInteger prime &#x3D; BigInteger.valueOf(Integer.MAX_VALUE);</li>
</ul>
</li>
<li>instance(getInstance) - 매개변수를 받는다면, 매개변수로 명시한 인스턴스를 반환하지만, 같은 인스턴스임을 보장하지 않는다.<ul>
<li>StackWalker luke &#x3D; StackWalker.getInstance(options);</li>
</ul>
</li>
<li>create(newInstance) - instance&#x2F;getInstance와 같지만, 매번 새로운 인스턴스를 반환함을 보장한다.</li>
<li>get(Type) - getInstance와 맥락은 같으나 특정 Type을 반환할 때 사용<ul>
<li>Steak steak &#x3D; Food.getSteak(Meet.BEEF);</li>
</ul>
</li>
<li>new(Type) - newInstance와 같으나, 생성할 클래스가 아닌 다른 클래스의 팩터리 메서드를 정의 할 때 사용<ul>
<li>Steak steak &#x3D; Food.newSteak(Meet.BEEF);</li>
</ul>
</li>
<li>(Type) - getType, newType의 같결한 버전<ul>
<li>Steak steak &#x3D; Food.steak(Meet.BEEF);</li>
</ul>
</li>
</ul>
<h1 id="요약"><a href="#요약" class="headerlink" title="요약"></a>요약</h1><p>정적 팩터리 메서드는 각각의 쓰임새가 있으니, 장단점을 잘 인식하고 쓰는게 좋다.<br>대부분의 경우가 정적 팩터리 메서드로 인스턴스를 생성하는게 유리하니 무작정 public 생성자만 사용하는 습관은 고치는게 좋다.</p>
<h1 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h1><ul>
<li>Effective Java 3rd Edition - Item 1. 생성자 대신 정적 팩터리 메서드를 고려하라</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="../../2018/12/30/2018-12-30-mybatis-returnInstanceForEmptyRow/">Mybatis 조회 시, All Element Are Null 이슈</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-12-30</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="../../tags/Spring/">Spring</a><span class="article-meta__link">-</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="../../tags/Mybatis/">Mybatis</a></span><div class="content"><h1 id="들어가며"><a href="#들어가며" class="headerlink" title="들어가며"></a>들어가며</h1><p>사내 시스템 운영 중, SMS를 전송해 주는 부분에서 장애가 발생 하였다.<br>어디에선가 NullPointer Exception이 발생하고 있었다. stacktrace기준으로 추적해 보니,<br>Mybatis를 통해 데이터를 조회 한다음 데이터를 가공하는 과정에서 NullPointerException이 발생하고 있었다.<br>일단 디버깅 이전에 코드를 봤다. 아무리 생각해도 null이 발생하지 않을 것 같았다.</p>
<p>실제 코드를 돌려보았다.<br><img src="./all_element_are_null.png" alt="all_elememt_are_null 에러"></p>
<p>이 메세지는 무엇?<br>구글에 검색해 보니 List내의 모든 Element의 reference가 null인 것이었다.<br>그래서 size는 있지만, 가르키는 instance가 없기 때문에 Nullpointer Exception이 발생하고 있었다.</p>
<p>일단은 조회된 모든 컬럼이 null이면 mybatis에는 null을 리턴해 주는건가? 라는 심증만 가지고<br>절대 null이 될 수 없는 id 컬럼을 조회컬럼에 추가해 주었다.<br>(쿼리내에 outer join의 여파로 null만 나오는 쿼리였다.)<br>일단은 id 컬럼을 추가 해주니, 정상적으로 id만 값이 있고 다른 property는 모두 null인 객체가 생성되었다.<br>일단 이렇게 이슈를 종료하고자 했지만, 너무 찝찝했다</p>
<p>아니 왜? 모든 컬럼이 null이면 왜 객체 생성을 안하지? 우리가 원하는건 null이 아닐텐데…<br>하물며 이런상황에 앞서 조회된 내용에 대해 null 체크를 할 생각을 하니 끔찍했다.</p>
<p>분명 설정이 있으리라 생각하고 mybatis 사이트를 뒤져보았다.<br>뒤져보니 요런게 있었다.</p>
<h2 id="returnInstanceForEmptyRow"><a href="#returnInstanceForEmptyRow" class="headerlink" title="returnInstanceForEmptyRow"></a>returnInstanceForEmptyRow</h2><blockquote>
<p>   MyBatis, by default, returns null when all the columns of a returned row are NULL. When this setting is enabled, MyBatis returns an empty instance instead. Note that it is also applied to nested results (i.e. collectioin and association). Since: 3.4.2</p>
</blockquote>
<p>한 마디로 mybatis option중에는 <code>returnInstanceForEmptyRow</code> 이란 옵션이 있는데, 모든 컬럼이 null이면 row를 null로 리턴해 준단다. (이런 ㅡㅡ)<br>근데 설정 옵션이 true이면 null 대신에 모든 값이 null인 인스턴스를 반환해주고 false이면 null을 반환해 준다고 한다.<br>하지만 default옵션이 false이기 때문에 아무 설정도 안한 회사소스에서는 당연히 null이 리턴되게 된다.<br><code>이 옵션은 mybatis 3.4.2부터 지원한다</code> (회사에서는 mybatis&#x2F;3.4.2이상 버전을 사용하고 있다.)</p>
<h1 id="Test-코드"><a href="#Test-코드" class="headerlink" title="Test 코드"></a>Test 코드</h1><p>테스트 환경은 아래와 같이 설정해 보았다</p>
<ul>
<li>Spring Boot</li>
<li>Mybatis</li>
<li>H2DB</li>
</ul>
<h2 id="환경-설정"><a href="#환경-설정" class="headerlink" title="환경 설정"></a>환경 설정</h2><p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- MyBatis --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.h2database<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>h2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hsqldb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hsqldb<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>application.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Datasource</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:h2:mem:test</span></span><br><span class="line"><span class="attr">spring.datasource.initialization-mode</span>=<span class="string">always</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">sa</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string"></span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">org.h2.Driver</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#h2 setting</span></span><br><span class="line"><span class="attr">spring.h2.console.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">spring.h2.console.path</span>=<span class="string">/h2-console</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># Mybatis Setting</span></span><br><span class="line"><span class="attr">mybatis.mapper-locations</span>=<span class="string">classpath*:mapper/**/*SqlMap.xml</span></span><br><span class="line"><span class="attr">mybatis.configuration.map-underscore-to-camel-case</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">mybatis.configuration.return-instance-for-empty-row</span>=<span class="string">false</span></span><br></pre></td></tr></table></figure>

<p>schema.sql</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test (</span><br><span class="line">    id <span class="type">INTEGER</span> AUTO_INCREMENT <span class="keyword">primary</span> key <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">30</span>),</span><br><span class="line">    description <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>data.sql</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test(id, name, description) <span class="keyword">values</span> (<span class="number">1</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>);</span><br></pre></td></tr></table></figure>

<p>TestRepository.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TestRepository</span> &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;TestDTO&gt; <span class="title function_">getTestAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>TestSqlMap.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.example.springstudy.demo6.TestRepository&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getTestAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.example.springstudy.demo6.TestDTO&quot;</span>&gt;</span></span><br><span class="line">        select name, description from test</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>MybatisConfig.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(basePackages = &quot;com.example.springstudy.demo6&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="Test-Case"><a href="#Test-Case" class="headerlink" title="Test Case"></a>Test Case</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SqlSessionFactoryBean sqlSessionFactoryBean;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TestConfiguration</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">TestContext</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EmbeddedDatabaseBuilder</span>()</span><br><span class="line">                    .setType(EmbeddedDatabaseType.H2)</span><br><span class="line">                    .addDefaultScripts()</span><br><span class="line">                    .build();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="keyword">public</span> SqlSessionFactoryBean <span class="title function_">sqlSessionFactoryBean</span><span class="params">(DataSource dataSource)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">            <span class="type">SqlSessionFactoryBean</span> <span class="variable">sqlSessionFactoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">            sqlSessionFactoryBean.setDataSource(dataSource);</span><br><span class="line">            sqlSessionFactoryBean.getObject()</span><br><span class="line">            		         .getConfiguration()</span><br><span class="line">                                 .setMapUnderscoreToCamelCase(<span class="literal">true</span>);</span><br><span class="line">                                 </span><br><span class="line">            sqlSessionFactoryBean.setMapperLocations(<span class="keyword">new</span> <span class="title class_">ClassPathResource</span>[]&#123;<span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;mapper/TestSqlMap.xml&quot;</span>)&#125;);</span><br><span class="line">            <span class="keyword">return</span> sqlSessionFactoryBean;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * returnInstanceForEmptyRow 설정이 false일때,</span></span><br><span class="line"><span class="comment">     * 모든 컬럼의 데이터가 null인 경우, List내의 항목이 null이 되는 경우 테스트</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">all_element_null_test_returnInstanceForEmptyRow_false</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        sqlSessionFactoryBean.getObject()</span><br><span class="line">                             .getConfiguration()</span><br><span class="line">                             .setReturnInstanceForEmptyRow(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;TestDTO&gt; tests = sqlSessionFactoryBean.getObject()</span><br><span class="line">                .openSession()</span><br><span class="line">                .getMapper(TestRepository.class)</span><br><span class="line">                .getTestAll();</span><br><span class="line"></span><br><span class="line">	<span class="comment">//모든 항목이 null인 경우, List내의 Element가 null이 되므로 제거 된다</span></span><br><span class="line">        tests.removeIf(Objects::isNull);</span><br><span class="line">        assertThat(tests).isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * returnInstanceForEmptyRow 설정이 true일때,</span></span><br><span class="line"><span class="comment">     * 모든 컬럼의 데이터가 null인 경우, 모든 property가 null인 인스턴스가 생성되는지에 대한 테스트</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">all_element_null_test_returnInstanceForEmptyRow_true</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        sqlSessionFactoryBean.getObject()</span><br><span class="line">                             .getConfiguration()</span><br><span class="line">                             .setReturnInstanceForEmptyRow(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;TestDTO&gt; tests = sqlSessionFactoryBean.getObject()</span><br><span class="line">                .openSession()</span><br><span class="line">                .getMapper(TestRepository.class)</span><br><span class="line">                .getTestAll();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//모든 항목이 null인 경우, List내의 Element가 Empty 인스턴스를 가르키므로</span></span><br><span class="line">        <span class="comment">//제거되지 않는다.</span></span><br><span class="line">        tests.removeIf(Objects::isNull);</span><br><span class="line">        assertThat(tests).isNotEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>테스트 코드 실행 결과 returnInstanceForEmptyRow &#x3D; true로 설정 할 경우, empty 객체가 나와 내가 생각한 대로 사용할 수 있게 되었다.</p>
<h1 id="returnInstanceForEmptyRow-옵션-설정-방법"><a href="#returnInstanceForEmptyRow-옵션-설정-방법" class="headerlink" title="returnInstanceForEmptyRow 옵션 설정 방법"></a>returnInstanceForEmptyRow 옵션 설정 방법</h1><h2 id="mybatisConfig-xml"><a href="#mybatisConfig-xml" class="headerlink" title="mybatisConfig.xml"></a>mybatisConfig.xml</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;returnInstanceForEmptyRow&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configurtion</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="application-properties"><a href="#application-properties" class="headerlink" title="application.properties"></a>application.properties</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis.configuration.return-instance-for-empty-row</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>
<h1 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h1><ul>
<li><a target="_blank" rel="noopener" href="http://www.mybatis.org/mybatis-3/configuration.html">http://www.mybatis.org/mybatis-3/configuration.html</a></li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="../../2018/12/16/2018-12-16-remind/">2018년 회고</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-12-16</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="../../tags/2018-remind/">2018-remind</a></span><div class="content"><h1 id="새-직장으로-이직"><a href="#새-직장으로-이직" class="headerlink" title="새 직장으로 이직"></a>새 직장으로 이직</h1><p>2017년 8월 중순 중소 SI업체를 용기있게(?) 뛰쳐나왔다.<br>그 곳에서는 오직 나 한명으로 여러 프로젝트를 돌리고 있었고, 같이 일할 선임개발자도 없었기 때문에<br>굉장히 나름대로 스트레스를 받고 있었다.<br>그리고 모든 프로젝트가 나에게 의존적이었기 때문에 관리해야 할 사이트도 많았고..<br>매일매일 프로젝트 했던 사이트들에 대한 유지보수 전화를 받아가며, 신규 프로젝트를 진행하고 있었다.<br>이렇게 개발자로서 소모되어 가고 있다는 생각이 들어 과감하게 퇴사를 하게되었다. 다음에는 어느정도 조직이 구성되어있고 내가 조직원으로서 일할 수 있는 직장을 찾아야겠다! 라는 생각을 하게되었다.<br>이직하고자 하는 회사의 조건은 이렇다.</p>
<ol>
<li>개발자 한명이 기획, 개발, 유지보수, 영업을 담당하는 작은회사는 가지 않겠다.</li>
<li>더 이상 SI는 하지 않겠다. (지방 출장이 잦고, 프로젝트 단위로 사업이 돌아가는 곳은 가지 않겠다.)</li>
<li>근무지 한 곳에서만 근무 할 수 있는 환경 (예전에는 지방을 여기저기 많이 다녔다.)</li>
<li>시니어 개발자와 주니어 개발자 층이 어느정도 있고, 같이 의논하며 개발할 수 있는 환경</li>
<li>Spring 4 &#x2F; Java 1.8 이상을 사용하여 개발하는 조직</li>
<li>내가 더 발전할 수 있는 조직</li>
<li>연봉도 많이 올려주면 좋고~! ^^</li>
</ol>
<p>하지만 생각보다 이직은 쉽지 않았다. (특히나 선퇴사 후이직 이어서.. 11월쯤에는 굉장히 쫄렸다.)<br>일단 서비스 회사로 이직을 목표로 잡았지만, 기존의 했던 업무가 제조업이나 MES관련 개발을 주로 했었기 때문에 서비스 회사에서는 대부분의 서류 낙방을 경험했다. (이력서를 처음 써봐서 정말 못써서 그럴 수도 있겠지만.)<br>서류 한 군데만 붙어라… 면접은 완전 잘 볼 자신있다!라는 생각으로 서류만 2개월 이상 쓰다보니 10월쯤에는 서류 합격하는 회사가 몇 군데 있었다. 서류합격 메일을 받았을 때 기분이란….크 면접일자가 정해지고, 인터넷에 돌아다니는 예상 면접질문을 바탕으로 하나하나 정리를 하였다. 대게 기술질문은 그 테두리 안에서 나온다는 것이 여러사람들의 의견이었다.<br>그리고 9월쯤엔 대기업 신입공채를 준비했어서, 오랜만에 컴퓨터 이론을 한번 정리 했었는데 이 부분이 정말 도움이 많이 되었다. 자주 안보는 만큼 지금도 기억에서 많이 사라졌는데, 가끔씩 리마인드를 해주는 것이 좋겠다.</p>
<p>면접은 두 군데정도 봤는데 둘 다 자신감있게 봤었다.<br>아무래도 SI하면서 고객사 상대로 발표도 하고 회의도 자주 하다보니, 남들이랑 대화하고 그런거는 긴장되지 않았다.<br>그렇기 때문에 면접을 보면서 긴장을 덜하고 면접장에서 어필할 수 있었던 것 같다.<br>결국 최종적으로 한 곳의 회사만 합격을 하였는데, 그 곳이 NHN티켓링크이다.<br>최종합격 후 천만다행이라는 생각이 들었고, 2018년 1월 초에 입사를 하게 되었다.</p>
<h1 id="우리-팀의-개발문화"><a href="#우리-팀의-개발문화" class="headerlink" title="우리 팀의 개발문화"></a>우리 팀의 개발문화</h1><p>예전 SI할 때는 혼자서 사이트를 다 만들어야 했기 때문에, 프론트엔드도 하고 백엔드도하고, 서버설치 등을 혼자 다했다. 하지만 여기와서는 인프라 관련해서는 시스템팀이 별도로 있었고, DBA팀도 별도로 있었다. 내가 할 업무는 티켓링크 백엔드 개발과 약간의 간단한 프론트엔드 작업만 하면되었다.<br>기획팀도 별도로 나뉘어져 있다보니, 내가 직접 기획서를 쓰지 않아도 되고 개발에만 집중 할 수 있다는 환경이 참 좋았다.</p>
<h2 id="git-flow를-사용한-브랜치-전략"><a href="#git-flow를-사용한-브랜치-전략" class="headerlink" title="git flow를 사용한 브랜치 전략"></a>git flow를 사용한 브랜치 전략</h2><p>SI할때는 SVN만 사용해봤는데 그냥 master에 커밋치던 나에게는 신세계였다. 뭔가 구글링하면서 지나쳤던 얘기들을 실천하고 있는 조직이라는 생각이 들었다.<br>git도 처음 사용해 봤는데, SVN보다 더 유연하고 좋다는 생각이 들었다. (특히 브랜치를 왔다갔다 하면서 작업할 수 있는 점이 좋았던 것 같다.)</p>
<h2 id="Pull-Request-코드리뷰"><a href="#Pull-Request-코드리뷰" class="headerlink" title="Pull Request + 코드리뷰"></a>Pull Request + 코드리뷰</h2><p>두 번째로는 Pull Request를 올려서 코드리뷰를 강제화 하도록 하는 문화이다.<br>첫 업무를 받아서 PR을 올렸을 때는 Conversation이 50개 이상이 달려서 코드리뷰를 엄청나게 받았다.<br>뭔가 탈탈 털렸다라는 느낌도 받았고, 앞으로 공부해야 할 게 많구나라는 생각이 들었다.<br>한 가지 아쉬운점은… <code>코드리뷰를 하는 사람만 한다.</code> 다른사람들도 적극적으로 해주면 좋을텐데..라는 생각이 들었다.<br>처음에는 나도 다른사람의 코드를 리뷰해줘야지! 라는 생각으로 코드리뷰에 참여하려고 했지만.. 한마디도 달 수 없었다. 그때 딱 드는 생각이, <strong>“내가 아는게 없어서 코드리뷰를 해줄 수가 없구나.. 코드리뷰에 한마디라도 할 수 있도록 공부하자”</strong> 라는 생각을 하게 되었다.<br>돌이켜보면 나는 여태까지 <code>&quot;공부하지 않는 개발자&quot;</code>였다.<br>팀원들을 보면 아침에 일찍와서 책을보는 분도 계셨고, 따로 스터디모임을 하시는 분도 계셨다.<br>입사초기에 나는 살 좀 빼야지.. 라는 생각으로 아침운동을 다녀서 아침에 일찍 공부하기는 힘들었다. 그래서 주로 퇴근 후나 주말에 내가 하고자 하는 공부를 하였다. 그리고 꼭 공부한 내용은 블로그를 작성해서 남겨야겠다고 생각했다.<br>공부는 조금조금씩 계속 했지만, 본격적으로 블로그를 설치하고 시작한 것은 7월 정도인 것 같다.<br>현재 4년차에 Spring기반으로 개발을 계속 해왔다고는 하지만 Spring의 기본을 공부해본적이 없었다.<br>여태까지는 그냥 <code>이렇게 하면 이렇게 되네~</code> 방식의 개발을 해와서, 뭐가 안되면 원인 파악하기가 무척이나 어려웠다.<br>그래서 처음에는 <strong>Spring core</strong>에 대한 공부를 시작했다. 토비의 Spring 책도 사고, 회사 소스에 적용된 기술들을 하나하나 파보기 시작했다. 하나하나 익히고 나니 너무 유용한 기술들이 많이 있었고, 개발할 때 직접 써먹으면서 실전 응용력을 키울 수 있었던 것 같다.</p>
<h2 id="주간-기술공유"><a href="#주간-기술공유" class="headerlink" title="주간 기술공유"></a>주간 기술공유</h2><p>세 번째는 매주 목요일 기술공유 시간을 짧게 갖는다.<br>팀원 한 명씩 돌아가면서 신기술에 대한 공유나 코드리뷰등을 하는 시간이다. 이런 걸 해보지 않아서 처음에는 무슨 내용을 공유하지?라는 걱정이 앞섰는데, 다행히도 공유 순서가 가까워지면 항상 공유 할 내용이 있었다. 그리고 내 순서가 아니어도 최대한 공유를 하려고 노력했다. (순서가 아니어도 또 해도 된다. 하지만 내 순번에는 또 공유를 해야한다. ㅎㅎ) 최대한 공유를 많이 하려고 노력했고, 기술공유 준비를 하면서 내가 했던 일들이나 기술에 대해 다시 한번 정리하는 시간이 되어 개인적으로 기술에 대한 기억을 오랫동안 보존할 수 있는 방법이었다.<br>또 다른사람의 기술공유를 들었다가 내가 필요할 때 써먹거나, 미처 몰랐던 내용들도 있어서 개발팀 문화 중에 나름 유의미한 시간이라고 생각하고 있다.</p>
<h1 id="블로그-시작"><a href="#블로그-시작" class="headerlink" title="블로그 시작"></a>블로그 시작</h1><p>올해 목표 중 하나가 블로그에 공부한 내용에 대한 글을 꾸준히 작성하는 것이었다.<br>블로그는 7월쯤에 만들어서 꾸준히 작성하려고 노력하고 있다.</p>
<p>현재까지 수를 보니..</p>
<ul>
<li>7월 - 5개</li>
<li>8월 - 6개</li>
<li>9월 - 3개</li>
<li>10월 - 2개</li>
<li>11월 - 7개</li>
<li>12월 - 8개</li>
</ul>
<p>정도 해서 총 31개의 포스팅을 작성했다. 시리즈 물로 된 글도 많았고, 회사에서 사용한 기술들을 다시 좀 다듬어서 기록으로 남긴 것들도 있다. (회사 업무내용을 최대한 제외하려 한게 참 힘들었다ㅜㅜ)<br>처음에는 블로그도 안써봐서 글 쓰는데 시간도 오래걸리고 뭐 어떻게 써야하나…라는 생각으로 다른 블로그들을 참고하며 많이 썼던것 같다. 그리고 하나 쓰는데 시간도 꽤 오래 걸린것 같다.<br>한 30개의 글을 써보니 대충 블로그 쓰는 법도 감이 왔다.</p>
<ul>
<li>일단 내가 100% 이해하지 못한 상황에서 글을 쓸 수 없다.</li>
<li>처음에는 블로그 포스팅 수를 늘리고 싶어서 무조건 post부터 생성하고 봤는데, 글의 진도가 나가지 않았다.</li>
<li>블로그를 빠르고 쉽게 작성하기 위해서는 목차를 먼저 잡고 그에 대한 지식을 채운 다음에 각 섹션별로 담아내고자 하는 내용을 짧게 정리했다.</li>
<li>예제가 필요한 경우 미리 예제에 대한 실습을 마쳐 놓아야 한다.<ul>
<li>그때그때 예제코드 작성하면 시간이 오래걸리고, 내가 무슨 글을 쓰던 중이었는지 까먹게 된다.</li>
</ul>
</li>
</ul>
<p>블로그를 쓰다보니 지식에 대한 인덱스도 나름 생기고, 나중에 기억 안나도 예제코드를 찾아볼 수 있어서 좋았다.<br>앞으로도 계속 블로그를 작성할 예정인데, 제발 귀찮아지지만 않았으면 좋겠다..!</p>
<h1 id="회사-업무"><a href="#회사-업무" class="headerlink" title="회사 업무"></a>회사 업무</h1><h2 id="1-2월에는-회사-적응도-하고-바로-또-업무를-할당-받았다"><a href="#1-2월에는-회사-적응도-하고-바로-또-업무를-할당-받았다" class="headerlink" title="1~2월에는 회사 적응도 하고, 바로 또 업무를 할당 받았다."></a>1~2월에는 회사 적응도 하고, 바로 또 업무를 할당 받았다.</h2><p>나의 첫 업무는 티켓링크 카카오톡 알림톡 연동이었다. 기존에는 SMS&#x2F;MMS만 사용했는데, 카카오톡 알림톡을 지원하도록 하는 업무였다. 지금 생각해보면 업무는 단순했다. 카카오톡 API를 연동 인터페이스만 구현해주면 되는 것이었는데, 외부 API 연동을 처음 해보는터라 시간도 오래걸리고, 회사 소스를 파악하면서 해야해서 1달이상의 시간이 걸렸던 것 같다.<br>기존 코드의 리팩토링도 해가면서 해서, 나름 재미있게 개발을 했던 첫 업무였다.</p>
<h2 id="3-4월에는-캡차-시스템-개발을-진행했다"><a href="#3-4월에는-캡차-시스템-개발을-진행했다" class="headerlink" title="3~4월에는 캡차 시스템 개발을 진행했다."></a>3~4월에는 캡차 시스템 개발을 진행했다.</h2><p>티켓시스템에는 사람들이 좌석을 빨리 차지하기 위해 매크로를 많이 쓴다.<br>최근에는 뉴스기사에도 아이돌 콘서트니, 인기 공연에 대해 매크로를 돌려서 빠르게 예매한 다음에 몇배의 가격으로 불려서 암표를 파는 사람이 많다는 기사가 나왔다. 최소한이라도 예방하기 위해 티켓링크에서는 캡차 도입을 고민하고 있었다. 구글의 리캡차나 국내의 캡차 솔루션을 도입하자라는 의견도 나왔고, 직접 구축하는 것이 좋다!라는 의견이 나오고 있을때쯤 집에서 한번 오픈소스를 이용해서 간단하게 캡차를 만들어보았다. 어렵지 않게 예시를 만들수 있었고, 다음날 바로 팀장님께 보여드렸다. 그렇게 캡차 개발은 내 업무가 되었다^^<br>나름 보안과 성능을 생각하며, 이미지 캐싱등의 작업을 하였다. 그리고 캡차를 사용하기 위해서는 Global캐시 Store가 하나는 필요했다. 이로인해 팀에서 NoSQL 도입을 생각하게 되었다.<br>캡차 개발 완료 후 nGrinder를 통해 성능테스트로 진행하였는데 15,000 TPS정도의 높은 성능이 나와서 나름 만족하고 있었다.(하지만 아직 회사에서 인기 공연이나 예매에 사용을 안해서.. 아쉬웠다.)</p>
<h2 id="Redis-도입"><a href="#Redis-도입" class="headerlink" title="Redis 도입"></a>Redis 도입</h2><p>캡차 사용을 위해 Redis를 도입하게 되었다. 원래 사용하는 NoSQL이 있지만, 추가적으로 NoSQL서버를 자체 구축할 예정이었다. (이유는 따로 적지 않겠다.) 여러가지 NoSQL이 물망에 올랐다. Redis, Arcus등 여러가지 Key-value store가 거론되었지만, 내 욕심 상 Redis를 해보고 싶었다. (아무래도 Key-value store 1순위인 Redis를 써보고 싶었다.)<br>Redis를 도입하면서 단순하게 서버에 Redis만 설치해서 쓰고 싶지는 않았다. 인프라 시스템은 항상 scale out을 고려해야 했기 때문에, 주변에서 Docker를 이용해서 설치 해보라는 얘기가 나왔다.<br>Docker는 난생 처음 들어보는 거였는데.. Docker에 대한 삽질을 어마무시하게 하면서 거의 3주만에 Redis 설치와 Cluster 설치까지 완료했다. 이 기회를 가지면서 Redis에 대한 전반적인 이해가 생기게 되었고, 나름 삽질을 거치면서 Docker라는 시스템도 어느정도 이해하게 되었다. (다시는 까먹지 않게 팀내에서도 3일에 걸쳐 공유를 하고 11부작 정도로 블로그도 작성해 두었다^^)</p>
<h2 id="결제시스템-개편"><a href="#결제시스템-개편" class="headerlink" title="결제시스템 개편"></a>결제시스템 개편</h2><p>어쩌다보니 내가 티켓링크 결제 시스템 ‘부’가 되어서 티켓링크 결제시스템 개편 업무를 많이 했다.<br>Payco결제, IC카드결제, 네이버페이 연동등을 경험하며, 외부 빌링업체의 결제 프로세스를 경험 할 수 있던 기회였다.<br>네이버페이는 거의 처음부터 만들게 되었는데, Web에서의 결제, App에서의 결제를 모두 봐야 해서 꽤 고생했던 기억이 있다. 하지만 결제관련 Flow는 어느정도 알게 되었던 업무였다.</p>
<h2 id="MSA시도-해보기"><a href="#MSA시도-해보기" class="headerlink" title="MSA시도 해보기"></a>MSA시도 해보기</h2><p>티켓링크 시스템은 Monolothic 시스템 구조를 가지고 있다. 그렇기 때문에 빌드시간도 만만치않게 걸리고 배포하려고 해도 사이드 이펙트가 발생할 확률이 높다. 그렇기 때문에 올해 말부터 하나씩 하나씩 쪼개는 작업을 진행하고 있다. MSA까지는 아니어도 점진적으로 모듈을 분리하여, 빌드 시간을 단축 시키고, 시스템 안정성을 높이기 위함에 있다.<br>이 부분에 대해서는 나도 의견을 많이 내고 시니어 개발자분들도 관심있게 보는 부분이어서, 내년에 더 활발하게 작업이 진행 될 것 같다.</p>
<h1 id="내년에는"><a href="#내년에는" class="headerlink" title="내년에는.."></a>내년에는..</h1><p>내년 공부의 시작은 개발 필독 서적을 몇가지 읽어보려고 한다.</p>
<ul>
<li>clean code</li>
<li>TDD 개발 방법론</li>
<li>Effective Java 3rd Edition<br>(2rd Edition은 한번봤는데, Java8에 대한 내용이 추가되었다고 하니 한번더 봐야겠다.)</li>
<li>Java ORM 표준 JPA프로그래밍</li>
<li>현재 MyBatis기반으로 시스템이 구성되어있는데, 새로 만드는 시스템은 무조건 JPA를 도입하자고 얘기가 나오고 있다. 이전 회사에서 JPA사용경험이 있어서 나도 JPA도입을 대찬성하고 있는데, 더 지식을 쌓고 개발할 필요성을 느끼고 있다. 그래서 이 책을 아마 1순위로 공부하지 않을까.. 싶다.</li>
</ul>
<p>회사 업무에서는 주니어 개발자이지만, 목소리를 내보려 노력하고 있다.<br>팀에서도 그런 분위기를 조성하려하고 있는 것 같고, 내 의견이 묵살되더라도 생각이라도 해보고, 다른사람의 의견과 비교할 수 있기 때문에 적극적으로 목소리를 내보고자 한다.</p>
<h1 id="마무리"><a href="#마무리" class="headerlink" title="마무리.."></a>마무리..</h1><p>올해 회고를 쭉 작성해보니 생각보다 많은 일을 했다는 생각이 든다. 그리고 그 과정 속에서 한단계 더 성장한 개발자가 되었다고 나름 생각하고 만족하고 있다. 회고를 쓰면서 회사 얘기가 조금 나와서.. 글을 좀 수정해야 할 경우가 생길 수도 있지만.. 딱히 그럴만한 내용은 없다고 생각이 든다.<br>앞으로는 1년 단위로 회고를 작성하여 한번씩 되돌아보고 추억할 수 있는 시간이 되면 좋겠다.</p>
</div><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="../7/"><i class="fa fa-chevron-left"></i></a><a class="page-number" href="../../">1</a><span class="space">&hellip;</span><a class="page-number" href="../7/">7</a><span class="page-number current">8</span><a class="page-number" href="../9/">9</a><span class="space">&hellip;</span><a class="page-number" href="../12/">12</a><a class="extend next" rel="next" href="../9/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2022 By Carrey</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="../../js/utils.js?version=1.9.0"></script><script src="../../js/fancybox.js?version=1.9.0"></script><script src="../../js/sidebar.js?version=1.9.0"></script><script src="../../js/copy.js?version=1.9.0"></script><script src="../../js/fireworks.js?version=1.9.0"></script><script src="../../js/transition.js?version=1.9.0"></script><script src="../../js/scroll.js?version=1.9.0"></script><script src="../../js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>